--------------------------------------------------------------------------------
-- Prove the semantic soundness of the pure sequent
--------------------------------------------------------------------------------

{-# OPTIONS --without-K --sized-types #-}

module Syho.Model.Prop.Sound where

open import Base.Func using (_$_; _â€º_; id)
open import Base.Few using (0â‚‚; 1â‚‚; binary; absurd)
open import Base.Size using (ğ•Š; âˆ; !)
open import Base.Prod using (_,_; Ï€â‚€; Ï€â‚; âˆ‘-case)
open import Syho.Logic.Prop using (Propâˆ)
open import Syho.Logic.Core using (_âŠ¢[_]_; âŠ¢-refl; _Â»_; âˆ€-intro; âˆƒ-elim; âˆ€-elim;
  âˆƒ-intro; choice; â†’-introË¡; â†’-elimË¡; âˆ—-monoË¡; âŠ¤âˆ—-elim; âŠ¤âˆ—-intro; âˆ—-comm;
  âˆ—-assocË¡; -âˆ—-introË¡; -âˆ—-elimË¡; â¤‡-mono; â¤‡-intro; â¤‡-join; â¤‡-eatË¡; â¤‡-âŒœâŒâˆ§-out;
  â–¡-mono; â–¡-elim; â–¡-dup; â–¡Ë¡-âˆ§â‡’âˆ—; â–¡-âˆ€-in; â–¡-âˆƒ-out)
open import Syho.Logic.Names using ([]á´º-resp; []á´º-merge; []á´º-split; []á´º-âœ”)
open import Syho.Logic.Mem using (â†¦âŸ¨âŸ©-resp; â†¦âŸ¨âŸ©-merge; â†¦âŸ¨âŸ©-split; â†¦âŸ¨âŸ©-â‰¤1;
  â†¦âŸ¨âŸ©-agree)
open import Syho.Logic.Ind using (â—‹-mono; â—‹-eatË¡; â†ªâ‡›-â‰¤; â†ªâ‡›-eatË¡â»Ë¡áµ˜; â†ªâ‡›-monoÊ³áµ˜;
  â†ªâ‡›-eatË¡â»Ê³; â†ªâ‡›-frameË¡; â—‹â‡’â†ªâ‡›;  â†ªáµƒâŸ¨âŸ©-â‰¤; â†ªáµƒâŸ¨âŸ©-eatË¡â»Ë¡áµ˜; â†ªáµƒâŸ¨âŸ©-monoÊ³áµ˜; â†ªáµƒâŸ¨âŸ©-eatË¡â»Ê³;
  â†ªáµƒâŸ¨âŸ©-frameË¡; â—‹â‡’â†ªáµƒâŸ¨âŸ©; â†ªâŸ¨âŸ©áµ€â‡’â†ªâŸ¨âŸ©á´¾; â†ªâŸ¨âŸ©áµ€-â‰¤; â†ªâŸ¨âŸ©-eatË¡â»Ë¡áµ˜á´º; â†ªâŸ¨âŸ©-monoÊ³áµ˜á´º; â†ªâŸ¨âŸ©-eatË¡â»Ê³;
  â†ªâŸ¨âŸ©-frameË¡; â—‹â‡’â†ªâŸ¨âŸ©; â†ªâŸ¨âŸ©âˆ-â‰¤; â†ªâŸ¨âŸ©âˆ-eatË¡â»áµ˜á´º; â—‹â‡’â†ªâŸ¨âŸ©âˆ)
open import Syho.Logic.Inv using (&â±-â‡’â–¡; &â±-resp-â–¡âˆ§; %â±-mono; %â±-eatË¡)
open import Syho.Logic.Lft using ([]á´¸âŸ¨âŸ©-resp; []á´¸âŸ¨âŸ©-merge; []á´¸âŸ¨âŸ©-split;
  []á´¸âŸ¨âŸ©-â‰¤1; â€ á´¸-â‡’â–¡; []á´¸âŸ¨âŸ©-â€ á´¸-no; []á´¸-new)
open import Syho.Logic.Bor using (âŸ¨â€ âŸ©-mono; âŸ¨â€ âŸ©-eatË¡; &áµ-resp-â–¡âˆ§; %áµ-mono;
  %áµ-eatË¡)
open import Syho.Model.Prop.Base using (_âŠ¨âœ“_; â†’áµ’-introË¡; â†’áµ’-elimË¡; âˆ—áµ’-monoË¡;
  âˆ—áµ’-monoâœ“Ë¡; ?âˆ—áµ’-intro; âˆ—áµ’-elimÊ³; âˆ—áµ’-comm; âˆ—áµ’-assocË¡; -âˆ—áµ’-introË¡; -âˆ—áµ’-elimË¡;
  â¤‡áµ’-monoâœ“; â¤‡áµ’-intro; â¤‡áµ’-join; â¤‡áµ’-eatË¡; â¤‡áµ’-âŒœâŒáµ’Ã—-out; â–¡áµ’-monoâœ“; â–¡áµ’-elim; â–¡áµ’-dup;
  â–¡áµ’Ë¡-Ã—áµ’â‡’âˆ—áµ’)
open import Syho.Model.Prop.Mem using (â†¦âŸ¨âŸ©áµ’-resp; â†¦âŸ¨âŸ©áµ’-merge; â†¦âŸ¨âŸ©áµ’-split;
  â†¦âŸ¨âŸ©áµ’-â‰¤1; â†¦âŸ¨âŸ©áµ’-agree)
open import Syho.Model.Prop.Names using ([]á´ºáµ’-resp; []á´ºáµ’-merge; []á´ºáµ’-split;
  []á´ºáµ’-âœ”)
open import Syho.Model.Prop.Lft using ([]á´¸âŸ¨âŸ©áµ’-resp; []á´¸âŸ¨âŸ©áµ’-merge; []á´¸âŸ¨âŸ©áµ’-split;
  []á´¸âŸ¨âŸ©áµ’-â‰¤1; â€ á´¸áµ’-â‡’â–¡áµ’; []á´¸âŸ¨âŸ©áµ’-â€ á´¸áµ’-no; []á´¸áµ’-new)
open import Syho.Model.Prop.Ind using (â—‹áµ’-mono; â—‹áµ’-eatË¡; â†ªâ‡›áµ’-â‰¤; â†ªâ‡›áµ’-eatË¡â»Ë¡áµ˜;
  â†ªâ‡›áµ’-monoÊ³áµ˜; â†ªâ‡›áµ’-eatË¡â»Ê³; â†ªâ‡›áµ’-frameË¡; â—‹áµ’â‡’â†ªâ‡›áµ’; â†ªáµƒâŸ¨âŸ©áµ’-â‰¤; â†ªáµƒâŸ¨âŸ©áµ’-eatË¡â»Ë¡áµ˜;
  â†ªáµƒâŸ¨âŸ©áµ’-monoÊ³áµ˜; â†ªáµƒâŸ¨âŸ©áµ’-eatË¡â»Ê³; â†ªáµƒâŸ¨âŸ©áµ’-frameË¡; â—‹áµ’â‡’â†ªáµƒâŸ¨âŸ©áµ’; â†ªâŸ¨âŸ©áµ€áµ’â‡’â†ªâŸ¨âŸ©á´¾áµ’; â†ªâŸ¨âŸ©áµ€áµ’-â‰¤;
  â†ªâŸ¨âŸ©áµ’-eatË¡â»Ë¡áµ˜á´º; â†ªâŸ¨âŸ©áµ’-monoÊ³áµ˜á´º; â†ªâŸ¨âŸ©áµ’-eatË¡â»Ê³; â†ªâŸ¨âŸ©áµ’-frameË¡; â—‹áµ’â‡’â†ªâŸ¨âŸ©áµ’; â†ªâŸ¨âŸ©âˆáµ’-â‰¤;
  â†ªâŸ¨âŸ©âˆáµ’-eatË¡â»áµ˜á´º; â—‹áµ’â‡’â†ªâŸ¨âŸ©âˆáµ’)
open import Syho.Model.Prop.Inv using (&â±áµ’-â‡’â–¡áµ’; &â±áµ’-resp-â–¡áµ’Ã—áµ’; %â±áµ’-mono;
  %â±áµ’-eatË¡)
open import Syho.Model.Prop.Interp using (â¸¨_â¸©; â¸¨â¸©-Mono; â¸¨â¸©-â‡’á´®)

private variable
  P Q R S T :  Propâˆ

postulate
  WIP :  âˆ€{Å‚} {A : Set Å‚} â†’  A  -- Just for now

--------------------------------------------------------------------------------
-- âŠ¢-sem :  Semantic soundness of the pure sequent

abstract

  âŠ¢-sem :  P âŠ¢[ âˆ ] Q â†’  â¸¨ P â¸© âŠ¨âœ“ â¸¨ Q â¸©

  -- âŠ¢-refl :  P âŠ¢[ âˆ ] P

  âŠ¢-sem âŠ¢-refl _ =  id

  -- _Â»_ :  P âŠ¢[ âˆ ] Q â†’  Q âŠ¢[ âˆ ] R â†’  P âŠ¢[ âˆ ] R

  âŠ¢-sem (PâŠ¢Q Â» QâŠ¢R) âœ“a =  âŠ¢-sem PâŠ¢Q âœ“a â€º âŠ¢-sem QâŠ¢R âœ“a

  -- âˆ€-intro :  (âˆ€' x â†’ P âŠ¢[ âˆ ] QË™ x) â†’  P âŠ¢[ âˆ ] âˆ€Ë™ QË™

  âŠ¢-sem (âˆ€-intro âˆ€xPâŠ¢Qx) âœ“a Pa x =  âŠ¢-sem (âˆ€xPâŠ¢Qx x) âœ“a Pa

  -- âˆƒ-elim :  (âˆ€' x â†’ PË™ x âŠ¢[ âˆ ] Q) â†’  âˆƒË™ PË™ âŠ¢[ âˆ ] Q

  âŠ¢-sem (âˆƒ-elim âˆ€xPxâŠ¢Q) âœ“a =  âˆ‘-case Î» x â†’ âŠ¢-sem (âˆ€xPxâŠ¢Q x) âœ“a

  -- âˆ€-elim :  âˆ€ x â†’  âˆ€Ë™ PË™ âŠ¢[ âˆ ] PË™ x

  âŠ¢-sem (âˆ€-elim x) _ âˆ€Pa =  âˆ€Pa x

  -- âˆƒ-intro :  âˆ€ x â†’  PË™ x âŠ¢[ âˆ ] âˆƒË™ PË™

  âŠ¢-sem (âˆƒ-intro x) _ Px =  x , Px

  -- choice :  âˆ€' x , âˆƒ y , PË™Ë™ x y âŠ¢[ âˆ ] âˆƒ yË™ , âˆ€' x , PË™Ë™ x (yË™ x)

  -- It can be proved axiom-free thanks to the logic's predicativity

  âŠ¢-sem choice _ âˆ€xâˆƒyPxy .Ï€â‚€ x =  âˆ€xâˆƒyPxy x .Ï€â‚€
  âŠ¢-sem choice _ âˆ€xâˆƒyPxy .Ï€â‚ x =  âˆ€xâˆƒyPxy x .Ï€â‚

  -- â†’-introË¡ :  P âˆ§ Q âŠ¢[ âˆ ] R â†’  Q âŠ¢[ âˆ ] P â†’' R

  âŠ¢-sem (â†’-introË¡ {Q = Q} Pâˆ§QâŠ¢R) _ =
    â†’áµ’-introË¡ (â¸¨â¸©-Mono {Q}) Î» âœ“b (Pb , Qb) â†’ âŠ¢-sem Pâˆ§QâŠ¢R âœ“b $ binary Pb Qb

  -- â†’-elimË¡ :  Q âŠ¢[ âˆ ] P â†’' R â†’  P âˆ§ Q âŠ¢[ âˆ ] R

  âŠ¢-sem (â†’-elimË¡ QâŠ¢Pâ†’R) âœ“a Pâˆ§Qa =  â†’áµ’-elimË¡ (âŠ¢-sem QâŠ¢Pâ†’R) âœ“a (Pâˆ§Qa 0â‚‚ , Pâˆ§Qa 1â‚‚)

  -- âˆ—-monoË¡ :  P âŠ¢[ âˆ ] Q â†’  P âˆ— R âŠ¢[ âˆ ] Q âˆ— R

  âŠ¢-sem (âˆ—-monoË¡ PâŠ¢Q) =  âˆ—áµ’-monoâœ“Ë¡ (âŠ¢-sem PâŠ¢Q)

  -- âŠ¤âˆ—-elim :  âŠ¤' âˆ— P âŠ¢[ âˆ ] P

  âŠ¢-sem (âŠ¤âˆ—-elim {P}) _ =  âˆ—áµ’-elimÊ³ $ â¸¨â¸©-Mono {P}

  -- âŠ¤âˆ—-intro :  P âŠ¢[ âˆ ] âŠ¤' âˆ— P

  âŠ¢-sem âŠ¤âˆ—-intro _ =  ?âˆ—áµ’-intro absurd

  -- âˆ—-comm :  P âˆ— Q âŠ¢[ âˆ ] Q âˆ— P

  âŠ¢-sem âˆ—-comm _ =  âˆ—áµ’-comm

  -- âˆ—-assocË¡ :  (P âˆ— Q) âˆ— R âŠ¢[ âˆ ] P âˆ— (Q âˆ— R)

  âŠ¢-sem âˆ—-assocË¡ _ =  âˆ—áµ’-assocË¡

  -- -âˆ—-introË¡ :  P âˆ— Q âŠ¢[ âˆ ] R â†’  Q âŠ¢[ âˆ ] P -âˆ— R

  âŠ¢-sem (-âˆ—-introË¡ Pâˆ—QâŠ¢R) _ =  -âˆ—áµ’-introË¡ $ âŠ¢-sem Pâˆ—QâŠ¢R

  -- -âˆ—-elimË¡ :  Q âŠ¢[ âˆ ] P -âˆ— R â†’  P âˆ— Q âŠ¢[ âˆ ] R

  âŠ¢-sem (-âˆ—-elimË¡ {R = R} QâŠ¢P-âˆ—R) =  -âˆ—áµ’-elimË¡ (â¸¨â¸©-Mono {R}) $ âŠ¢-sem QâŠ¢P-âˆ—R

  -- â¤‡-mono :  P âŠ¢[ âˆ ] Q â†’  â¤‡ P âŠ¢[ âˆ ] â¤‡ Q

  âŠ¢-sem (â¤‡-mono PâŠ¢Q) _ =  â¤‡áµ’-monoâœ“ $ âŠ¢-sem PâŠ¢Q

  -- â¤‡-intro :  P âŠ¢[ âˆ ] â¤‡ P

  âŠ¢-sem â¤‡-intro _ =  â¤‡áµ’-intro

  -- â¤‡-join :  â¤‡ â¤‡ P âŠ¢[ âˆ ] â¤‡ P

  âŠ¢-sem â¤‡-join _ =  â¤‡áµ’-join

  -- â¤‡-eatË¡ :  Q âˆ— â¤‡ P âŠ¢[ âˆ ] â¤‡ (Q âˆ— P)

  âŠ¢-sem â¤‡-eatË¡ _ =  â¤‡áµ’-eatË¡

  -- â¤‡-âŒœâŒâˆ§-out :  â¤‡ (âŒœ X âŒâˆ§ P) âŠ¢[ âˆ ] âŒœ X âŒâˆ§ â¤‡ P

  âŠ¢-sem â¤‡-âŒœâŒâˆ§-out =  â¤‡áµ’-âŒœâŒáµ’Ã—-out

  -- â–¡-mono :  P âŠ¢[ âˆ ] Q â†’  â–¡ P âŠ¢[ âˆ ] â–¡ Q

  âŠ¢-sem (â–¡-mono PâŠ¢Q) =  â–¡áµ’-monoâœ“ $ âŠ¢-sem PâŠ¢Q

  -- â–¡-elim :  â–¡ P âŠ¢[ âˆ ] P

  âŠ¢-sem (â–¡-elim {P}) _ =  â–¡áµ’-elim $ â¸¨â¸©-Mono {P}

  -- â–¡-dup :  â–¡ P âŠ¢[ âˆ ] â–¡ â–¡ P

  âŠ¢-sem (â–¡-dup {P}) _ =   â–¡áµ’-dup $ â¸¨â¸©-Mono {P}

  -- â–¡Ë¡-âˆ§â‡’âˆ— :  â–¡ P âˆ§ Q âŠ¢[ âˆ ] â–¡ P âˆ— Q

  âŠ¢-sem (â–¡Ë¡-âˆ§â‡’âˆ— {P}) _ â–¡Pâˆ§Qa =  â–¡áµ’Ë¡-Ã—áµ’â‡’âˆ—áµ’ (â¸¨â¸©-Mono {P}) (â–¡Pâˆ§Qa 0â‚‚ , â–¡Pâˆ§Qa 1â‚‚)

  -- â–¡-âˆ€-in :  âˆ€Ë™ (â–¡_ âˆ˜ PË™) âŠ¢[ âˆ ] â–¡ âˆ€Ë™ PË™

  âŠ¢-sem â–¡-âˆ€-in _ =  id

  -- â–¡-âˆƒ-out :  â–¡ âˆƒË™ PË™ âŠ¢[ âˆ ] âˆƒË™ (â–¡_ âˆ˜ PË™)

  âŠ¢-sem â–¡-âˆƒ-out _ =  id

  -- []á´º-resp :  Nm â‰¡Ë™ Nm' â†’  [ Nm ]á´º âŠ¢[ âˆ ] [ Nm' ]á´º

  âŠ¢-sem ([]á´º-resp Nmâ‰¡Nm') _ =  []á´ºáµ’-resp Nmâ‰¡Nm'

  -- []á´º-merge :  [ Nm ]á´º  âˆ—  [ Nm' ]á´º  âŠ¢[ âˆ ]  [ Nm âŠá¶» Nm' ]á´º

  âŠ¢-sem []á´º-merge _ =  []á´ºáµ’-merge

  -- []á´º-split :  [ Nm âŠá¶» Nm' ]á´º  âŠ¢[ âˆ ]  [ Nm ]á´º  âˆ—  [ Nm' ]á´º

  âŠ¢-sem []á´º-split _ =  []á´ºáµ’-split

  -- []á´º-âœ” :  [ Nm ]á´º  âŠ¢[ âˆ ]  âŒœ âœ”á¶» Nm âŒ

  âŠ¢-sem []á´º-âœ” âœ“âˆ™ =  []á´ºáµ’-âœ” âœ“âˆ™ â€º (_, absurd)

  -- â†¦âŸ¨âŸ©-resp :  p â‰ˆá´¿âº q  â†’   Î¸ â†¦âŸ¨ p âŸ© áµ—v  âŠ¢[ âˆ ]  Î¸ â†¦âŸ¨ q âŸ© áµ—v

  âŠ¢-sem (â†¦âŸ¨âŸ©-resp pâ‰ˆq) _ =  â†¦âŸ¨âŸ©áµ’-resp pâ‰ˆq

  -- â†¦âŸ¨âŸ©-merge :  Î¸ â†¦âŸ¨ p âŸ© áµ—v  âˆ—  Î¸ â†¦âŸ¨ q âŸ© áµ—v  âŠ¢[ âˆ ]  Î¸ â†¦âŸ¨ p +á´¿âº q âŸ© áµ—v

  âŠ¢-sem â†¦âŸ¨âŸ©-merge _ =  â†¦âŸ¨âŸ©áµ’-merge

  -- â†¦âŸ¨âŸ©-split :  Î¸ â†¦âŸ¨ p +á´¿âº q âŸ© áµ—v  âŠ¢[ âˆ ]  Î¸ â†¦âŸ¨ p âŸ© áµ—v  âˆ—  Î¸ â†¦âŸ¨ q âŸ© áµ—v

  âŠ¢-sem â†¦âŸ¨âŸ©-split _ =  â†¦âŸ¨âŸ©áµ’-split

  -- â†¦âŸ¨âŸ©-â‰¤1 :  Î¸ â†¦âŸ¨ p âŸ© áµ—v  âŠ¢[ âˆ ]  âŒœ p â‰¤1á´¿âº âŒ

  âŠ¢-sem â†¦âŸ¨âŸ©-â‰¤1 âœ“a =  â†¦âŸ¨âŸ©áµ’-â‰¤1 âœ“a â€º (_, absurd)

  -- â†¦âŸ¨âŸ©-agree :  Î¸ â†¦âŸ¨ p âŸ© áµ—u  âˆ—  Î¸ â†¦âŸ¨ q âŸ© áµ—v  âŠ¢[ âˆ ]  âŒœ áµ—u â‰¡ áµ—v âŒ

  âŠ¢-sem â†¦âŸ¨âŸ©-agree âœ“a =  â†¦âŸ¨âŸ©áµ’-agree âœ“a â€º (_, absurd)

  -- â—‹-mono :  PË‚ .! âŠ¢[< âˆ ] QË‚ .! â†’  â—‹ PË‚ âŠ¢[ âˆ ] â—‹ QË‚

  âŠ¢-sem (â—‹-mono PâŠ¢Q) _ =  â—‹áµ’-mono $ PâŠ¢Q .!

  -- â—‹-eatË¡ :  {{Basic Q}} â†’  Q âˆ— â—‹ PË‚ âŠ¢[ âˆ ] â—‹ Â¡á´¾ (Q âˆ— PË‚ .!)

  âŠ¢-sem (â—‹-eatË¡ {Q}) _ =  âˆ—áµ’-monoË¡ (â¸¨â¸©-â‡’á´® {Q}) â€º â—‹áµ’-eatË¡

  -- â†ªâ‡›-â‰¤ :  i â‰¤ j  â†’   PË‚ â†ª[ i ]â‡› QË‚  âŠ¢[ âˆ ]  PË‚ â†ª[ j ]â‡› QË‚

  âŠ¢-sem (â†ªâ‡›-â‰¤ iâ‰¤j) _ =  â†ªâ‡›áµ’-â‰¤ iâ‰¤j

  -- â†ªâ‡›-eatË¡â»Ë¡áµ˜ :  {{Basic R}}  â†’   R  âˆ—  P'Ë‚ .!  âŠ¢[< âˆ ][ i ]â‡›  PË‚ .! â†’
  --               R  âˆ—  (PË‚ â†ª[ i ]â‡› QË‚)  âŠ¢[ âˆ ]  P'Ë‚ â†ª[ i ]â‡› QË‚

  âŠ¢-sem (â†ªâ‡›-eatË¡â»Ë¡áµ˜ {R} Râˆ—P'âŠ¢â‡›P) _ =
    âˆ—áµ’-monoË¡ (â¸¨â¸©-â‡’á´® {R}) â€º â†ªâ‡›áµ’-eatË¡â»Ë¡áµ˜ $ Râˆ—P'âŠ¢â‡›P .!

  -- â†ªâ‡›-monoÊ³áµ˜ :  QË‚ .!  âŠ¢[< âˆ ][ i ]â‡›  Q'Ë‚ .! â†’
  --              PË‚ â†ª[ i ]â‡› QË‚  âŠ¢[ âˆ ]  PË‚ â†ª[ i ]â‡› Q'Ë‚

  âŠ¢-sem (â†ªâ‡›-monoÊ³áµ˜ QâŠ¢â‡›Q') _ =  â†ªâ‡›áµ’-monoÊ³áµ˜ $ QâŠ¢â‡›Q' .!

  -- â†ªâ‡›-eatË¡â»Ê³ :  {{Basic R}}  â†’
  --   R  âˆ—  (PË‚ â†ª[ i ]â‡› QË‚)  âŠ¢[ âˆ ]  PË‚ â†ª[ i ]â‡› Â¡á´¾ (R âˆ— QË‚ .!)

  âŠ¢-sem (â†ªâ‡›-eatË¡â»Ê³ {R}) _ =  âˆ—áµ’-monoË¡ (â¸¨â¸©-â‡’á´® {R}) â€º â†ªâ‡›áµ’-eatË¡â»Ê³

  -- â†ªâ‡›-frameË¡ :  PË‚ â†ª[ i ]â‡› QË‚  âŠ¢[ âˆ ]  Â¡á´¾ (R âˆ— PË‚ .!) â†ª[ i ]â‡› Â¡á´¾ (R âˆ— QË‚ .!)

  âŠ¢-sem â†ªâ‡›-frameË¡ _ =  â†ªâ‡›áµ’-frameË¡

  -- â—‹â‡’â†ªâ‡› :  PË‚ .!  âˆ—  RË‚ .! âŠ¢[< âˆ ][ i ]â‡›  QË‚ .!  â†’
  --         â—‹ RË‚  âŠ¢[ âˆ ]  PË‚ â†ª[ i ]â‡› QË‚

  âŠ¢-sem (â—‹â‡’â†ªâ‡› Pâˆ—RâŠ¢â‡›Q) _ =  â—‹áµ’â‡’â†ªâ‡›áµ’ $ Pâˆ—RâŠ¢â‡›Q .!

  -- â†ªáµƒâŸ¨âŸ©-â‰¤ :  i â‰¤ j  â†’   PË‚ â†ª[ i ]áµƒâŸ¨ red âŸ© QË‚Ë™  âŠ¢[ âˆ ]  PË‚ â†ª[ j ]áµƒâŸ¨ red âŸ© QË‚Ë™

  âŠ¢-sem (â†ªáµƒâŸ¨âŸ©-â‰¤ iâ‰¤j) _ =  â†ªáµƒâŸ¨âŸ©áµ’-â‰¤ iâ‰¤j

  -- â†ªáµƒâŸ¨âŸ©-eatË¡â»Ë¡áµ˜ :  {{Basic R}}  â†’   R  âˆ—  P'Ë‚ .!  âŠ¢[< âˆ ][ i ]â‡›  PË‚ .!  â†’
  --                 R âˆ— (PË‚ â†ª[ j ]áµƒâŸ¨ red âŸ© QË‚Ë™)  âŠ¢[ âˆ ]  P'Ë‚ â†ª[ j ]áµƒâŸ¨ red âŸ© QË‚Ë™

  âŠ¢-sem (â†ªáµƒâŸ¨âŸ©-eatË¡â»Ë¡áµ˜ {R} Râˆ—P'âŠ¢â‡›P) _ =
    âˆ—áµ’-monoË¡ (â¸¨â¸©-â‡’á´® {R}) â€º â†ªáµƒâŸ¨âŸ©áµ’-eatË¡â»Ë¡áµ˜ $ Râˆ—P'âŠ¢â‡›P .!

  -- â†ªáµƒâŸ¨âŸ©-monoÊ³áµ˜ :  (âˆ€ v â†’  QË‚Ë™ v .!  âŠ¢[< âˆ ][ i ]â‡›  Q'Ë‚Ë™ v .!)  â†’
  --                PË‚ â†ª[ j ]áµƒâŸ¨ red âŸ© QË‚Ë™  âŠ¢[ âˆ ]  PË‚ â†ª[ j ]áµƒâŸ¨ red âŸ© Q'Ë‚Ë™

  âŠ¢-sem (â†ªáµƒâŸ¨âŸ©-monoÊ³áµ˜ âˆ€vQâŠ¢â‡›Q') _ =  â†ªáµƒâŸ¨âŸ©áµ’-monoÊ³áµ˜ Î» v â†’ âˆ€vQâŠ¢â‡›Q' v .!

  -- â†ªáµƒâŸ¨âŸ©-eatË¡â»Ê³ :  {{Basic R}}  â†’
  --   R  âˆ—  (PË‚ â†ª[ i ]áµƒâŸ¨ red âŸ© QË‚Ë™)  âŠ¢[ âˆ ]
  --     PË‚ â†ª[ i ]áµƒâŸ¨ red âŸ© Î» v â†’ Â¡á´¾ (R âˆ— QË‚Ë™ v .!)

  âŠ¢-sem (â†ªáµƒâŸ¨âŸ©-eatË¡â»Ê³ {R}) _ =  âˆ—áµ’-monoË¡ (â¸¨â¸©-â‡’á´® {R}) â€º â†ªáµƒâŸ¨âŸ©áµ’-eatË¡â»Ê³

  -- â†ªáµƒâŸ¨âŸ©-frameË¡ :  PË‚ â†ª[ i ]áµƒâŸ¨ red âŸ© QË‚Ë™  âŠ¢[ âˆ ]
  --                  Â¡á´¾ (R âˆ— PË‚ .!) â†ª[ i ]áµƒâŸ¨ red âŸ© Î» v â†’ Â¡á´¾ (R âˆ— QË‚Ë™ v .!)

  âŠ¢-sem â†ªáµƒâŸ¨âŸ©-frameË¡ _ =  â†ªáµƒâŸ¨âŸ©áµ’-frameË¡

  -- â—‹â‡’â†ªáµƒâŸ¨âŸ© :  PË‚ .!  âˆ—  RË‚ .!  âŠ¢[< âˆ ][ i ]áµƒâŸ¨ red âŸ© (Î» v â†’  QË‚Ë™ v .!)  â†’
  --           â—‹ RË‚  âŠ¢[ âˆ ]  PË‚ â†ª[ i ]áµƒâŸ¨ red âŸ© QË‚Ë™

  âŠ¢-sem (â—‹â‡’â†ªáµƒâŸ¨âŸ© Pâˆ—RâŠ¢âŸ¨redâŸ©Q) _ =  â—‹áµ’â‡’â†ªáµƒâŸ¨âŸ©áµ’ $ Pâˆ—RâŠ¢âŸ¨redâŸ©Q .!

  -- â†ªâŸ¨âŸ©áµ€â‡’â†ªâŸ¨âŸ©á´¾ :  PË‚ â†ªâŸ¨ e âŸ©áµ€[ i ] QË‚Ë™  âŠ¢[ âˆ ]  PË‚ â†ªâŸ¨ e âŸ©á´¾ QË‚Ë™

  âŠ¢-sem â†ªâŸ¨âŸ©áµ€â‡’â†ªâŸ¨âŸ©á´¾ _ =  â†ªâŸ¨âŸ©áµ€áµ’â‡’â†ªâŸ¨âŸ©á´¾áµ’

  -- â†ªâŸ¨âŸ©áµ€-â‰¤ :  i â‰¤ j  â†’   PË‚ â†ªâŸ¨ e âŸ©áµ€[ i ] QË‚Ë™  âŠ¢[ âˆ ]  PË‚ â†ªâŸ¨ e âŸ©áµ€[ j ] QË‚Ë™

  âŠ¢-sem (â†ªâŸ¨âŸ©áµ€-â‰¤ iâ‰¤j) _ =  â†ªâŸ¨âŸ©áµ€áµ’-â‰¤ iâ‰¤j

  -- â†ªâŸ¨âŸ©-eatË¡â»Ë¡áµ˜á´º :  {{Basic R}}  â†’   R  âˆ—  P'Ë‚ .!  âŠ¢[< âˆ ][ i ]â‡›á´º  PË‚ .!  â†’
  --                 R  âˆ—  (PË‚ â†ªâŸ¨ e âŸ©[ Îº ] QË‚Ë™)  âŠ¢[ âˆ ]  P'Ë‚ â†ªâŸ¨ e âŸ©[ Îº ] QË‚Ë™

  âŠ¢-sem (â†ªâŸ¨âŸ©-eatË¡â»Ë¡áµ˜á´º {R} Râˆ—P'âŠ¢â‡›P) _ =
    âˆ—áµ’-monoË¡ (â¸¨â¸©-â‡’á´® {R}) â€º â†ªâŸ¨âŸ©áµ’-eatË¡â»Ë¡áµ˜á´º $ Râˆ—P'âŠ¢â‡›P .!

  -- â†ªâŸ¨âŸ©-monoÊ³áµ˜á´º :  (âˆ€ v â†’  QË‚Ë™ v .!  âŠ¢[< âˆ ][ i ]â‡›á´º  Q'Ë‚Ë™ v .!)  â†’
  --                PË‚ â†ªâŸ¨ e âŸ©[ Îº ] QË‚Ë™  âŠ¢[ âˆ ]  PË‚ â†ªâŸ¨ e âŸ©[ Îº ] Q'Ë‚Ë™

  âŠ¢-sem (â†ªâŸ¨âŸ©-monoÊ³áµ˜á´º âˆ€vQâŠ¢â‡›Q') _ =  â†ªâŸ¨âŸ©áµ’-monoÊ³áµ˜á´º Î» v â†’ âˆ€vQâŠ¢â‡›Q' v .!

  -- â†ªâŸ¨âŸ©-eatË¡â»Ê³ :  {{Basic R}}  â†’
  --   R  âˆ—  (PË‚ â†ªâŸ¨ e âŸ©[ Îº ] QË‚Ë™)  âŠ¢[ âˆ ]  PË‚ â†ªâŸ¨ e âŸ©[ Îº ] Î» v â†’ Â¡á´¾ (R âˆ— QË‚Ë™ v .!)

  âŠ¢-sem (â†ªâŸ¨âŸ©-eatË¡â»Ê³ {R}) _ =  âˆ—áµ’-monoË¡ (â¸¨â¸©-â‡’á´® {R}) â€º â†ªâŸ¨âŸ©áµ’-eatË¡â»Ê³

  -- â†ªâŸ¨âŸ©-frameË¡ :  PË‚ â†ªâŸ¨ e âŸ©[ Îº ] QË‚Ë™  âŠ¢[ âˆ ]
  --                 Â¡á´¾ (R âˆ— PË‚ .!) â†ªâŸ¨ e âŸ©[ Îº ] Î» v â†’ Â¡á´¾ (R âˆ— QË‚Ë™ v .!)

  âŠ¢-sem â†ªâŸ¨âŸ©-frameË¡ _ =  â†ªâŸ¨âŸ©áµ’-frameË¡

  -- â—‹â‡’â†ªâŸ¨âŸ© :  PË‚ .!  âˆ—  RË‚ .! âŠ¢[< âˆ ]âŸ¨ e âŸ©[ Îº ] (Î» v â†’  QË‚Ë™ v .!)  â†’
  --          â—‹ RË‚  âŠ¢[ âˆ ]  PË‚ â†ªâŸ¨ e âŸ©[ Îº ] QË‚Ë™

  âŠ¢-sem (â—‹â‡’â†ªâŸ¨âŸ© Pâˆ—RâŠ¢âŸ¨eâŸ©Q) _ =  â—‹áµ’â‡’â†ªâŸ¨âŸ©áµ’ $ Pâˆ—RâŠ¢âŸ¨eâŸ©Q .!

  -- â†ªâŸ¨âŸ©âˆ-â‰¤ :  i â‰¤ j  â†’   PË‚ â†ª[ i ]âŸ¨ e âŸ©âˆ  âŠ¢[ âˆ ]  PË‚ â†ª[ j ]âŸ¨ e âŸ©âˆ

  âŠ¢-sem (â†ªâŸ¨âŸ©âˆ-â‰¤ iâ‰¤j) _ =  â†ªâŸ¨âŸ©âˆáµ’-â‰¤ iâ‰¤j

  -- â†ªâŸ¨âŸ©âˆ-eatË¡â»áµ˜á´º :  {{Basic R}}  â†’   R  âˆ—  QË‚ .!  âŠ¢[< âˆ ][ i ]â‡›á´º  PË‚ .!  â†’
  --                 R  âˆ—  (PË‚ â†ª[ j ]âŸ¨ e âŸ©âˆ)  âŠ¢[ âˆ ]  QË‚ â†ª[ j ]âŸ¨ e âŸ©âˆ

  âŠ¢-sem (â†ªâŸ¨âŸ©âˆ-eatË¡â»áµ˜á´º {R} Râˆ—QâŠ¢â‡›P) _ =
    âˆ—áµ’-monoË¡ (â¸¨â¸©-â‡’á´® {R}) â€º â†ªâŸ¨âŸ©âˆáµ’-eatË¡â»áµ˜á´º $ Râˆ—QâŠ¢â‡›P .!

  -- â—‹â‡’â†ªâŸ¨âŸ©âˆ :  PË‚ .!  âˆ—  QË‚ .!  âŠ¢[< âˆ ][ i ]âŸ¨ e âŸ©âˆ   â†’
  --           â—‹ QË‚  âŠ¢[ âˆ ]  PË‚ â†ª[ i ]âŸ¨ e âŸ©âˆ

  âŠ¢-sem (â—‹â‡’â†ªâŸ¨âŸ©âˆ Pâˆ—QâŠ¢âŸ¨eâŸ©âˆ) _ =  â—‹áµ’â‡’â†ªâŸ¨âŸ©âˆáµ’ $ Pâˆ—QâŠ¢âŸ¨eâŸ©âˆ .!

  -- &â±-â‡’â–¡ :  &â±âŸ¨ nm âŸ© PË‚  âŠ¢[ âˆ ]  â–¡ &â±âŸ¨ nm âŸ© PË‚

  âŠ¢-sem &â±-â‡’â–¡ _ =  &â±áµ’-â‡’â–¡áµ’

  -- &â±-resp-â–¡âˆ§ :  {{Basic R}}  â†’
  --   R  âˆ§  PË‚ .!  âŠ¢[< âˆ ]  QË‚ .!  â†’   R  âˆ§  QË‚ .!  âŠ¢[< âˆ ]  PË‚ .!  â†’
  --   â–¡ R  âˆ§  &â±âŸ¨ nm âŸ© PË‚  âŠ¢[ âˆ ]  &â±âŸ¨ nm âŸ© QË‚

  âŠ¢-sem (&â±-resp-â–¡âˆ§ {R} Râˆ§PâŠ¢Q Râˆ§QâŠ¢P) âœ“a =
    (Î» â–¡Râˆ§&Pa â†’ â¸¨â¸©-â‡’á´® {R} $ â–¡Râˆ§&Pa 0â‚‚ , â–¡Râˆ§&Pa 1â‚‚) â€º
    &â±áµ’-resp-â–¡áµ’Ã—áµ’ (Râˆ§PâŠ¢Q .!) (Râˆ§QâŠ¢P .!) âœ“a

  -- %â±-mono :  PË‚ .!  âŠ¢[< âˆ ]  QË‚ .!  â†’   %â±âŸ¨ nm âŸ© QË‚  âŠ¢[ âˆ ]  %â±âŸ¨ nm âŸ© PË‚

  âŠ¢-sem (%â±-mono PâŠ¢Q) _ =  %â±áµ’-mono $ PâŠ¢Q .!

  -- %â±-eatË¡ :  {{Basic Q}}  â†’
  --   Q  âˆ—  %â±âŸ¨ nm âŸ© PË‚  âŠ¢[ âˆ ]  %â±âŸ¨ nm âŸ© Â¡á´¾ (Q -âˆ— PË‚ .!)

  âŠ¢-sem (%â±-eatË¡ {Q}) _ =  âˆ—áµ’-monoË¡ (â¸¨â¸©-â‡’á´® {Q}) â€º %â±áµ’-eatË¡

  -- []á´¸âŸ¨âŸ©-resp :  p â‰ˆá´¿âº q  â†’   [ Î± ]á´¸âŸ¨ p âŸ©  âŠ¢[ âˆ ]  [ Î± ]á´¸âŸ¨ q âŸ©

  âŠ¢-sem ([]á´¸âŸ¨âŸ©-resp pâ‰ˆq) _ =  []á´¸âŸ¨âŸ©áµ’-resp pâ‰ˆq

  -- []á´¸âŸ¨âŸ©-merge :  [ Î± ]á´¸âŸ¨ p âŸ©  âˆ—  [ Î± ]á´¸âŸ¨ q âŸ©  âŠ¢[ âˆ ]  [ Î± ]á´¸âŸ¨ p +á´¿âº q âŸ©

  âŠ¢-sem []á´¸âŸ¨âŸ©-merge _ =  []á´¸âŸ¨âŸ©áµ’-merge

  -- []á´¸âŸ¨âŸ©-split :  [ Î± ]á´¸âŸ¨ p +á´¿âº q âŸ©  âŠ¢[ âˆ ]  [ Î± ]á´¸âŸ¨ p âŸ©  âˆ—  [ Î± ]á´¸âŸ¨ q âŸ©

  âŠ¢-sem []á´¸âŸ¨âŸ©-split _ =  []á´¸âŸ¨âŸ©áµ’-split

  -- []á´¸âŸ¨âŸ©-â‰¤1 :  [ Î± ]á´¸âŸ¨ p âŸ©  âŠ¢[ âˆ ]  âŒœ p â‰¤1á´¿âº âŒ

  âŠ¢-sem []á´¸âŸ¨âŸ©-â‰¤1 pâ‰¤1 =  []á´¸âŸ¨âŸ©áµ’-â‰¤1 pâ‰¤1 â€º (_, absurd)

  -- â€ á´¸-â‡’â–¡ :  â€ á´¸ Î±  âŠ¢[ âˆ ]  â–¡ â€ á´¸ Î±

  âŠ¢-sem â€ á´¸-â‡’â–¡ _ =  â€ á´¸áµ’-â‡’â–¡áµ’

  -- []á´¸âŸ¨âŸ©-â€ á´¸-no :  [ Î± ]á´¸âŸ¨ p âŸ©  âˆ—  â€ á´¸ Î±  âŠ¢[ âˆ ]  âŠ¥'

  âŠ¢-sem []á´¸âŸ¨âŸ©-â€ á´¸-no âœ“âˆ™ =  []á´¸âŸ¨âŸ©áµ’-â€ á´¸áµ’-no âœ“âˆ™ â€º Î» ()

  -- []á´¸-new :  âŠ¤'  âŠ¢[ âˆ ] â¤‡  âˆƒ Î± , [ Î± ]á´¸

  âŠ¢-sem []á´¸-new _ _ =  []á´¸áµ’-new

  -- âŸ¨â€ âŸ©-mono :  PË‚ .!  âŠ¢[< âˆ ]  QË‚ .!  â†’   âŸ¨â€  Î± âŸ© PË‚  âŠ¢[ âˆ ]  âŸ¨â€  Î± âŸ© QË‚

  âŠ¢-sem (âŸ¨â€ âŸ©-mono PâŠ¢Q) =  WIP

  -- âŸ¨â€ âŸ©-eatË¡ :  {{Basic Q}}  â†’   Q  âˆ—  âŸ¨â€  Î± âŸ© PË‚  âŠ¢[ âˆ ]  âŸ¨â€  Î± âŸ© Â¡á´¾ (Q âˆ— PË‚ .!)

  âŠ¢-sem âŸ¨â€ âŸ©-eatË¡ =  WIP

  -- &áµ-resp-â–¡âˆ§ :  {{Basic R}}  â†’
  --   R  âˆ§  PË‚ .!  âŠ¢[< âˆ ]  QË‚ .!  â†’   R  âˆ§  QË‚ .!  âŠ¢[< âˆ ]  PË‚ .!  â†’
  --   â–¡ R  âˆ§  &áµâŸ¨ Î± âŸ© PË‚  âŠ¢[ âˆ ]  &áµâŸ¨ Î± âŸ© QË‚

  âŠ¢-sem (&áµ-resp-â–¡âˆ§ Râˆ§PâŠ¢Q Râˆ§QâŠ¢P) =  WIP

  -- %áµ-mono :  PË‚ .!  âŠ¢[< âˆ ]  QË‚ .!  â†’   %áµâŸ¨ Î± âŸ© QË‚  âŠ¢[ âˆ ]  %áµâŸ¨ Î± âŸ© PË‚

  âŠ¢-sem (%áµ-mono PâŠ¢Q) =  WIP

  -- %áµ-eatË¡ :  {{Basic Q}}  â†’
  --   Q  âˆ—  %áµâŸ¨ Î± âŸ© PË‚  âŠ¢[ âˆ ]  %áµâŸ¨ Î± âŸ© Â¡á´¾ (Q -âˆ— PË‚ .!)

  âŠ¢-sem %áµ-eatË¡ =  WIP
