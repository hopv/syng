--------------------------------------------------------------------------------
-- Proof rules on the super-update sequent
--------------------------------------------------------------------------------

{-# OPTIONS --without-K --sized-types #-}

module Syho.Logic.Supd where

open import Base.Func using (_$_; _Рѕў_; id)
open import Base.Size using (­ЮЋі)
open import Base.Nat using (РёЋ; _РЅцрхѕ_; _<рхѕ_; РЅцрхѕ-refl; РЅцрхѕр╣А; _РЅц_; _<_; р╣АРЅцрхѕр╣А; РЅцРЄњРЅцрхѕ)
open import Syho.Logic.Prop using (PropРѕъ; _РѕЌ_; РцЄ_)
open import Syho.Logic.Core using (_Ріб[_]_; РЄњ<; Ріб-refl; _┬╗_; РѕЌ-comm; РѕЌ-assoc╦А;
  РѕЌ-assoc╩│; РцЄ-intro)

-- Import and re-export
open import Syho.Logic.Judg public using ([_]РЄЏ_; _Ріб[_][_]РЄЏ_; _Ріб[<_][_]РЄЏ_;
  _Ріб[_][_]РЄЏр┤║_; _Ріб[<_][_]РЄЏр┤║_; РЄЏ-р╣А; РЄЏ-refl-РцЄ; _рхў┬╗рхў_; РЄЏ-frame╦А)

private variable
  ╬╣ :  ­ЮЋі
  i j :  РёЋ
  P Q R :  PropРѕъ

abstract

  -- Level increment

  -->  РЄЏ-р╣А :  P Ріб[< ╬╣ ][ i ]РЄЏ Q Рєњ  P Ріб[ ╬╣ ][ р╣А i ]РЄЏ Q

  РЄЏ-<рхѕ :  i <рхѕ j Рєњ  P Ріб[< ╬╣ ][ i ]РЄЏ Q Рєњ  P Ріб[ ╬╣ ][ j ]РЄЏ Q
  РЄЏ-<рхѕ РЅцрхѕ-refl =  РЄЏ-р╣А
  РЄЏ-<рхѕ (РЅцрхѕр╣А i<j') =  РЄЏ-р╣А Рѕў РЄњ< Рѕў РЄЏ-<рхѕ i<j'

  РЄЏ-РЅцрхѕ :  i РЅцрхѕ j Рєњ  P Ріб[ ╬╣ ][ i ]РЄЏ Q Рєњ  P Ріб[ ╬╣ ][ j ]РЄЏ Q
  РЄЏ-РЅцрхѕ РЅцрхѕ-refl =  id
  РЄЏ-РЅцрхѕ (РЅцрхѕр╣А iРЅцj') =  РЄЏ-<рхѕ (р╣АРЅцрхѕр╣А iРЅцj') Рѕў РЄњ<

  РЄЏ-< :  i < j Рєњ  P Ріб[< ╬╣ ][ i ]РЄЏ Q Рєњ  P Ріб[ ╬╣ ][ j ]РЄЏ Q
  РЄЏ-< =  РЄЏ-<рхѕ Рѕў РЅцРЄњРЅцрхѕ

  РЄЏ-РЅц :  i РЅц j Рєњ  P Ріб[ ╬╣ ][ i ]РЄЏ Q Рєњ  P Ріб[ ╬╣ ][ j ]РЄЏ Q
  РЄЏ-РЅц =  РЄЏ-РЅцрхѕ Рѕў РЅцРЄњРЅцрхѕ

  -- Reflexivity of РЄЏ

  -->  РЄЏ-refl-РцЄ :  РцЄ P Ріб[ ╬╣ ][ i ]РЄЏ P

  РЄЏ-refl :  P Ріб[ ╬╣ ][ i ]РЄЏ P
  РЄЏ-refl =  РцЄ-intro ┬╗ РЄЏ-refl-РцЄ

  -- Lift Ріб into РібРЄЏ

  РЄњРЄЏ :  P Ріб[ ╬╣ ] Q Рєњ  P Ріб[ ╬╣ ][ i ]РЄЏ Q
  РЄњРЄЏ PРібQ =  PРібQ ┬╗ РЄЏ-refl

  -- Compose РЄЏ

  -->  _рхў┬╗рхў_ :  P Ріб[ ╬╣ ][ i ]РЄЏ Q Рєњ  Q Ріб[ ╬╣ ][ i ]РЄЏ R Рєњ  P Ріб[ ╬╣ ][ i ]РЄЏ R

  infixr -1 _рхў┬╗_

  _рхў┬╗_ :  P Ріб[ ╬╣ ][ i ]РЄЏ Q Рєњ  Q Ріб[ ╬╣ ] R Рєњ  P Ріб[ ╬╣ ][ i ]РЄЏ R
  PРібРЄЏQ рхў┬╗ QРібR =  PРібРЄЏQ рхў┬╗рхў РЄњРЄЏ QРібR

  -- Frame for РЄЏ

  -->  РЄЏ-frame╦А :  P Ріб[ ╬╣ ][ i ]РЄЏ Q Рєњ  R РѕЌ P Ріб[ ╬╣ ][ i ]РЄЏ R РѕЌ Q

  РЄЏ-frame╩│ :  P Ріб[ ╬╣ ][ i ]РЄЏ Q Рєњ  P РѕЌ R Ріб[ ╬╣ ][ i ]РЄЏ Q РѕЌ R
  РЄЏ-frame╩│ PРібРЄЏQ =  РѕЌ-comm ┬╗ РЄЏ-frame╦А PРібРЄЏQ рхў┬╗ РѕЌ-comm

  -- РЄЏ into РЄЏр┤║

  РЄЏРЄњРЄЏр┤║ :  P Ріб[ ╬╣ ][ i ]РЄЏ Q Рєњ  P Ріб[ ╬╣ ][ i ]РЄЏр┤║ Q
  РЄЏРЄњРЄЏр┤║ =  РЄЏ-frame╦А

  -- Reflexivity of РЄЏр┤║

  РЄЏр┤║-refl :  P Ріб[ ╬╣ ][ i ]РЄЏр┤║ P
  РЄЏр┤║-refl =  РЄЏ-refl

  -- Lift a pure sequent into РЄЏр┤║

  РЄњРЄЏр┤║ :  P Ріб[ ╬╣ ] Q Рєњ  P Ріб[ ╬╣ ][ i ]РЄЏр┤║ Q
  РЄњРЄЏр┤║ PРібQ =  РЄЏРЄњРЄЏр┤║ $ РЄњРЄЏ PРібQ

  -- Compose with РЄЏр┤║

  infixr -1 _рхўр┤║┬╗рхўр┤║_ _рхўр┤║┬╗_ _┬╗рхўр┤║_

  _рхўр┤║┬╗рхўр┤║_ :  P Ріб[ ╬╣ ][ i ]РЄЏр┤║ Q Рєњ  Q Ріб[ ╬╣ ][ i ]РЄЏр┤║ R Рєњ  P Ріб[ ╬╣ ][ i ]РЄЏр┤║ R
  _рхўр┤║┬╗рхўр┤║_ =  _рхў┬╗рхў_

  _рхўр┤║┬╗_ :  P Ріб[ ╬╣ ][ i ]РЄЏр┤║ Q Рєњ  Q Ріб[ ╬╣ ] R Рєњ  P Ріб[ ╬╣ ][ i ]РЄЏр┤║ R
  PРібРЄЏQ рхўр┤║┬╗ QРібR =  PРібРЄЏQ рхўр┤║┬╗рхўр┤║ РЄњРЄЏр┤║ QРібR

  _┬╗рхўр┤║_ :  P Ріб[ ╬╣ ] Q Рєњ  Q Ріб[ ╬╣ ][ i ]РЄЏр┤║ R Рєњ  P Ріб[ ╬╣ ][ i ]РЄЏр┤║ R
  PРібQ ┬╗рхўр┤║ QРібРЄЏR =  РЄњРЄЏр┤║ PРібQ рхўр┤║┬╗рхўр┤║ QРібРЄЏR

  -- Frame for РЄЏр┤║

  РЄЏр┤║-frame╩│ :  P Ріб[ ╬╣ ][ i ]РЄЏр┤║ Q Рєњ  P РѕЌ R Ріб[ ╬╣ ][ i ]РЄЏр┤║ Q РѕЌ R
  РЄЏр┤║-frame╩│ PРібРЄЏQ =  РѕЌ-assoc╩│ ┬╗ РЄЏ-frame╩│ PРібРЄЏQ рхў┬╗ РѕЌ-assoc╦А

  РЄЏр┤║-frame╦А :  P Ріб[ ╬╣ ][ i ]РЄЏр┤║ Q Рєњ  R РѕЌ P Ріб[ ╬╣ ][ i ]РЄЏр┤║ R РѕЌ Q
  РЄЏр┤║-frame╦А PРібРЄЏQ =  РѕЌ-comm ┬╗рхўр┤║ РЄЏр┤║-frame╩│ PРібРЄЏQ рхўр┤║┬╗ РѕЌ-comm
