--------------------------------------------------------------------------------
-- Semantic atomic, partial and total weakest preconditions
--------------------------------------------------------------------------------

{-# OPTIONS --without-K --sized-types #-}

module Syho.Model.Hor.Wp where

open import Base.Level using (Level; _âŠ”á´¸_; 1á´¸)
open import Base.Func using (_$_; _â–·_; _âˆ˜_; _â€º_; id)
open import Base.Few using (âŠ¤; absurd)
open import Base.Eq using (_â‰¡_)
open import Base.Size using (Size; Size<; âˆž; !; Â§_)
open import Base.Bool using (ð”¹; tt; ff)
open import Base.Option using (Â¿_; Åˆ; Å¡_)
open import Base.Prod using (_Ã—_; _,_; -,_)
open import Base.Sum using (Ä©â‚€_; Ä©â‚_)
open import Base.Sety using ()
open import Syho.Lang.Expr using (Type; â—¸_; Exprâˆž; Val; Vâ‡’E; Mem)
open import Syho.Lang.Ktxred using (Redex; Ktxred; Val/Ktxred; val/ktxred)
open import Syho.Lang.Reduce using (_â‡á´¿_; _â‡á´·á´¿âŸ¨_âŸ©_; _â‡á´·á´¿_; _â‡’á´¿âˆ‘; _â‡’á´·á´¿âˆ‘)
open import Syho.Model.Prop.Base using (Propáµ’; Monoáµ’; _âŠ¨âœ“_; _âŠ¨_; âŠ¨_; âˆ€áµ’-syntax;
  âˆƒáµ’-syntax; âŠ¤áµ’; âŠ¤áµ’â‚€; âŠ¥áµ’â‚€; âŒœ_âŒáµ’Ã—_; âŒœ_âŒáµ’â†’_; _âˆ—áµ’'_; _âˆ—áµ’_; _-âˆ—áµ’'_; _-âˆ—áµ’_; Thunkáµ’;
  Shrunkáµ’; âŠ¨â‡’âŠ¨âœ“; âˆ€áµ’-Mono; âˆ—áµ’â‡’âˆ—áµ’'; âˆ—áµ’'â‡’âˆ—áµ’; âˆ—áµ’-Mono; âˆ—áµ’-mono; âˆ—áµ’-monoâœ“Ë¡; âˆ—áµ’-monoË¡;
  âˆ—áµ’-monoÊ³; âˆ—áµ’-assocÊ³; ?âˆ—áµ’-comm; ?âˆ—áµ’-intro; âˆ—áµ’âˆƒáµ’-out; -âˆ—áµ’â‡’-âˆ—áµ’'; -âˆ—áµ’'â‡’-âˆ—áµ’;
  -âˆ—áµ’-Mono; -âˆ—áµ’-monoÊ³; âŠ¨âœ“â‡’âŠ¨--âˆ—áµ’; -âˆ—áµ’-applyË¡; -âˆ—áµ’-eatË¡; â—Ž-Mono; âˆ—áµ’Thunkáµ’-out;
  âˆ—áµ’Shrunkáµ’-out)
open import Syho.Model.Prop.Names using ([âŠ¤]á´ºáµ’)
open import Syho.Model.Supd.Interp using (âŸ¨_âŸ©â‡›á´¹'âŸ¨_âŸ©_; âŸ¨_âŸ©â‡›á´¹âŸ¨_âŸ©_; â‡›áµ’_; â‡›á´ºáµ’_;
  â‡›á´¹â‡’â‡›á´¹'; â‡›á´¹'â‡’â‡›á´¹; â‡›á´¹-Mono; â‡›áµ’-Mono; â‡›á´¹-monoâœ“; â‡›á´¹-mono; â‡›áµ’-monoâœ“; â‡›áµ’-mono;
  â‡›á´ºáµ’-monoâœ“; â‡›á´ºáµ’-mono; âŠ¨âœ“â‡’âŠ¨-â‡›á´¹; â‡›á´ºáµ’-intro; â‡›á´¹-join; â‡›á´ºáµ’-join; â‡›á´¹-eatË¡; â‡›á´ºáµ’-eatË¡;
  â‡›áµ’â‡’â‡›á´ºáµ’)

private variable
  Å‚ :  Level
  Î¹ Î¹' :  Size
  b :  ð”¹
  X :  Setâ‚€
  T :  Type
  Páµ’ Qáµ’ :  Propáµ’ Å‚
  Páµ’Ë™ Qáµ’Ë™ :  X â†’ Propáµ’ Å‚
  v :  X
  red :  Redex T
  kr :  Ktxred T
  vk :  Val/Ktxred T
  e :  Exprâˆž T
  eË‡ :  Â¿ Exprâˆž T

--------------------------------------------------------------------------------
-- áµƒâŸ¨ âŸ©áµ’ :  Semantic atomic weakest precondition

áµƒâŸ¨_âŸ©áµ’ :  Redex T â†’  (Val T â†’ Propáµ’ Å‚) â†’  Propáµ’ (1á´¸ âŠ”á´¸ Å‚)
áµƒâŸ¨ red âŸ©áµ’ Páµ’Ë™ =  âˆ€áµ’ M , âŸ¨ M âŸ©â‡›á´¹âŸ¨ M âŸ© âŒœ (red , M) â‡’á´¿âˆ‘ âŒáµ’Ã—
                   âˆ€áµ’ e , âˆ€áµ’ eË‡ , âˆ€áµ’ M' , âŒœ (e , eË‡ , M') â‡á´¿ (red , M) âŒáµ’â†’
                     âˆƒáµ’ v , âŒœ e â‰¡ Vâ‡’E v Ã— eË‡ â‰¡ Åˆ âŒáµ’Ã—  âŸ¨ M âŸ©â‡›á´¹âŸ¨ M' âŸ©  Páµ’Ë™ v

--------------------------------------------------------------------------------
-- âºâŸ¨ âŸ©á´¾áµ’ etc. :  Semantic partial weakest precondition

-- Wpá´¾ :  âºâŸ¨ âŸ©á´¾áµ’ with the arguments re-ordered

data  Wpá´¾ (Páµ’Ë™ : Val T â†’ Propáµ’ Å‚) (Î¹ : Size) :  Val/Ktxred T â†’  Propáµ’ (1á´¸ âŠ”á´¸ Å‚)

-- âºâŸ¨ âŸ©á´¾áµ’ :  Semantic partial weakest precondition on Val/Ktxred
-- âŸ¨ âŸ©á´¾áµ’ :  âºâŸ¨ âŸ©á´¾áµ’ on Expr
-- âŸ¨ âŸ©á´¾áµ’Ë‚ :  âŸ¨ âŸ©á´¾áµ’Ë‚ under Thunk

âºâŸ¨_âŸ©á´¾áµ’ :  Val/Ktxred T â†’  Size â†’  (Val T â†’ Propáµ’ Å‚) â†’  Propáµ’ (1á´¸ âŠ”á´¸ Å‚)
âºâŸ¨ kr âŸ©á´¾áµ’ Î¹ Páµ’Ë™ =  Wpá´¾ Páµ’Ë™ Î¹ kr

âŸ¨_âŸ©á´¾áµ’ âŸ¨_âŸ©á´¾áµ’Ë‚ :  Exprâˆž T â†’  Size â†’  (Val T â†’ Propáµ’ Å‚) â†’  Propáµ’ (1á´¸ âŠ”á´¸ Å‚)
âŸ¨ e âŸ©á´¾áµ’ Î¹ Páµ’Ë™ =  âºâŸ¨ val/ktxred e âŸ©á´¾áµ’ Î¹ Páµ’Ë™
âŸ¨ e âŸ©á´¾áµ’Ë‚ Î¹ Páµ’Ë™ =  Thunkáµ’ (Î» Î¹' â†’ âŸ¨ e âŸ©á´¾áµ’ Î¹' Páµ’Ë™) Î¹

-- âºâŸ¨ âŸ©á´¾áµ’âŠ¤ :  Semantic partial weakest precondition on Val/Ktxred,
--               without the postcondition, used for forked threads

-- Wpá´¾âŠ¤ :  âºâŸ¨ âŸ©á´¾áµ’âŠ¤ with the arguments re-ordered

data  Wpá´¾âŠ¤ (Î¹ : Size) :  Val/Ktxred (â—¸ âŠ¤) â†’  Propáµ’ 1á´¸

âºâŸ¨_âŸ©á´¾áµ’âŠ¤ :  Val/Ktxred (â—¸ âŠ¤) â†’  Size â†’  Propáµ’ 1á´¸
âºâŸ¨ vk âŸ©á´¾áµ’âŠ¤ Î¹ =  Wpá´¾âŠ¤ Î¹ vk

-- âŸ¨ âŸ©á´¾áµ’âŠ¤ :  âºâŸ¨ âŸ©á´¾áµ’âŠ¤ on Expr
-- âŸ¨ âŸ©á´¾áµ’âŠ¤Ë‚ :  âŸ¨ âŸ©á´¾áµ’âŠ¤ under Thunk
-- âŸ¨Â¿ âŸ©á´¾áµ’âŠ¤Ë‚ :  âŸ¨ âŸ©á´¾áµ’âŠ¤Ë‚ for Â¿ Expr

âŸ¨_âŸ©á´¾áµ’âŠ¤ âŸ¨_âŸ©á´¾áµ’âŠ¤Ë‚ :  Exprâˆž (â—¸ âŠ¤) â†’  Size â†’  Propáµ’ 1á´¸
âŸ¨ e âŸ©á´¾áµ’âŠ¤ Î¹ =  âºâŸ¨ val/ktxred e âŸ©á´¾áµ’âŠ¤ Î¹
âŸ¨ e âŸ©á´¾áµ’âŠ¤Ë‚ Î¹ =  Thunkáµ’ âŸ¨ e âŸ©á´¾áµ’âŠ¤ Î¹

âŸ¨Â¿_âŸ©á´¾áµ’âŠ¤Ë‚ :  Â¿ Exprâˆž (â—¸ âŠ¤) â†’  Size â†’  Propáµ’ 1á´¸
âŸ¨Â¿ Åˆ âŸ©á´¾áµ’âŠ¤Ë‚ _ =  âŠ¤áµ’
âŸ¨Â¿ Å¡ e âŸ©á´¾áµ’âŠ¤Ë‚ Î¹ =  âŸ¨ e âŸ©á´¾áµ’âŠ¤Ë‚ Î¹

data  Wpá´¾âŠ¤ Î¹  where

  -- For a value

  âºâŸ¨âŸ©á´¾áµ’âŠ¤-val :  âŠ¨  âºâŸ¨ Ä©â‚€ v âŸ©á´¾áµ’âŠ¤ Î¹

  -- For a context-redex pair (c.f. âºâŸ¨âŸ©á´¾áµ’-kr')

  âºâŸ¨âŸ©á´¾áµ’âŠ¤-kr' :  [âŠ¤]á´ºáµ’ -âˆ—áµ’' âˆ€áµ’ M , âŸ¨ M âŸ©â‡›á´¹'âŸ¨ M âŸ© âŒœ (kr , M) â‡’á´·á´¿âˆ‘ âŒáµ’Ã—
                  âˆ€áµ’ e , âˆ€áµ’ eË‡ , âˆ€áµ’ M' , âŒœ (e , eË‡ , M') â‡á´·á´¿ (kr , M) âŒáµ’â†’
                    âŸ¨ M âŸ©â‡›á´¹'âŸ¨ M' âŸ© [âŠ¤]á´ºáµ’ âˆ—áµ’' âŸ¨ e âŸ©á´¾áµ’âŠ¤Ë‚ Î¹ âˆ—áµ’' âŸ¨Â¿ eË‡ âŸ©á´¾áµ’âŠ¤Ë‚ Î¹  âŠ¨
                âºâŸ¨ Ä©â‚ kr âŸ©á´¾áµ’âŠ¤ Î¹

-- Define Wpá´¾

data  Wpá´¾ Páµ’Ë™ Î¹  where

  -- For a value, having the postcondition under â‡›á´¹

  âºâŸ¨âŸ©á´¾áµ’-val :  â‡›á´ºáµ’ Páµ’Ë™ v  âŠ¨  âºâŸ¨ Ä©â‚€ v âŸ©á´¾áµ’ Î¹ Páµ’Ë™

  -- For a context-redex pair, stating that the reduction is not stuck
  -- and for every next state the weakest precondition coinductively holds

  -- We should use â‡›á´¹' (the concrete version) instead of â‡›á´¹ (the abstract
  -- version) here to pass the strict positivity check

  âºâŸ¨âŸ©á´¾áµ’-kr' :  [âŠ¤]á´ºáµ’ -âˆ—áµ’' âˆ€áµ’ M , âŸ¨ M âŸ©â‡›á´¹'âŸ¨ M âŸ© âŒœ (kr , M) â‡’á´·á´¿âˆ‘ âŒáµ’Ã—
                 âˆ€áµ’ e , âˆ€áµ’ eË‡ , âˆ€áµ’ M' , âŒœ (e , eË‡ , M') â‡á´·á´¿ (kr , M) âŒáµ’â†’
                   âŸ¨ M âŸ©â‡›á´¹'âŸ¨ M' âŸ© [âŠ¤]á´ºáµ’ âˆ—áµ’' âŸ¨ e âŸ©á´¾áµ’Ë‚ Î¹ Páµ’Ë™ âˆ—áµ’' âŸ¨Â¿ eË‡ âŸ©á´¾áµ’âŠ¤Ë‚ Î¹  âŠ¨
               âºâŸ¨ Ä©â‚ kr âŸ©á´¾áµ’ Î¹ Páµ’Ë™

--------------------------------------------------------------------------------
-- âºâŸ¨ âŸ©áµ€áµ’ etc. :  Semantic total weakest precondition

-- Wpáµ€ :  âºâŸ¨ âŸ©áµ€áµ’ with the arguments re-ordered

data  Wpáµ€ (Páµ’Ë™ : Val T â†’ Propáµ’ Å‚) (Î¹ : Size) :  Val/Ktxred T â†’  Propáµ’ (1á´¸ âŠ”á´¸ Å‚)

-- âºâŸ¨ âŸ©áµ€áµ’ :  Semantic total weakest precondition on Val/Ktxred
-- âŸ¨ âŸ©áµ€áµ’ :  âºâŸ¨ âŸ©áµ€áµ’ on Expr
-- âŸ¨ âŸ©Ë‚áµ€áµ’ :  âŸ¨ âŸ©áµ€áµ’ under Shrunk

-- We use Shrunk here for induction based semantically on the size, rather than
-- only on the syntactic structure.

âºâŸ¨_âŸ©áµ€áµ’ :  Val/Ktxred T â†’  Size â†’  (Val T â†’ Propáµ’ Å‚) â†’  Propáµ’ (1á´¸ âŠ”á´¸ Å‚)
âºâŸ¨ kr âŸ©áµ€áµ’ Î¹ Páµ’Ë™ =  Wpáµ€ Páµ’Ë™ Î¹ kr

âŸ¨_âŸ©áµ€áµ’ âŸ¨_âŸ©áµ€áµ’Ë‚ :  Exprâˆž T â†’  Size â†’  (Val T â†’ Propáµ’ Å‚) â†’  Propáµ’ (1á´¸ âŠ”á´¸ Å‚)
âŸ¨ e âŸ©áµ€áµ’ Î¹ Páµ’Ë™ =  âºâŸ¨ val/ktxred e âŸ©áµ€áµ’ Î¹ Páµ’Ë™
âŸ¨ e âŸ©áµ€áµ’Ë‚ Î¹ Páµ’Ë™ =  Shrunkáµ’ (Î» Î¹' â†’ âŸ¨ e âŸ©áµ€áµ’ Î¹' Páµ’Ë™) Î¹

-- âºâŸ¨ âŸ©áµ€áµ’âŠ¤ :  Semantic total total precondition on Val/Ktxred,
--               without the postcondition, used for forked threads

-- Wpáµ€âŠ¤ :  âºâŸ¨ âŸ©áµ€áµ’âŠ¤ with the arguments re-ordered

data  Wpáµ€âŠ¤ (Î¹ : Size) :  Val/Ktxred (â—¸ âŠ¤) â†’  Propáµ’ 1á´¸

âºâŸ¨_âŸ©áµ€áµ’âŠ¤ :  Val/Ktxred (â—¸ âŠ¤) â†’  Size â†’  Propáµ’ 1á´¸
âºâŸ¨ vk âŸ©áµ€áµ’âŠ¤ Î¹ =  Wpáµ€âŠ¤ Î¹ vk

-- âŸ¨ âŸ©áµ€áµ’âŠ¤ :  âºâŸ¨ âŸ©áµ€áµ’âŠ¤ on Expr
-- âŸ¨ âŸ©áµ€áµ’âŠ¤Ë‚ :  âŸ¨ âŸ©áµ€áµ’âŠ¤ under Shrunk
-- âŸ¨Â¿ âŸ©á´¾áµ’âŠ¤Ë‚ :  âŸ¨ âŸ©á´¾áµ’âŠ¤Ë‚ for Â¿ Expr

âŸ¨_âŸ©áµ€áµ’âŠ¤ âŸ¨_âŸ©áµ€áµ’âŠ¤Ë‚ :  Exprâˆž (â—¸ âŠ¤) â†’  Size â†’  Propáµ’ 1á´¸
âŸ¨ e âŸ©áµ€áµ’âŠ¤ Î¹ =  âºâŸ¨ val/ktxred e âŸ©áµ€áµ’âŠ¤ Î¹
âŸ¨ e âŸ©áµ€áµ’âŠ¤Ë‚ Î¹ =  Shrunkáµ’ âŸ¨ e âŸ©áµ€áµ’âŠ¤ Î¹

âŸ¨Â¿_âŸ©áµ€áµ’âŠ¤Ë‚ :  Â¿ Exprâˆž (â—¸ âŠ¤) â†’  Size â†’  Propáµ’ 1á´¸
âŸ¨Â¿ Åˆ âŸ©áµ€áµ’âŠ¤Ë‚ _ =  âŠ¤áµ’
âŸ¨Â¿ Å¡ e âŸ©áµ€áµ’âŠ¤Ë‚ Î¹ =  âŸ¨ e âŸ©áµ€áµ’âŠ¤Ë‚ Î¹

data  Wpáµ€âŠ¤ Î¹  where

  -- For a value

  âºâŸ¨âŸ©áµ€áµ’âŠ¤-val :  âŠ¨  âºâŸ¨ Ä©â‚€ v âŸ©áµ€áµ’âŠ¤ Î¹

  -- For a context-redex pair (c.f. âºâŸ¨âŸ©áµ€áµ’-kr')

  âºâŸ¨âŸ©áµ€áµ’âŠ¤-kr' :  [âŠ¤]á´ºáµ’ -âˆ—áµ’' âˆ€áµ’ M , âŸ¨ M âŸ©â‡›á´¹'âŸ¨ M âŸ© âŒœ (kr , M) â‡’á´·á´¿âˆ‘ âŒáµ’Ã—
                  âˆ€áµ’ e , âˆ€áµ’ eË‡ , âˆ€áµ’ M' , âŒœ (e , eË‡ , M') â‡á´·á´¿ (kr , M) âŒáµ’â†’
                    âŸ¨ M âŸ©â‡›á´¹'âŸ¨ M' âŸ© [âŠ¤]á´ºáµ’ âˆ—áµ’' âŸ¨ e âŸ©áµ€áµ’âŠ¤Ë‚ Î¹ âˆ—áµ’' âŸ¨Â¿ eË‡ âŸ©áµ€áµ’âŠ¤Ë‚ Î¹  âŠ¨
                âºâŸ¨ Ä©â‚ kr âŸ©áµ€áµ’âŠ¤ Î¹

-- Define Wpáµ€

data  Wpáµ€ Páµ’Ë™ Î¹  where

  -- For a value, having the postcondition under â‡›á´¹

  âºâŸ¨âŸ©áµ€áµ’-val :  â‡›á´ºáµ’ Páµ’Ë™ v  âŠ¨  âºâŸ¨ Ä©â‚€ v âŸ©áµ€áµ’ Î¹ Páµ’Ë™

  -- For a context-redex pair, stating that the reduction is not stuck
  -- and for every next state the weakest precondition inductively holds

  âºâŸ¨âŸ©áµ€áµ’-kr' :  [âŠ¤]á´ºáµ’ -âˆ—áµ’' âˆ€áµ’ M , âŸ¨ M âŸ©â‡›á´¹'âŸ¨ M âŸ© âŒœ (kr , M) â‡’á´·á´¿âˆ‘ âŒáµ’Ã—
                 âˆ€áµ’ e , âˆ€áµ’ eË‡ , âˆ€áµ’ M' , âŒœ (e , eË‡ , M') â‡á´·á´¿ (kr , M) âŒáµ’â†’
                   âŸ¨ M âŸ©â‡›á´¹'âŸ¨ M' âŸ© [âŠ¤]á´ºáµ’ âˆ—áµ’' âŸ¨ e âŸ©áµ€áµ’Ë‚ Î¹ Páµ’Ë™ âˆ—áµ’' âŸ¨Â¿ eË‡ âŸ©áµ€áµ’âŠ¤Ë‚ Î¹  âŠ¨
               âºâŸ¨ Ä©â‚ kr âŸ©áµ€áµ’ Î¹ Páµ’Ë™

--------------------------------------------------------------------------------
-- âºâŸ¨ âŸ©âˆžáµ’ etc. :  Semantic infinite weakest precondition

-- Wpâˆž :  âºâŸ¨ âŸ©âˆžáµ’ with the arguments re-ordered

data  Wpâˆž {T} (Î¹ Î¹' : Size) :  Val/Ktxred T â†’  Propáµ’ 1á´¸

-- âºâŸ¨ âŸ©âˆžáµ’ :  Semantic total weakest precondition on Val/Ktxred
-- âŸ¨ âŸ©âˆžáµ’ :  âºâŸ¨ âŸ©âˆžáµ’ on Expr
-- âŸ¨ âŸ©âˆžáµ’Ë‚Ë¡ :  âŸ¨ âŸ©âˆžáµ’ under Shrunk for the left-hand size
-- âŸ¨ âŸ©âˆžáµ’Ë‚Ê³ :  âŸ¨ âŸ©âˆžáµ’ under Thunk for the right-hand size,
--            resetting the right-hand size to âˆž
-- âŸ¨ âŸ©âˆžáµ’Ë‚âŸ¨ âŸ© :  âŸ¨ âŸ©âˆžáµ’Ë‚Ë¡ or âŸ¨ âŸ©âˆžáµ’Ë‚Ê³, depending on the boolean argument

âºâŸ¨_âŸ©âˆžáµ’ :  Val/Ktxred T â†’  Size â†’  Size â†’  Propáµ’ 1á´¸
âºâŸ¨ kr âŸ©âˆžáµ’ Î¹ Î¹' =  Wpâˆž Î¹ Î¹' kr

âŸ¨_âŸ©âˆžáµ’ âŸ¨_âŸ©âˆžáµ’Ë‚Ë¡ :  Exprâˆž T â†’  Size â†’  Size â†’  Propáµ’ 1á´¸
âŸ¨ e âŸ©âˆžáµ’ Î¹ Î¹' =  âºâŸ¨ val/ktxred e âŸ©âˆžáµ’ Î¹ Î¹'
âŸ¨ e âŸ©âˆžáµ’Ë‚Ë¡ Î¹ Î¹' =  Shrunkáµ’ (Î» Î¹â» â†’ âŸ¨ e âŸ©âˆžáµ’ Î¹â» Î¹') Î¹

âŸ¨_âŸ©âˆžáµ’Ë‚Ê³ :  Exprâˆž T â†’  Size â†’  Propáµ’ 1á´¸
âŸ¨ e âŸ©âˆžáµ’Ë‚Ê³ Î¹' =  Thunkáµ’ (âŸ¨ e âŸ©âˆžáµ’ âˆž) Î¹'

âŸ¨_âŸ©âˆžáµ’Ë‚âŸ¨_âŸ© :  Exprâˆž T â†’  ð”¹ â†’  Size â†’  Size â†’  Propáµ’ 1á´¸
âŸ¨ e âŸ©âˆžáµ’Ë‚âŸ¨ ff âŸ© Î¹ Î¹' =  âŸ¨ e âŸ©âˆžáµ’Ë‚Ë¡ Î¹ Î¹'
âŸ¨ e âŸ©âˆžáµ’Ë‚âŸ¨ tt âŸ© _ Î¹' =  âŸ¨ e âŸ©âˆžáµ’Ë‚Ê³ Î¹'

-- Define Wpâˆž

data  Wpâˆž Î¹ Î¹'  where

  -- For a value, having âŠ¥áµ’â‚€ under â‡›á´¹

  âºâŸ¨âŸ©âˆžáµ’-val :  â‡›á´ºáµ’ âŠ¥áµ’â‚€  âŠ¨  âºâŸ¨ Ä©â‚€ v âŸ©âˆžáµ’ Î¹ Î¹'

  -- For a context-redex pair, stating that the reduction is not stuck and,
  -- for every next state without or with the event, the weakest precondition
  -- holds inductively or coinductively, respectively

  âºâŸ¨âŸ©âˆžáµ’-kr' :  [âŠ¤]á´ºáµ’ -âˆ—áµ’' âˆ€áµ’ M , âŸ¨ M âŸ©â‡›á´¹'âŸ¨ M âŸ© âŒœ (kr , M) â‡’á´·á´¿âˆ‘ âŒáµ’Ã—
                 âˆ€áµ’ e , âˆ€áµ’ eË‡ , âˆ€áµ’ M' , âˆ€áµ’ b ,
                   âŒœ (e , eË‡ , M') â‡á´·á´¿âŸ¨ b âŸ© (kr , M) âŒáµ’â†’ âŸ¨ M âŸ©â‡›á´¹'âŸ¨ M' âŸ©
                     [âŠ¤]á´ºáµ’ âˆ—áµ’' âŸ¨ e âŸ©âˆžáµ’Ë‚âŸ¨ b âŸ© Î¹ Î¹' âˆ—áµ’' âŸ¨Â¿ eË‡ âŸ©áµ€áµ’âŠ¤Ë‚ Î¹  âŠ¨
               âºâŸ¨ Ä©â‚ kr âŸ©âˆžáµ’ Î¹ Î¹'

--------------------------------------------------------------------------------
-- Lemmas on the atomic, partial, total, and infinite weakest preconditions

abstract

  -- Invert âºâŸ¨âŸ©á´¾/áµ€áµ’-val and âºâŸ¨âŸ©âˆžáµ’-val

  âºâŸ¨âŸ©á´¾áµ’-valâ»Â¹ :  âºâŸ¨ Ä©â‚€ v âŸ©á´¾áµ’ Î¹ Páµ’Ë™  âŠ¨ â‡›á´ºáµ’  Páµ’Ë™ v
  âºâŸ¨âŸ©á´¾áµ’-valâ»Â¹ (âºâŸ¨âŸ©á´¾áµ’-val â‡›Pv) =  â‡›Pv

  âºâŸ¨âŸ©áµ€áµ’-valâ»Â¹ :  âºâŸ¨ Ä©â‚€ v âŸ©áµ€áµ’ Î¹ Páµ’Ë™  âŠ¨ â‡›á´ºáµ’  Páµ’Ë™ v
  âºâŸ¨âŸ©áµ€áµ’-valâ»Â¹ (âºâŸ¨âŸ©áµ€áµ’-val â‡›Pv) =  â‡›Pv

  âºâŸ¨âŸ©âˆžáµ’-valâ»Â¹ :  âºâŸ¨ Ä©â‚€ v âŸ©âˆžáµ’ Î¹ Î¹'  âŠ¨ â‡›á´ºáµ’  âŠ¥áµ’â‚€
  âºâŸ¨âŸ©âˆžáµ’-valâ»Â¹ (âºâŸ¨âŸ©âˆžáµ’-val â‡›âŠ¥) =  â‡›âŠ¥

  -- Modified âºâŸ¨âŸ©á´¾/áµ€áµ’-kr' and âºâŸ¨âŸ©âˆžáµ’-kr'

  âºâŸ¨âŸ©á´¾áµ’-kr :  [âŠ¤]á´ºáµ’ -âˆ—áµ’ âˆ€áµ’ M , âŸ¨ M âŸ©â‡›á´¹âŸ¨ M âŸ© âŒœ (kr , M) â‡’á´·á´¿âˆ‘ âŒáµ’Ã—
                âˆ€áµ’ e , âˆ€áµ’ eË‡ , âˆ€áµ’ M' , âŒœ (e , eË‡ , M') â‡á´·á´¿ (kr , M) âŒáµ’â†’
                  âŸ¨ M âŸ©â‡›á´¹âŸ¨ M' âŸ© [âŠ¤]á´ºáµ’ âˆ—áµ’ âŸ¨ e âŸ©á´¾áµ’Ë‚ Î¹ Páµ’Ë™ âˆ—áµ’ âŸ¨Â¿ eË‡ âŸ©á´¾áµ’âŠ¤Ë‚ Î¹  âŠ¨
              âºâŸ¨ Ä©â‚ kr âŸ©á´¾áµ’ Î¹ Páµ’Ë™
  âºâŸ¨âŸ©á´¾áµ’-kr big =  âºâŸ¨âŸ©á´¾áµ’-kr' $ big â–· -âˆ—áµ’-monoÊ³ (Î» big M â†’ big M â–· (â‡›á´¹-mono
    Î» (krMâ‡’ , big) â†’ krMâ‡’ , Î» e eË‡ M' eeË‡M'â‡ â†’ big e eË‡ M' eeË‡M'â‡ â–·
    â‡›á´¹-mono (âˆ—áµ’-monoÊ³ âˆ—áµ’â‡’âˆ—áµ’' â€º âˆ—áµ’â‡’âˆ—áµ’') â–· â‡›á´¹â‡’â‡›á´¹') â–· â‡›á´¹â‡’â‡›á´¹') â–· -âˆ—áµ’â‡’-âˆ—áµ’'

  âºâŸ¨âŸ©áµ€áµ’-kr :  [âŠ¤]á´ºáµ’ -âˆ—áµ’ âˆ€áµ’ M , âŸ¨ M âŸ©â‡›á´¹âŸ¨ M âŸ© âŒœ (kr , M) â‡’á´·á´¿âˆ‘ âŒáµ’Ã—
                âˆ€áµ’ e , âˆ€áµ’ eË‡ , âˆ€áµ’ M' , âŒœ (e , eË‡ , M') â‡á´·á´¿ (kr , M) âŒáµ’â†’
                  âŸ¨ M âŸ©â‡›á´¹âŸ¨ M' âŸ© [âŠ¤]á´ºáµ’ âˆ—áµ’ âŸ¨ e âŸ©áµ€áµ’Ë‚ Î¹ Páµ’Ë™ âˆ—áµ’ âŸ¨Â¿ eË‡ âŸ©áµ€áµ’âŠ¤Ë‚ Î¹  âŠ¨
              âºâŸ¨ Ä©â‚ kr âŸ©áµ€áµ’ Î¹ Páµ’Ë™
  âºâŸ¨âŸ©áµ€áµ’-kr big =  âºâŸ¨âŸ©áµ€áµ’-kr' $ big â–· -âˆ—áµ’-monoÊ³ (Î» big M â†’ big M â–· (â‡›á´¹-mono
    Î» (krMâ‡’ , big) â†’ krMâ‡’ , Î» e eË‡ M' eeË‡M'â‡ â†’ big e eË‡ M' eeË‡M'â‡ â–·
    â‡›á´¹-mono (âˆ—áµ’-monoÊ³ âˆ—áµ’â‡’âˆ—áµ’' â€º âˆ—áµ’â‡’âˆ—áµ’') â–· â‡›á´¹â‡’â‡›á´¹') â–· â‡›á´¹â‡’â‡›á´¹') â–· -âˆ—áµ’â‡’-âˆ—áµ’'

  âºâŸ¨âŸ©âˆžáµ’-kr :  [âŠ¤]á´ºáµ’ -âˆ—áµ’ âˆ€áµ’ M , âŸ¨ M âŸ©â‡›á´¹âŸ¨ M âŸ© âŒœ (kr , M) â‡’á´·á´¿âˆ‘ âŒáµ’Ã—
                âˆ€áµ’ e , âˆ€áµ’ eË‡ , âˆ€áµ’ M' , âˆ€áµ’ b ,
                  âŒœ (e , eË‡ , M') â‡á´·á´¿âŸ¨ b âŸ© (kr , M) âŒáµ’â†’ âŸ¨ M âŸ©â‡›á´¹âŸ¨ M' âŸ©
                    [âŠ¤]á´ºáµ’ âˆ—áµ’ âŸ¨ e âŸ©âˆžáµ’Ë‚âŸ¨ b âŸ© Î¹ Î¹' âˆ—áµ’ âŸ¨Â¿ eË‡ âŸ©áµ€áµ’âŠ¤Ë‚ Î¹  âŠ¨
              âºâŸ¨ Ä©â‚ kr âŸ©âˆžáµ’ Î¹ Î¹'
  âºâŸ¨âŸ©âˆžáµ’-kr big =  âºâŸ¨âŸ©âˆžáµ’-kr' $ big â–· -âˆ—áµ’-monoÊ³ (Î» big M â†’ big M â–· (â‡›á´¹-mono
    Î» (krMâ‡’ , big) â†’ krMâ‡’ , Î» e eË‡ M' b eeË‡M'â‡âŸ¨bâŸ© â†’ big e eË‡ M' b eeË‡M'â‡âŸ¨bâŸ© â–·
    â‡›á´¹-mono (âˆ—áµ’-monoÊ³ âˆ—áµ’â‡’âˆ—áµ’' â€º âˆ—áµ’â‡’âˆ—áµ’') â–· â‡›á´¹â‡’â‡›á´¹') â–· â‡›á´¹â‡’â‡›á´¹') â–· -âˆ—áµ’â‡’-âˆ—áµ’'

  -- Invert âºâŸ¨âŸ©á´¾/áµ€áµ’-kr

  âºâŸ¨âŸ©á´¾áµ’-krâ»Â¹ :  âºâŸ¨ Ä©â‚ kr âŸ©á´¾áµ’ Î¹ Páµ’Ë™  âŠ¨
                [âŠ¤]á´ºáµ’ -âˆ—áµ’ âˆ€áµ’ M , âŸ¨ M âŸ©â‡›á´¹âŸ¨ M âŸ© âŒœ (kr , M) â‡’á´·á´¿âˆ‘ âŒáµ’Ã—
                  âˆ€áµ’ e , âˆ€áµ’ eË‡ , âˆ€áµ’ M' , âŒœ (e , eË‡ , M') â‡á´·á´¿ (kr , M) âŒáµ’â†’
                    âŸ¨ M âŸ©â‡›á´¹âŸ¨ M' âŸ© [âŠ¤]á´ºáµ’ âˆ—áµ’ âŸ¨ e âŸ©á´¾áµ’Ë‚ Î¹ Páµ’Ë™ âˆ—áµ’ âŸ¨Â¿ eË‡ âŸ©á´¾áµ’âŠ¤Ë‚ Î¹
  âºâŸ¨âŸ©á´¾áµ’-krâ»Â¹ (âºâŸ¨âŸ©á´¾áµ’-kr' big) =  big â–· -âˆ—áµ’'â‡’-âˆ—áµ’ {Qáµ’ = âˆ€áµ’ M , âŸ¨ M âŸ©â‡›á´¹'âŸ¨ M âŸ© _} â–·
    -âˆ—áµ’-monoÊ³ Î» big M â†’ big M â–· â‡›á´¹'â‡’â‡›á´¹ â–· â‡›á´¹-mono Î» (krMâ‡’ , big) â†’ krMâ‡’ ,
    Î» e eË‡ M' eeË‡M'â‡ â†’ big e eË‡ M' eeË‡M'â‡ â–· â‡›á´¹'â‡’â‡›á´¹ â–·
    â‡›á´¹-mono (âˆ—áµ’'â‡’âˆ—áµ’ â€º âˆ—áµ’-monoÊ³ âˆ—áµ’'â‡’âˆ—áµ’)

  âºâŸ¨âŸ©áµ€áµ’-krâ»Â¹ :  âºâŸ¨ Ä©â‚ kr âŸ©áµ€áµ’ Î¹ Páµ’Ë™  âŠ¨
                [âŠ¤]á´ºáµ’ -âˆ—áµ’ âˆ€áµ’ M , âŸ¨ M âŸ©â‡›á´¹âŸ¨ M âŸ© âŒœ (kr , M) â‡’á´·á´¿âˆ‘ âŒáµ’Ã—
                  âˆ€áµ’ e , âˆ€áµ’ eË‡ , âˆ€áµ’ M' , âŒœ (e , eË‡ , M') â‡á´·á´¿ (kr , M) âŒáµ’â†’
                    âŸ¨ M âŸ©â‡›á´¹âŸ¨ M' âŸ© [âŠ¤]á´ºáµ’ âˆ—áµ’ âŸ¨ e âŸ©áµ€áµ’Ë‚ Î¹ Páµ’Ë™ âˆ—áµ’ âŸ¨Â¿ eË‡ âŸ©áµ€áµ’âŠ¤Ë‚ Î¹
  âºâŸ¨âŸ©áµ€áµ’-krâ»Â¹ (âºâŸ¨âŸ©áµ€áµ’-kr' big) =  big â–· -âˆ—áµ’'â‡’-âˆ—áµ’ {Qáµ’ = âˆ€áµ’ M , âŸ¨ M âŸ©â‡›á´¹'âŸ¨ M âŸ© _} â–·
    -âˆ—áµ’-monoÊ³ Î» big M â†’ big M â–· â‡›á´¹'â‡’â‡›á´¹ â–· â‡›á´¹-mono Î» (krMâ‡’ , big) â†’ krMâ‡’ ,
    Î» e eË‡ M' eeË‡M'â‡ â†’ big e eË‡ M' eeË‡M'â‡ â–· â‡›á´¹'â‡’â‡›á´¹ â–·
    â‡›á´¹-mono (âˆ—áµ’'â‡’âˆ—áµ’ â€º âˆ—áµ’-monoÊ³ âˆ—áµ’'â‡’âˆ—áµ’)

  âºâŸ¨âŸ©âˆžáµ’-krâ»Â¹ :  âºâŸ¨ Ä©â‚ kr âŸ©âˆžáµ’ Î¹ Î¹'  âŠ¨
                [âŠ¤]á´ºáµ’ -âˆ—áµ’ âˆ€áµ’ M , âŸ¨ M âŸ©â‡›á´¹âŸ¨ M âŸ© âŒœ (kr , M) â‡’á´·á´¿âˆ‘ âŒáµ’Ã—
                  âˆ€áµ’ e , âˆ€áµ’ eË‡ , âˆ€áµ’ M' , âˆ€áµ’ b ,
                    âŒœ (e , eË‡ , M') â‡á´·á´¿âŸ¨ b âŸ© (kr , M) âŒáµ’â†’ âŸ¨ M âŸ©â‡›á´¹âŸ¨ M' âŸ©
                      [âŠ¤]á´ºáµ’ âˆ—áµ’ âŸ¨ e âŸ©âˆžáµ’Ë‚âŸ¨ b âŸ© Î¹ Î¹' âˆ—áµ’ âŸ¨Â¿ eË‡ âŸ©áµ€áµ’âŠ¤Ë‚ Î¹
  âºâŸ¨âŸ©âˆžáµ’-krâ»Â¹ (âºâŸ¨âŸ©âˆžáµ’-kr' big) =  big â–· -âˆ—áµ’'â‡’-âˆ—áµ’ {Qáµ’ = âˆ€áµ’ M , âŸ¨ M âŸ©â‡›á´¹'âŸ¨ M âŸ© _} â–·
    -âˆ—áµ’-monoÊ³ Î» big M â†’ big M â–· â‡›á´¹'â‡’â‡›á´¹ â–· â‡›á´¹-mono Î» (krMâ‡’ , big) â†’ krMâ‡’ ,
    Î» e eË‡ M' b eeË‡M'â‡âŸ¨bâŸ© â†’ big e eË‡ M' b eeË‡M'â‡âŸ¨bâŸ© â–· â‡›á´¹'â‡’â‡›á´¹ â–·
    â‡›á´¹-mono (âˆ—áµ’'â‡’âˆ—áµ’ â€º âˆ—áµ’-monoÊ³ âˆ—áµ’'â‡’âˆ—áµ’)

  -- Conversion between âºâŸ¨âŸ©á´¾/áµ€áµ’âŠ¤ and âºâŸ¨âŸ©á´¾/áµ€áµ’ Î» _ â†’ âŠ¤áµ’â‚€

  âºâŸ¨âŸ©á´¾áµ’âŠ¤â‡’âºâŸ¨âŸ©á´¾áµ’ :  âºâŸ¨ vk âŸ©á´¾áµ’âŠ¤ Î¹  âŠ¨  âºâŸ¨ vk âŸ©á´¾áµ’ Î¹ Î» _ â†’ âŠ¤áµ’â‚€
  âºâŸ¨âŸ©á´¾áµ’âŠ¤â‡’âºâŸ¨âŸ©á´¾áµ’ âºâŸ¨âŸ©á´¾áµ’âŠ¤-val =  âºâŸ¨âŸ©á´¾áµ’-val $ â‡›á´ºáµ’-intro _
  âºâŸ¨âŸ©á´¾áµ’âŠ¤â‡’âºâŸ¨âŸ©á´¾áµ’ (âºâŸ¨âŸ©á´¾áµ’âŠ¤-kr' big) =  âºâŸ¨âŸ©á´¾áµ’-kr $ big â–·
    -âˆ—áµ’'â‡’-âˆ—áµ’ {Qáµ’ = âˆ€áµ’ M , âŸ¨ M âŸ©â‡›á´¹'âŸ¨ M âŸ© _} â–· -âˆ—áµ’-monoÊ³ Î» big M â†’ big M â–·
    â‡›á´¹'â‡’â‡›á´¹ â–· â‡›á´¹-mono Î» (krMâ‡’ , big) â†’ krMâ‡’ , Î» e eË‡ M' eeË‡M'â‡ â†’
    big e eË‡ M' eeË‡M'â‡ â–· â‡›á´¹'â‡’â‡›á´¹ â–· â‡›á´¹-mono (âˆ—áµ’'â‡’âˆ—áµ’ â€º âˆ—áµ’-monoÊ³ $ âˆ—áµ’'â‡’âˆ—áµ’ â€º
    âˆ—áµ’-monoË¡ Î» big â†’ Î»{ .! â†’ âºâŸ¨âŸ©á´¾áµ’âŠ¤â‡’âºâŸ¨âŸ©á´¾áµ’ (big .!) })

  âºâŸ¨âŸ©áµ€áµ’âŠ¤â‡’âºâŸ¨âŸ©áµ€áµ’ :  âºâŸ¨ vk âŸ©áµ€áµ’âŠ¤ Î¹  âŠ¨  âºâŸ¨ vk âŸ©áµ€áµ’ Î¹ Î» _ â†’ âŠ¤áµ’â‚€
  âºâŸ¨âŸ©áµ€áµ’âŠ¤â‡’âºâŸ¨âŸ©áµ€áµ’ âºâŸ¨âŸ©áµ€áµ’âŠ¤-val =  âºâŸ¨âŸ©áµ€áµ’-val $ â‡›á´ºáµ’-intro _
  âºâŸ¨âŸ©áµ€áµ’âŠ¤â‡’âºâŸ¨âŸ©áµ€áµ’ (âºâŸ¨âŸ©áµ€áµ’âŠ¤-kr' big) =  âºâŸ¨âŸ©áµ€áµ’-kr $ big â–·
    -âˆ—áµ’'â‡’-âˆ—áµ’ {Qáµ’ = âˆ€áµ’ M , âŸ¨ M âŸ©â‡›á´¹'âŸ¨ M âŸ© _} â–· -âˆ—áµ’-monoÊ³ Î» big M â†’ big M â–·
    â‡›á´¹'â‡’â‡›á´¹ â–· â‡›á´¹-mono Î» (krMâ‡’ , big) â†’ krMâ‡’ , Î» e eË‡ M' eeË‡M'â‡ â†’
    big e eË‡ M' eeË‡M'â‡ â–· â‡›á´¹'â‡’â‡›á´¹ â–· â‡›á´¹-mono (âˆ—áµ’'â‡’âˆ—áµ’ â€º âˆ—áµ’-monoÊ³ $ âˆ—áµ’'â‡’âˆ—áµ’ â€º
    âˆ—áµ’-monoË¡ Î»{ (Â§ big) â†’ Â§ âºâŸ¨âŸ©áµ€áµ’âŠ¤â‡’âºâŸ¨âŸ©áµ€áµ’ big })

  âºâŸ¨âŸ©á´¾áµ’â‡’âºâŸ¨âŸ©á´¾áµ’âŠ¤ :  âºâŸ¨ vk âŸ©á´¾áµ’ Î¹ Páµ’Ë™  âŠ¨  âºâŸ¨ vk âŸ©á´¾áµ’âŠ¤ Î¹
  âºâŸ¨âŸ©á´¾áµ’â‡’âºâŸ¨âŸ©á´¾áµ’âŠ¤ {vk = Ä©â‚€ _} _ =  âºâŸ¨âŸ©á´¾áµ’âŠ¤-val
  âºâŸ¨âŸ©á´¾áµ’â‡’âºâŸ¨âŸ©á´¾áµ’âŠ¤ {vk = Ä©â‚ _} âŸ¨krâŸ©P =  âºâŸ¨âŸ©á´¾áµ’âŠ¤-kr' $ âºâŸ¨âŸ©á´¾áµ’-krâ»Â¹ âŸ¨krâŸ©P â–· -âˆ—áµ’-monoÊ³
    (Î» big M â†’ big M â–· â‡›á´¹-mono (Î» (krMâ‡’ , big) â†’ krMâ‡’ , Î» e eË‡ M' eeË‡M'â‡ â†’
    big e eË‡ M' eeË‡M'â‡ â–· â‡›á´¹-mono (âˆ—áµ’-monoÊ³ (âˆ—áµ’-monoË¡ {Qáµ’ = âŸ¨ _ âŸ©á´¾áµ’âŠ¤Ë‚ _} (Î» big â†’
    Î»{ .! {Î¹'} â†’ âºâŸ¨âŸ©á´¾áµ’â‡’âºâŸ¨âŸ©á´¾áµ’âŠ¤ (big .! {Î¹'}) }) â€º âˆ—áµ’â‡’âˆ—áµ’') â€º âˆ—áµ’â‡’âˆ—áµ’') â–· â‡›á´¹â‡’â‡›á´¹') â–·
    â‡›á´¹â‡’â‡›á´¹') â–· -âˆ—áµ’â‡’-âˆ—áµ’'

  âºâŸ¨âŸ©áµ€áµ’â‡’âºâŸ¨âŸ©áµ€áµ’âŠ¤ :  âºâŸ¨ vk âŸ©áµ€áµ’ Î¹ Páµ’Ë™  âŠ¨  âºâŸ¨ vk âŸ©áµ€áµ’âŠ¤ Î¹
  âºâŸ¨âŸ©áµ€áµ’â‡’âºâŸ¨âŸ©áµ€áµ’âŠ¤ {vk = Ä©â‚€ _} _ =  âºâŸ¨âŸ©áµ€áµ’âŠ¤-val
  âºâŸ¨âŸ©áµ€áµ’â‡’âºâŸ¨âŸ©áµ€áµ’âŠ¤ {vk = Ä©â‚ _} {Î¹} âŸ¨krâŸ©P =  âºâŸ¨âŸ©áµ€áµ’âŠ¤-kr' $ âºâŸ¨âŸ©áµ€áµ’-krâ»Â¹ âŸ¨krâŸ©P â–·
    -âˆ—áµ’-monoÊ³ (Î» big M â†’ big M â–· â‡›á´¹-mono (Î» (krMâ‡’ , big) â†’ krMâ‡’ ,
    Î» e eË‡ M' eeË‡M'â‡ â†’ big e eË‡ M' eeË‡M'â‡ â–· â‡›á´¹-mono (âˆ—áµ’-monoÊ³ (âˆ—áµ’-monoË¡
    {Qáµ’ = âŸ¨ _ âŸ©áµ€áµ’âŠ¤Ë‚ _} (Î»{ (Â§ big) â†’ Â§_ {Î¹ = Î¹} $ âºâŸ¨âŸ©áµ€áµ’â‡’âºâŸ¨âŸ©áµ€áµ’âŠ¤ big }) â€º
    âˆ—áµ’â‡’âˆ—áµ’') â€º âˆ—áµ’â‡’âˆ—áµ’') â–· â‡›á´¹â‡’â‡›á´¹') â–· â‡›á´¹â‡’â‡›á´¹') â–· -âˆ—áµ’â‡’-âˆ—áµ’'

  -- Monoáµ’ for áµƒâŸ¨âŸ©áµ’, âºâŸ¨âŸ©á´¾/áµ€áµ’, âºâŸ¨âŸ©âˆžáµ’ and âºâŸ¨âŸ©á´¾/áµ€áµ’âŠ¤

  áµƒâŸ¨âŸ©áµ’-Mono :  Monoáµ’ $ áµƒâŸ¨ red âŸ©áµ’ Páµ’Ë™
  áµƒâŸ¨âŸ©áµ’-Mono aâŠ‘b âŸ¨redâŸ©P M =  âŸ¨redâŸ©P M â–· â‡›á´¹-Mono aâŠ‘b

  âºâŸ¨âŸ©á´¾áµ’-Mono :  Monoáµ’ $ âºâŸ¨ vk âŸ©á´¾áµ’ Î¹ Páµ’Ë™
  âºâŸ¨âŸ©á´¾áµ’-Mono {vk = Ä©â‚€ _} aâŠ‘b =  âºâŸ¨âŸ©á´¾áµ’-valâ»Â¹ â€º -âˆ—áµ’-Mono aâŠ‘b â€º âºâŸ¨âŸ©á´¾áµ’-val
  âºâŸ¨âŸ©á´¾áµ’-Mono {vk = Ä©â‚ _} aâŠ‘b =  âºâŸ¨âŸ©á´¾áµ’-krâ»Â¹ â€º -âˆ—áµ’-Mono aâŠ‘b â€º âºâŸ¨âŸ©á´¾áµ’-kr

  âºâŸ¨âŸ©áµ€áµ’-Mono :  Monoáµ’ $ âºâŸ¨ vk âŸ©áµ€áµ’ Î¹ Páµ’Ë™
  âºâŸ¨âŸ©áµ€áµ’-Mono {vk = Ä©â‚€ _} aâŠ‘b =  âºâŸ¨âŸ©áµ€áµ’-valâ»Â¹ â€º -âˆ—áµ’-Mono aâŠ‘b â€º âºâŸ¨âŸ©áµ€áµ’-val
  âºâŸ¨âŸ©áµ€áµ’-Mono {vk = Ä©â‚ _} aâŠ‘b =  âºâŸ¨âŸ©áµ€áµ’-krâ»Â¹ â€º -âˆ—áµ’-Mono aâŠ‘b â€º âºâŸ¨âŸ©áµ€áµ’-kr

  âºâŸ¨âŸ©âˆžáµ’-Mono :  Monoáµ’ $ âºâŸ¨ vk âŸ©âˆžáµ’ Î¹ Î¹'
  âºâŸ¨âŸ©âˆžáµ’-Mono {vk = Ä©â‚€ _} aâŠ‘b =  âºâŸ¨âŸ©âˆžáµ’-valâ»Â¹ â€º -âˆ—áµ’-Mono aâŠ‘b â€º âºâŸ¨âŸ©âˆžáµ’-val
  âºâŸ¨âŸ©âˆžáµ’-Mono {vk = Ä©â‚ _} aâŠ‘b =  âºâŸ¨âŸ©âˆžáµ’-krâ»Â¹ â€º -âˆ—áµ’-Mono aâŠ‘b â€º âºâŸ¨âŸ©âˆžáµ’-kr

  âºâŸ¨âŸ©á´¾áµ’âŠ¤-Mono :  Monoáµ’ $ âºâŸ¨ vk âŸ©á´¾áµ’âŠ¤ Î¹
  âºâŸ¨âŸ©á´¾áµ’âŠ¤-Mono aâŠ‘b =  âºâŸ¨âŸ©á´¾áµ’âŠ¤â‡’âºâŸ¨âŸ©á´¾áµ’ â€º âºâŸ¨âŸ©á´¾áµ’-Mono aâŠ‘b â€º âºâŸ¨âŸ©á´¾áµ’â‡’âºâŸ¨âŸ©á´¾áµ’âŠ¤

  âºâŸ¨âŸ©áµ€áµ’âŠ¤-Mono :  Monoáµ’ $ âºâŸ¨ vk âŸ©áµ€áµ’âŠ¤ Î¹
  âºâŸ¨âŸ©áµ€áµ’âŠ¤-Mono aâŠ‘b =  âºâŸ¨âŸ©áµ€áµ’âŠ¤â‡’âºâŸ¨âŸ©áµ€áµ’ â€º âºâŸ¨âŸ©áµ€áµ’-Mono aâŠ‘b â€º âºâŸ¨âŸ©áµ€áµ’â‡’âºâŸ¨âŸ©áµ€áµ’âŠ¤

  -- Utility :  Monoáµ’ for âˆ€áµ’ â‡›á´¹

  âˆ€áµ’â‡›á´¹-Mono :  Monoáµ’ $ âˆ€áµ’ M , âŸ¨ M âŸ©â‡›á´¹âŸ¨ M âŸ© Páµ’Ë™ M
  âˆ€áµ’â‡›á´¹-Mono =  âˆ€áµ’-Mono Î» _ â†’ â‡›á´¹-Mono

  -- Monotonicity of áµƒâŸ¨âŸ©áµ’ and âºâŸ¨âŸ©á´¾/áµ€áµ’

  áµƒâŸ¨âŸ©áµ’-monoâœ“ :  (âˆ€ v â†’ Páµ’Ë™ v âŠ¨âœ“ Qáµ’Ë™ v) â†’  áµƒâŸ¨ red âŸ©áµ’ Páµ’Ë™ âŠ¨ áµƒâŸ¨ red âŸ©áµ’ Qáµ’Ë™
  áµƒâŸ¨âŸ©áµ’-monoâœ“ PvâŠ¨âœ“Qv big M =  big M â–· â‡›á´¹-mono Î» (redMâ‡’ , big) â†’ redMâ‡’ ,
    Î» e eË‡ M' eeË‡M'â‡ â†’ big e eË‡ M' eeË‡M'â‡ â–· Î» (-, â‰¡vÅˆ , big) â†’ -, â‰¡vÅˆ ,
    big â–· â‡›á´¹-monoâœ“ (PvâŠ¨âœ“Qv _)

  áµƒâŸ¨âŸ©áµ’-mono :  (âˆ€ v â†’ Páµ’Ë™ v âŠ¨ Qáµ’Ë™ v) â†’  áµƒâŸ¨ red âŸ©áµ’ Páµ’Ë™ âŠ¨ áµƒâŸ¨ red âŸ©áµ’ Qáµ’Ë™
  áµƒâŸ¨âŸ©áµ’-mono =  (âŠ¨â‡’âŠ¨âœ“ âˆ˜_) â€º áµƒâŸ¨âŸ©áµ’-monoâœ“

  âºâŸ¨âŸ©á´¾áµ’-monoâœ“ :  (âˆ€ v â†’ Páµ’Ë™ v âŠ¨âœ“ Qáµ’Ë™ v) â†’  âºâŸ¨ vk âŸ©á´¾áµ’ Î¹ Páµ’Ë™ âŠ¨ âºâŸ¨ vk âŸ©á´¾áµ’ Î¹ Qáµ’Ë™
  âºâŸ¨âŸ©á´¾áµ’-monoâœ“ {vk = Ä©â‚€ _} PvâŠ¨âœ“Qv =  âºâŸ¨âŸ©á´¾áµ’-valâ»Â¹ â€º â‡›á´ºáµ’-monoâœ“ (PvâŠ¨âœ“Qv _) â€º
    âºâŸ¨âŸ©á´¾áµ’-val
  âºâŸ¨âŸ©á´¾áµ’-monoâœ“ {vk = Ä©â‚ _} PvâŠ¨âœ“Qv =  âºâŸ¨âŸ©á´¾áµ’-krâ»Â¹ â€º -âˆ—áµ’-monoÊ³ (Î» big M â†’ big M â–·
    â‡›á´¹-mono Î» (krMâ‡’ , big) â†’ krMâ‡’ , Î» e eË‡ M' eeË‡M'â‡ â†’ big e eË‡ M' eeË‡M'â‡ â–·
    â‡›á´¹-mono (âˆ—áµ’-monoÊ³ $ âˆ—áµ’-monoË¡ Î» big â†’
    Î»{ .! â†’ âºâŸ¨âŸ©á´¾áµ’-monoâœ“ PvâŠ¨âœ“Qv $ big .! })) â€º âºâŸ¨âŸ©á´¾áµ’-kr

  âºâŸ¨âŸ©á´¾áµ’-mono :  (âˆ€ v â†’ Páµ’Ë™ v âŠ¨ Qáµ’Ë™ v) â†’  âºâŸ¨ vk âŸ©á´¾áµ’ Î¹ Páµ’Ë™ âŠ¨ âºâŸ¨ vk âŸ©á´¾áµ’ Î¹ Qáµ’Ë™
  âºâŸ¨âŸ©á´¾áµ’-mono =  (âŠ¨â‡’âŠ¨âœ“ âˆ˜_) â€º âºâŸ¨âŸ©á´¾áµ’-monoâœ“

  âºâŸ¨âŸ©áµ€áµ’-monoâœ“ :  (âˆ€ v â†’ Páµ’Ë™ v âŠ¨âœ“ Qáµ’Ë™ v) â†’  âºâŸ¨ vk âŸ©áµ€áµ’ Î¹ Páµ’Ë™ âŠ¨ âºâŸ¨ vk âŸ©áµ€áµ’ Î¹ Qáµ’Ë™
  âºâŸ¨âŸ©áµ€áµ’-monoâœ“ {vk = Ä©â‚€ _} PvâŠ¨âœ“Qv =  âºâŸ¨âŸ©áµ€áµ’-valâ»Â¹ â€º â‡›á´ºáµ’-monoâœ“ (PvâŠ¨âœ“Qv _) â€º
    âºâŸ¨âŸ©áµ€áµ’-val
  âºâŸ¨âŸ©áµ€áµ’-monoâœ“ {vk = Ä©â‚ _} PvâŠ¨âœ“Qv =  âºâŸ¨âŸ©áµ€áµ’-krâ»Â¹ â€º -âˆ—áµ’-monoÊ³ (Î» big M â†’ big M â–·
    â‡›á´¹-mono Î» (krMâ‡’ , big) â†’ krMâ‡’ , Î» e eË‡ M' eeË‡M'â‡ â†’ big e eË‡ M' eeË‡M'â‡ â–·
    â‡›á´¹-mono (âˆ—áµ’-monoÊ³ $ âˆ—áµ’-monoË¡ Î»{ (Â§ big) â†’ Â§ âºâŸ¨âŸ©áµ€áµ’-monoâœ“ PvâŠ¨âœ“Qv big })) â€º
    âºâŸ¨âŸ©áµ€áµ’-kr

  âºâŸ¨âŸ©áµ€áµ’-mono :  (âˆ€ v â†’ Páµ’Ë™ v âŠ¨ Qáµ’Ë™ v) â†’  âºâŸ¨ vk âŸ©áµ€áµ’ Î¹ Páµ’Ë™ âŠ¨ âºâŸ¨ vk âŸ©áµ€áµ’ Î¹ Qáµ’Ë™
  âºâŸ¨âŸ©áµ€áµ’-mono =  (âŠ¨â‡’âŠ¨âœ“ âˆ˜_) â€º âºâŸ¨âŸ©áµ€áµ’-monoâœ“

  -- âŠ¨âœ“ into âŠ¨ when the right-hand side is áµƒâŸ¨âŸ©áµ’ / âºâŸ¨âŸ©á´¾/áµ€áµ’ / âºâŸ¨âŸ©âˆžáµ’

  âŠ¨âœ“â‡’âŠ¨-áµƒâŸ¨âŸ©áµ’ :  Páµ’ âŠ¨âœ“ áµƒâŸ¨ red âŸ©áµ’ Qáµ’Ë™ â†’  Páµ’ âŠ¨ áµƒâŸ¨ red âŸ©áµ’ Qáµ’Ë™
  âŠ¨âœ“â‡’âŠ¨-áµƒâŸ¨âŸ©áµ’ PâŠ¨âœ“âŸ¨redâŸ©Q Pa M =  Pa â–· âŠ¨âœ“â‡’âŠ¨-â‡›á´¹ (Î» âœ“âˆ™ Pb â†’ PâŠ¨âœ“âŸ¨redâŸ©Q âœ“âˆ™ Pb M)

  âŠ¨âœ“â‡’âŠ¨-âºâŸ¨âŸ©á´¾áµ’ :  Páµ’ âŠ¨âœ“ âºâŸ¨ vk âŸ©á´¾áµ’ Î¹ Qáµ’Ë™ â†’  Páµ’ âŠ¨ âºâŸ¨ vk âŸ©á´¾áµ’ Î¹ Qáµ’Ë™
  âŠ¨âœ“â‡’âŠ¨-âºâŸ¨âŸ©á´¾áµ’ {vk = Ä©â‚€ _} PâŠ¨âœ“âŸ¨vâŸ©Q Pa =  Pa â–·
    âŠ¨âœ“â‡’âŠ¨--âˆ—áµ’ (Î» âœ“âˆ™ Pb â†’ PâŠ¨âœ“âŸ¨vâŸ©Q âœ“âˆ™ Pb â–· âºâŸ¨âŸ©á´¾áµ’-valâ»Â¹) â–· âºâŸ¨âŸ©á´¾áµ’-val
  âŠ¨âœ“â‡’âŠ¨-âºâŸ¨âŸ©á´¾áµ’ {vk = Ä©â‚ _} PâŠ¨âœ“âŸ¨krâŸ©Q Pa =  Pa â–·
    âŠ¨âœ“â‡’âŠ¨--âˆ—áµ’ (Î» âœ“âˆ™ Pb â†’ PâŠ¨âœ“âŸ¨krâŸ©Q âœ“âˆ™ Pb â–· âºâŸ¨âŸ©á´¾áµ’-krâ»Â¹) â–· âºâŸ¨âŸ©á´¾áµ’-kr

  âŠ¨âœ“â‡’âŠ¨-âºâŸ¨âŸ©áµ€áµ’ :  Páµ’ âŠ¨âœ“ âºâŸ¨ vk âŸ©áµ€áµ’ Î¹ Qáµ’Ë™ â†’  Páµ’ âŠ¨ âºâŸ¨ vk âŸ©áµ€áµ’ Î¹ Qáµ’Ë™
  âŠ¨âœ“â‡’âŠ¨-âºâŸ¨âŸ©áµ€áµ’ {vk = Ä©â‚€ _} PâŠ¨âœ“âŸ¨vâŸ©Q Pa =  Pa â–·
    âŠ¨âœ“â‡’âŠ¨--âˆ—áµ’ (Î» âœ“âˆ™ Pb â†’ PâŠ¨âœ“âŸ¨vâŸ©Q âœ“âˆ™ Pb â–· âºâŸ¨âŸ©áµ€áµ’-valâ»Â¹) â–· âºâŸ¨âŸ©áµ€áµ’-val
  âŠ¨âœ“â‡’âŠ¨-âºâŸ¨âŸ©áµ€áµ’ {vk = Ä©â‚ _} PâŠ¨âœ“âŸ¨krâŸ©Q Pa =  Pa â–·
    âŠ¨âœ“â‡’âŠ¨--âˆ—áµ’ (Î» âœ“âˆ™ Pb â†’ PâŠ¨âœ“âŸ¨krâŸ©Q âœ“âˆ™ Pb â–· âºâŸ¨âŸ©áµ€áµ’-krâ»Â¹) â–· âºâŸ¨âŸ©áµ€áµ’-kr

  âŠ¨âœ“â‡’âŠ¨-âºâŸ¨âŸ©âˆžáµ’ :  Páµ’ âŠ¨âœ“ âºâŸ¨ vk âŸ©âˆžáµ’ Î¹ Î¹' â†’  Páµ’ âŠ¨ âºâŸ¨ vk âŸ©âˆžáµ’ Î¹ Î¹'
  âŠ¨âœ“â‡’âŠ¨-âºâŸ¨âŸ©âˆžáµ’ {vk = Ä©â‚€ _} PâŠ¨âœ“âŸ¨vâŸ©Q Pa =  Pa â–·
    âŠ¨âœ“â‡’âŠ¨--âˆ—áµ’ (Î» âœ“âˆ™ Pb â†’ PâŠ¨âœ“âŸ¨vâŸ©Q âœ“âˆ™ Pb â–· âºâŸ¨âŸ©âˆžáµ’-valâ»Â¹) â–· âºâŸ¨âŸ©âˆžáµ’-val
  âŠ¨âœ“â‡’âŠ¨-âºâŸ¨âŸ©âˆžáµ’ {vk = Ä©â‚ _} PâŠ¨âœ“âŸ¨krâŸ©Q Pa =  Pa â–·
    âŠ¨âœ“â‡’âŠ¨--âˆ—áµ’ (Î» âœ“âˆ™ Pb â†’ PâŠ¨âœ“âŸ¨krâŸ©Q âœ“âˆ™ Pb â–· âºâŸ¨âŸ©âˆžáµ’-krâ»Â¹) â–· âºâŸ¨âŸ©âˆžáµ’-kr

  -- Modify the size of âºâŸ¨âŸ©á´¾/áµ€áµ’ / âºâŸ¨âŸ©âˆžáµ’ / âŸ¨Â¿ âŸ©áµ€áµ’âŠ¤Ë‚

  âºâŸ¨âŸ©á´¾áµ’-size :  âˆ€{Î¹' : Size< Î¹} â†’  âºâŸ¨ vk âŸ©á´¾áµ’ Î¹ Páµ’Ë™  âŠ¨  âºâŸ¨ vk âŸ©á´¾áµ’ Î¹' Páµ’Ë™
  âºâŸ¨âŸ©á´¾áµ’-size âŸ¨vkâŸ©P =  âŸ¨vkâŸ©P

  âºâŸ¨âŸ©áµ€áµ’-size :  âˆ€{Î¹' : Size< Î¹} â†’  âºâŸ¨ vk âŸ©áµ€áµ’ Î¹' Páµ’Ë™  âŠ¨  âºâŸ¨ vk âŸ©áµ€áµ’ Î¹ Páµ’Ë™
  âºâŸ¨âŸ©áµ€áµ’-size âŸ¨vkâŸ©P =  âŸ¨vkâŸ©P

  âºâŸ¨âŸ©âˆžáµ’-size :  âˆ€{Î¹â» : Size< Î¹} {Î¹'â» : Size< Î¹'} â†’
    âºâŸ¨ vk âŸ©âˆžáµ’ Î¹â» Î¹'  âŠ¨  âºâŸ¨ vk âŸ©âˆžáµ’ Î¹ Î¹'â»
  âºâŸ¨âŸ©âˆžáµ’-size âŸ¨vkâŸ©P =  âŸ¨vkâŸ©P

  âŸ¨Â¿âŸ©áµ€áµ’âŠ¤Ë‚-size :  âˆ€{Î¹' : Size< Î¹} â†’ âŸ¨Â¿ eË‡ âŸ©áµ€áµ’âŠ¤Ë‚ Î¹'  âŠ¨  âŸ¨Â¿ eË‡ âŸ©áµ€áµ’âŠ¤Ë‚ Î¹
  âŸ¨Â¿âŸ©áµ€áµ’âŠ¤Ë‚-size âŸ¨vkâŸ©P =  âŸ¨vkâŸ©P

  -- Convert âºâŸ¨âŸ©áµ€áµ’ into âºâŸ¨âŸ©á´¾áµ’

  âºâŸ¨âŸ©áµ€áµ’â‡’âºâŸ¨âŸ©á´¾áµ’ :  âºâŸ¨ vk âŸ©áµ€áµ’ Î¹ Páµ’Ë™  âŠ¨  âºâŸ¨ vk âŸ©á´¾áµ’ Î¹' Páµ’Ë™
  âŸ¨Â¿âŸ©áµ€áµ’âŠ¤Ë‚â‡’âŸ¨Â¿âŸ©á´¾áµ’âŠ¤Ë‚ :  âŸ¨Â¿ eË‡ âŸ©áµ€áµ’âŠ¤Ë‚ Î¹  âŠ¨  âŸ¨Â¿ eË‡ âŸ©á´¾áµ’âŠ¤Ë‚ Î¹'

  âºâŸ¨âŸ©áµ€áµ’â‡’âºâŸ¨âŸ©á´¾áµ’ {vk = Ä©â‚€ _} =  âºâŸ¨âŸ©áµ€áµ’-valâ»Â¹ â€º âºâŸ¨âŸ©á´¾áµ’-val
  âºâŸ¨âŸ©áµ€áµ’â‡’âºâŸ¨âŸ©á´¾áµ’ {vk = Ä©â‚ _} =  âºâŸ¨âŸ©áµ€áµ’-krâ»Â¹ â€º (-âˆ—áµ’-monoÊ³ Î» big M â†’ big M â–· â‡›á´¹-mono
    Î» (krMâ‡’ , big) â†’ krMâ‡’ , Î» e eË‡ M' eeË‡M'â‡ â†’ big e eË‡ M' eeË‡M'â‡ â–·
    â‡›á´¹-mono (âˆ—áµ’-monoÊ³ $ âˆ—áµ’-mono (Î»{ (Â§ big) â†’ Î»{ .! â†’ âºâŸ¨âŸ©áµ€áµ’â‡’âºâŸ¨âŸ©á´¾áµ’ big }}) $
    âŸ¨Â¿âŸ©áµ€áµ’âŠ¤Ë‚â‡’âŸ¨Â¿âŸ©á´¾áµ’âŠ¤Ë‚ {eË‡ = eË‡})) â€º âºâŸ¨âŸ©á´¾áµ’-kr

  âŸ¨Â¿âŸ©áµ€áµ’âŠ¤Ë‚â‡’âŸ¨Â¿âŸ©á´¾áµ’âŠ¤Ë‚ {eË‡ = Åˆ} _ =  _
  âŸ¨Â¿âŸ©áµ€áµ’âŠ¤Ë‚â‡’âŸ¨Â¿âŸ©á´¾áµ’âŠ¤Ë‚ {eË‡ = Å¡ _} (Â§ big) .! =
    big â–· âºâŸ¨âŸ©áµ€áµ’âŠ¤â‡’âºâŸ¨âŸ©áµ€áµ’ â–· âºâŸ¨âŸ©áµ€áµ’â‡’âºâŸ¨âŸ©á´¾áµ’ â–· âºâŸ¨âŸ©á´¾áµ’â‡’âºâŸ¨âŸ©á´¾áµ’âŠ¤

  -- Convert âºâŸ¨âŸ©âˆžáµ’ into âºâŸ¨âŸ©á´¾áµ’

  âºâŸ¨âŸ©âˆžáµ’â‡’âºâŸ¨âŸ©á´¾áµ’ :  âºâŸ¨ vk âŸ©âˆžáµ’ Î¹ Î¹'  âŠ¨  âºâŸ¨ vk âŸ©á´¾áµ’ Î¹' Páµ’Ë™
  âºâŸ¨âŸ©âˆžáµ’â‡’âºâŸ¨âŸ©á´¾áµ’ {vk = Ä©â‚€ _} =  âºâŸ¨âŸ©âˆžáµ’-valâ»Â¹ â€º â‡›á´ºáµ’-mono absurd â€º âºâŸ¨âŸ©á´¾áµ’-val
  âºâŸ¨âŸ©âˆžáµ’â‡’âºâŸ¨âŸ©á´¾áµ’ {vk = Ä©â‚ _} =  âºâŸ¨âŸ©âˆžáµ’-krâ»Â¹ â€º (-âˆ—áµ’-monoÊ³ Î» big M â†’
    big M â–· â‡›á´¹-mono Î» (krMâ‡’ , big) â†’ krMâ‡’ , Î» e eË‡ M' â†’ Î»{
    (ff , eeË‡M'â‡â—‹) â†’ big e eË‡ M' ff eeË‡M'â‡â—‹ â–· â‡›á´¹-mono (âˆ—áµ’-monoÊ³ $
      âˆ—áµ’-mono (Î»{ (Â§ big) â†’ Î»{ .! â†’ âºâŸ¨âŸ©âˆžáµ’â‡’âºâŸ¨âŸ©á´¾áµ’ big }}) $
      âŸ¨Â¿âŸ©áµ€áµ’âŠ¤Ë‚â‡’âŸ¨Â¿âŸ©á´¾áµ’âŠ¤Ë‚ {eË‡ = eË‡});
    (tt , eeË‡M'â‡â—) â†’ big e eË‡ M' tt eeË‡M'â‡â— â–· â‡›á´¹-mono (âˆ—áµ’-monoÊ³ $
      âˆ—áµ’-mono (Î» big â†’ Î»{ .! â†’ âºâŸ¨âŸ©âˆžáµ’â‡’âºâŸ¨âŸ©á´¾áµ’ $ big .! }) $
      âŸ¨Â¿âŸ©áµ€áµ’âŠ¤Ë‚â‡’âŸ¨Â¿âŸ©á´¾áµ’âŠ¤Ë‚ {eË‡ = eË‡})}) â€º âºâŸ¨âŸ©á´¾áµ’-kr

  -- áµƒâŸ¨âŸ©áµ’ absorbs â‡›áµ’ outside

  â‡›áµ’-áµƒâŸ¨âŸ©áµ’ :  â‡›áµ’ áµƒâŸ¨ red âŸ©áµ’ Páµ’Ë™  âŠ¨  áµƒâŸ¨ red âŸ©áµ’ Páµ’Ë™
  â‡›áµ’-áµƒâŸ¨âŸ©áµ’ big M =  big M â–· â‡›á´¹-mono (_$ M) â–· â‡›á´¹-join

  -- âºâŸ¨âŸ©á´¾/áµ€áµ’ / âºâŸ¨âŸ©âˆžáµ’ absorbs â‡›á´ºáµ’/â‡›áµ’ outside

  â‡›á´ºáµ’-âºâŸ¨âŸ©á´¾áµ’ :  â‡›á´ºáµ’ âºâŸ¨ vk âŸ©á´¾áµ’ Î¹ Páµ’Ë™  âŠ¨  âºâŸ¨ vk âŸ©á´¾áµ’ Î¹ Páµ’Ë™
  â‡›á´ºáµ’-âºâŸ¨âŸ©á´¾áµ’ {vk = Ä©â‚€ _} =  â‡›á´ºáµ’-mono âºâŸ¨âŸ©á´¾áµ’-valâ»Â¹ â€º â‡›á´ºáµ’-join â€º âºâŸ¨âŸ©á´¾áµ’-val
  â‡›á´ºáµ’-âºâŸ¨âŸ©á´¾áµ’ {vk = Ä©â‚ _} =  (-âˆ—áµ’-monoÊ³ Î» big M â†’ big M â–· â‡›á´¹-monoâœ“ (Î» âœ“âˆ™ â†’
    âˆ—áµ’-monoÊ³ âºâŸ¨âŸ©á´¾áµ’-krâ»Â¹ â€º -âˆ—áµ’-applyË¡ âˆ€áµ’â‡›á´¹-Mono âœ“âˆ™ â€º _$ M) â–· â‡›á´¹-join) â€º âºâŸ¨âŸ©á´¾áµ’-kr

  â‡›áµ’-âºâŸ¨âŸ©á´¾áµ’ :  â‡›áµ’ âºâŸ¨ vk âŸ©á´¾áµ’ Î¹ Páµ’Ë™  âŠ¨  âºâŸ¨ vk âŸ©á´¾áµ’ Î¹ Páµ’Ë™
  â‡›áµ’-âºâŸ¨âŸ©á´¾áµ’ =  â‡›áµ’â‡’â‡›á´ºáµ’ â€º â‡›á´ºáµ’-âºâŸ¨âŸ©á´¾áµ’

  â‡›á´ºáµ’-âºâŸ¨âŸ©áµ€áµ’ :  â‡›á´ºáµ’ âºâŸ¨ vk âŸ©áµ€áµ’ Î¹ Páµ’Ë™  âŠ¨  âºâŸ¨ vk âŸ©áµ€áµ’ Î¹ Páµ’Ë™
  â‡›á´ºáµ’-âºâŸ¨âŸ©áµ€áµ’ {vk = Ä©â‚€ _} =  â‡›á´ºáµ’-mono âºâŸ¨âŸ©áµ€áµ’-valâ»Â¹ â€º â‡›á´ºáµ’-join â€º âºâŸ¨âŸ©áµ€áµ’-val
  â‡›á´ºáµ’-âºâŸ¨âŸ©áµ€áµ’ {vk = Ä©â‚ _} =  (-âˆ—áµ’-monoÊ³ Î» big M â†’ big M â–· â‡›á´¹-monoâœ“ (Î» âœ“âˆ™ â†’
    âˆ—áµ’-monoÊ³ âºâŸ¨âŸ©áµ€áµ’-krâ»Â¹ â€º -âˆ—áµ’-applyË¡ âˆ€áµ’â‡›á´¹-Mono âœ“âˆ™ â€º _$ M) â–· â‡›á´¹-join) â€º âºâŸ¨âŸ©áµ€áµ’-kr

  â‡›áµ’-âºâŸ¨âŸ©áµ€áµ’ :  â‡›áµ’ âºâŸ¨ vk âŸ©áµ€áµ’ Î¹ Páµ’Ë™  âŠ¨  âºâŸ¨ vk âŸ©áµ€áµ’ Î¹ Páµ’Ë™
  â‡›áµ’-âºâŸ¨âŸ©áµ€áµ’ =  â‡›áµ’â‡’â‡›á´ºáµ’ â€º â‡›á´ºáµ’-âºâŸ¨âŸ©áµ€áµ’

  â‡›á´ºáµ’-âºâŸ¨âŸ©âˆžáµ’ :  â‡›á´ºáµ’ âºâŸ¨ vk âŸ©âˆžáµ’ Î¹ Î¹'  âŠ¨  âºâŸ¨ vk âŸ©âˆžáµ’ Î¹ Î¹'
  â‡›á´ºáµ’-âºâŸ¨âŸ©âˆžáµ’ {vk = Ä©â‚€ _} =  â‡›á´ºáµ’-mono âºâŸ¨âŸ©âˆžáµ’-valâ»Â¹ â€º â‡›á´ºáµ’-join â€º âºâŸ¨âŸ©âˆžáµ’-val
  â‡›á´ºáµ’-âºâŸ¨âŸ©âˆžáµ’ {vk = Ä©â‚ _} =  (-âˆ—áµ’-monoÊ³ Î» big M â†’ big M â–· â‡›á´¹-monoâœ“ (Î» âœ“âˆ™ â†’
    âˆ—áµ’-monoÊ³ âºâŸ¨âŸ©âˆžáµ’-krâ»Â¹ â€º -âˆ—áµ’-applyË¡ âˆ€áµ’â‡›á´¹-Mono âœ“âˆ™ â€º _$ M) â–· â‡›á´¹-join) â€º âºâŸ¨âŸ©âˆžáµ’-kr

  â‡›áµ’-âºâŸ¨âŸ©âˆžáµ’ :  â‡›áµ’ âºâŸ¨ vk âŸ©âˆžáµ’ Î¹ Î¹'  âŠ¨  âºâŸ¨ vk âŸ©âˆžáµ’ Î¹ Î¹'
  â‡›áµ’-âºâŸ¨âŸ©âˆžáµ’ =  â‡›áµ’â‡’â‡›á´ºáµ’ â€º â‡›á´ºáµ’-âºâŸ¨âŸ©âˆžáµ’

  -- áµƒâŸ¨âŸ©áµ’ absorbs â‡›áµ’ inside

  áµƒâŸ¨âŸ©áµ’-â‡›áµ’ :  áµƒâŸ¨ red âŸ©áµ’ (Î» v â†’ â‡›áµ’ Páµ’Ë™ v)  âŠ¨  áµƒâŸ¨ red âŸ©áµ’ Páµ’Ë™
  áµƒâŸ¨âŸ©áµ’-â‡›áµ’ big M =  big M â–· â‡›á´¹-mono Î» (redMâ‡’ , big) â†’ redMâ‡’ , Î» e eË‡ M' eeË‡M'â‡ â†’
    big e eË‡ M' eeË‡M'â‡ â–· Î» (-, â‰¡vÅˆ , big) â†’ -, â‰¡vÅˆ ,
    big â–· â‡›á´¹-mono (_$ M') â–· â‡›á´¹-join

  -- âºâŸ¨âŸ©á´¾/áµ€áµ’ absorbs â‡›á´ºáµ’/â‡›áµ’ inside

  âºâŸ¨âŸ©á´¾áµ’-â‡›á´ºáµ’ :  âºâŸ¨ vk âŸ©á´¾áµ’ Î¹ (Î» v â†’ â‡›á´ºáµ’ Páµ’Ë™ v)  âŠ¨  âºâŸ¨ vk âŸ©á´¾áµ’ Î¹ Páµ’Ë™
  âºâŸ¨âŸ©á´¾áµ’-â‡›á´ºáµ’ {vk = Ä©â‚€ _} =  âºâŸ¨âŸ©á´¾áµ’-valâ»Â¹ â€º â‡›á´ºáµ’-join â€º âºâŸ¨âŸ©á´¾áµ’-val
  âºâŸ¨âŸ©á´¾áµ’-â‡›á´ºáµ’ {vk = Ä©â‚ _} =  âºâŸ¨âŸ©á´¾áµ’-krâ»Â¹ â€º (-âˆ—áµ’-monoÊ³ Î» big M â†’ big M â–·
    â‡›á´¹-mono Î» (krMâ‡’ , big) â†’ krMâ‡’ , Î» e eË‡ M' eeË‡M'â‡ â†’ big e eË‡ M' eeË‡M'â‡ â–·
    â‡›á´¹-mono (âˆ—áµ’-monoÊ³ $ âˆ—áµ’-monoË¡ Î» big â†’ Î»{ .! â†’ âºâŸ¨âŸ©á´¾áµ’-â‡›á´ºáµ’ $ big .! })) â€º
    âºâŸ¨âŸ©á´¾áµ’-kr

  âºâŸ¨âŸ©á´¾áµ’-â‡›áµ’ :  âºâŸ¨ vk âŸ©á´¾áµ’ Î¹ (Î» v â†’ â‡›áµ’ Páµ’Ë™ v)  âŠ¨  âºâŸ¨ vk âŸ©á´¾áµ’ Î¹ Páµ’Ë™
  âºâŸ¨âŸ©á´¾áµ’-â‡›áµ’ =  âºâŸ¨âŸ©á´¾áµ’-mono (Î» _ â†’ â‡›áµ’â‡’â‡›á´ºáµ’) â€º âºâŸ¨âŸ©á´¾áµ’-â‡›á´ºáµ’

  âºâŸ¨âŸ©áµ€áµ’-â‡›á´ºáµ’ :  âºâŸ¨ vk âŸ©áµ€áµ’ Î¹ (Î» v â†’ â‡›á´ºáµ’ Páµ’Ë™ v)  âŠ¨  âºâŸ¨ vk âŸ©áµ€áµ’ Î¹ Páµ’Ë™
  âºâŸ¨âŸ©áµ€áµ’-â‡›á´ºáµ’ {vk = Ä©â‚€ _} =  âºâŸ¨âŸ©áµ€áµ’-valâ»Â¹ â€º â‡›á´ºáµ’-join â€º âºâŸ¨âŸ©áµ€áµ’-val
  âºâŸ¨âŸ©áµ€áµ’-â‡›á´ºáµ’ {vk = Ä©â‚ _} =  âºâŸ¨âŸ©áµ€áµ’-krâ»Â¹ â€º (-âˆ—áµ’-monoÊ³ Î» big M â†’ big M â–·
    â‡›á´¹-mono Î» (krMâ‡’ , big) â†’ krMâ‡’ , Î» e eË‡ M' eeË‡M'â‡ â†’ big e eË‡ M' eeË‡M'â‡ â–·
    â‡›á´¹-mono (âˆ—áµ’-monoÊ³ $ âˆ—áµ’-monoË¡ Î»{ (Â§ big) â†’ Â§ âºâŸ¨âŸ©áµ€áµ’-â‡›á´ºáµ’ big })) â€º âºâŸ¨âŸ©áµ€áµ’-kr

  âºâŸ¨âŸ©áµ€áµ’-â‡›áµ’ :  âºâŸ¨ vk âŸ©áµ€áµ’ Î¹ (Î» v â†’ â‡›áµ’ Páµ’Ë™ v)  âŠ¨  âºâŸ¨ vk âŸ©áµ€áµ’ Î¹ Páµ’Ë™
  âºâŸ¨âŸ©áµ€áµ’-â‡›áµ’ =  âºâŸ¨âŸ©áµ€áµ’-mono (Î» _ â†’ â‡›áµ’â‡’â‡›á´ºáµ’) â€º âºâŸ¨âŸ©áµ€áµ’-â‡›á´ºáµ’

  -- Let áµƒâŸ¨âŸ©áµ’ and âºâŸ¨âŸ©á´¾/áµ€áµ’ eat a proposition

  áµƒâŸ¨âŸ©áµ’-eatË¡ :  Qáµ’ âˆ—áµ’ (áµƒâŸ¨ red âŸ©áµ’ Páµ’Ë™)  âŠ¨  áµƒâŸ¨ red âŸ©áµ’ Î» v â†’ Qáµ’ âˆ—áµ’ Páµ’Ë™ v
  áµƒâŸ¨âŸ©áµ’-eatË¡ big M =  big â–· âˆ—áµ’-monoÊ³ (_$ M) â–· â‡›á´¹-eatË¡ â–· â‡›á´¹-mono (âˆ—áµ’âˆƒáµ’-out â€º
    Î» (redMâ‡’ , big) â†’ redMâ‡’ , Î» e eË‡ M' eeË‡M'â‡ â†’ big â–·
    âˆ—áµ’-monoÊ³ (Î» big â†’ big e eË‡ M' eeË‡M'â‡) â–· âˆ—áµ’âˆƒáµ’-out â–· Î» (-, big) â†’ -,
    big â–· âˆ—áµ’âˆƒáµ’-out â–· Î» (â‰¡vÅˆ , big) â†’ â‰¡vÅˆ , big â–· â‡›á´¹-eatË¡)

  âºâŸ¨âŸ©á´¾áµ’-eatË¡ :  Qáµ’ âˆ—áµ’ (âºâŸ¨ vk âŸ©á´¾áµ’ Î¹ Páµ’Ë™)  âŠ¨  âºâŸ¨ vk âŸ©á´¾áµ’ Î¹ Î» v â†’ Qáµ’ âˆ—áµ’ Páµ’Ë™ v
  âºâŸ¨âŸ©á´¾áµ’-eatË¡ {vk = Ä©â‚€ _} =  âˆ—áµ’-monoÊ³ âºâŸ¨âŸ©á´¾áµ’-valâ»Â¹ â€º â‡›á´ºáµ’-eatË¡ â€º âºâŸ¨âŸ©á´¾áµ’-val
  âºâŸ¨âŸ©á´¾áµ’-eatË¡ {vk = Ä©â‚ _} =  âˆ—áµ’-monoÊ³ âºâŸ¨âŸ©á´¾áµ’-krâ»Â¹ â€º -âˆ—áµ’-eatË¡ âˆ€áµ’â‡›á´¹-Mono â€º
    -âˆ—áµ’-monoÊ³ (Î» big M â†’ big â–· âˆ—áµ’-monoÊ³ (_$ M) â–· â‡›á´¹-eatË¡ â–· â‡›á´¹-mono (âˆ—áµ’âˆƒáµ’-out â€º
    Î» (krMâ‡’ , big) â†’ krMâ‡’ , Î» e eË‡ M' eeË‡M'â‡ â†’ big â–·
    âˆ—áµ’-monoÊ³ (Î» big â†’ big e eË‡ M' eeË‡M'â‡) â–· â‡›á´¹-eatË¡ â–· â‡›á´¹-mono (?âˆ—áµ’-comm â€º
    âˆ—áµ’-monoÊ³ $ âˆ—áµ’-assocÊ³ â€º âˆ—áµ’-monoË¡ $ âˆ—áµ’Thunkáµ’-out â€º
    Î» big â†’ Î»{ .! â†’ âºâŸ¨âŸ©á´¾áµ’-eatË¡ $ big .! }))) â€º âºâŸ¨âŸ©á´¾áµ’-kr

  âºâŸ¨âŸ©áµ€áµ’-eatË¡ :  Qáµ’ âˆ—áµ’ (âºâŸ¨ vk âŸ©áµ€áµ’ Î¹ Páµ’Ë™)  âŠ¨  âºâŸ¨ vk âŸ©áµ€áµ’ Î¹ Î» v â†’ Qáµ’ âˆ—áµ’ Páµ’Ë™ v
  âºâŸ¨âŸ©áµ€áµ’-eatË¡ {vk = Ä©â‚€ _} =  âˆ—áµ’-monoÊ³ âºâŸ¨âŸ©áµ€áµ’-valâ»Â¹ â€º â‡›á´ºáµ’-eatË¡ â€º âºâŸ¨âŸ©áµ€áµ’-val
  âºâŸ¨âŸ©áµ€áµ’-eatË¡ {vk = Ä©â‚ _} =  âˆ—áµ’-monoÊ³ âºâŸ¨âŸ©áµ€áµ’-krâ»Â¹ â€º -âˆ—áµ’-eatË¡ âˆ€áµ’â‡›á´¹-Mono â€º
    -âˆ—áµ’-monoÊ³ (Î» big M â†’ big â–· âˆ—áµ’-monoÊ³ (_$ M) â–· â‡›á´¹-eatË¡ â–· â‡›á´¹-mono (âˆ—áµ’âˆƒáµ’-out â€º
    Î» (krMâ‡’ , big) â†’ krMâ‡’ , Î» e eË‡ M' eeË‡M'â‡ â†’ big â–·
    âˆ—áµ’-monoÊ³ (Î» big â†’ big e eË‡ M' eeË‡M'â‡) â–· â‡›á´¹-eatË¡ â–· â‡›á´¹-mono (?âˆ—áµ’-comm â€º
    âˆ—áµ’-monoÊ³ $ âˆ—áµ’-assocÊ³ â€º âˆ—áµ’-monoË¡ $ âˆ—áµ’Shrunkáµ’-out â€º
    Î»{ (Â§ big) â†’ Â§ âºâŸ¨âŸ©áµ€áµ’-eatË¡ big }))) â€º âºâŸ¨âŸ©áµ€áµ’-kr
