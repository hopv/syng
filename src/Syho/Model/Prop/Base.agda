--------------------------------------------------------------------------------
-- Semantic proposition
--------------------------------------------------------------------------------

{-# OPTIONS --without-K --sized-types #-}

module Syho.Model.Prop.Base where

open import Base.Level using (Level; _âŠ”á´¸_; á¹¡á´¸_; 0á´¸; 1á´¸)
open import Base.Func using (_$_; _â€º_; _âˆ˜_; flip; id; const)
open import Base.Few using (âŠ¤; âŠ¤â‚€; âŠ¥)
open import Base.Eq using (_â‰¡_; refl; â— _; _â‰¡Ë™_; â— Ë™_)
open import Base.Dec using (yes; no; updË™; updË™-self)
open import Base.Size using (ğ•Š; ğ•Š<; Thunk; !; Shrunk; Â§_)
open import Base.Prod using (âˆ‘-syntax; âˆ‘á´µ-syntax; _Ã—_; _,_; -,_; -á´µ,_; Ï€â‚€; Ï€â‚;
  curry; uncurry; âˆ‘-case)
open import Base.Sum using (_â¨¿_; Ä©â‚€_; Ä©â‚_)
open import Base.Nat using (â„•)
open import Base.List using (List; []; _âˆ·_; _$á´¸_; _$â±á´¸_; _$â±á´¸âŸ¨_âŸ©_)
open import Syho.Model.ERA.Base using (ERA)
open import Syho.Model.ERA.Glob using (Globá´±á´¿á´¬; Globá´±á´¿á´¬Ë™; Resá´³; Resá´³Ë™; Envá´³;
  injË™; âœ“Ë™-respá´±; injË™-â‰ˆ; injË™-âˆ™; injË™-Îµ; injË™-âŒâŒŸ; injË™-â†; updË™-injË™-â†; âœ“-injË™)

open ERA Globá´±á´¿á´¬ using (_â‰ˆ_; _âŠ‘_; _âˆ™_; Îµ; âŒ_âŒŸ; _âœ“_; _â†_; â— Ëœ_; _â—‡Ëœ_; âŠ‘-respË¡;
  âŠ‘-refl; âŠ‘-trans; â‰ˆâ‡’âŠ‘; âˆ™-mono; âˆ™-monoË¡; âˆ™-monoÊ³; âˆ™-unitË¡; âˆ™-unitÊ³; âˆ™-comm;
  âˆ™-assocÊ³; âˆ™-assocË¡; âˆ™-incrË¡; âˆ™-incrÊ³; Îµ-min; âŒâŒŸ-mono; âŒâŒŸ-decr; âŒâŒŸ-idem;
  âŒâŒŸ-unitË¡; âŒâŒŸ-âˆ™; âœ“-resp; âœ“-mono)

private variable
  Å‚ Å‚' :  Level

--------------------------------------------------------------------------------
-- Propáµ’ :  Semantic proposition

Propáµ’ :  âˆ€ Å‚ â†’  Set (1á´¸ âŠ”á´¸ á¹¡á´¸ Å‚)
Propáµ’ Å‚ =  Resá´³ â†’  Set Å‚

-- Monoáµ’ Páµ’ :  Páµ’ is monotone over the resource

Monoáµ’ :  Propáµ’ Å‚ â†’  Set (1á´¸ âŠ”á´¸ Å‚)
Monoáµ’ Páµ’ =  âˆ€{a b} â†’  a âŠ‘ b â†’  Páµ’ a â†’  Páµ’ b

private variable
  X Y :  Set Å‚
  Páµ’ Qáµ’ Ráµ’ Sáµ’ :  Propáµ’ Å‚
  Páµ’Ë™ Qáµ’Ë™ :  X â†’  Propáµ’ Å‚
  Páµ’s :  List (Propáµ’ Å‚)
  a b :  Resá´³
  bË™ :  X â†’ Resá´³
  E F G :  Envá´³
  EË™ FË™ :  X â†’  Envá´³
  FPáµ’Ë™ GPáµ’Ë™ FQáµ’Ë™ :  X â†’  Envá´³ Ã— Propáµ’ Å‚
  GPáµ’Ë™Ë™ :  X â†’  Y â†’  Envá´³ Ã— Propáµ’ Å‚
  f :  Y â†’ X
  x y :  X
  xs ys :  List X
  Î¹ :  ğ•Š
  Páµ’á¶¥ Qáµ’á¶¥ :  ğ•Š â†’ Propáµ’ Å‚

--------------------------------------------------------------------------------
-- âŠ¨âœ“, âŠ¨ :  Entailment

infix 1 _âŠ¨âœ“_ _âŠ¨_ âŠ¨_

-- Páµ’ âŠ¨âœ“ Qáµ’ :  Entailment with a validity input
-- Páµ’ âŠ¨ Qáµ’ :  Entailment

_âŠ¨âœ“_ _âŠ¨_ :  Propáµ’ Å‚ â†’  Propáµ’ Å‚' â†’  Set (1á´¸ âŠ”á´¸ Å‚ âŠ”á´¸ Å‚')
Páµ’ âŠ¨âœ“ Qáµ’ =  âˆ€{E a} â†’  E âœ“ a â†’  Páµ’ a â†’  Qáµ’ a
Páµ’ âŠ¨ Qáµ’ =  âˆ€{a} â†’  Páµ’ a â†’  Qáµ’ a

-- âŠ¨ Páµ’ :  Tautology

âŠ¨_ :  Propáµ’ Å‚ â†’  Set (1á´¸ âŠ”á´¸ Å‚)
âŠ¨ Páµ’ =  âˆ€{a} â†’  Páµ’ a

abstract

  -- âŠ¨ into âŠ¨âœ“

  âŠ¨â‡’âŠ¨âœ“ :  Páµ’ âŠ¨ Qáµ’ â†’  Páµ’ âŠ¨âœ“ Qáµ’
  âŠ¨â‡’âŠ¨âœ“ PâŠ¨Q _ =  PâŠ¨Q

  -- Substitute a proposition

  substáµ’ :  âˆ€(Páµ’Ë™ : X â†’ Propáµ’ Å‚) â†’  x â‰¡ y â†’  Páµ’Ë™ x âŠ¨ Páµ’Ë™ y
  substáµ’ Páµ’Ë™ refl =  id

--------------------------------------------------------------------------------
-- âˆ€áµ’, âˆƒáµ’, âˆƒá´µ :  Semantic universal/existential quantification

âˆ€áµ’Ë™ âˆƒáµ’Ë™ âˆƒá´µË™ âˆ€áµ’âˆˆ-syntax âˆƒáµ’âˆˆ-syntax âˆƒá´µâˆˆ-syntax âˆ€áµ’-syntax âˆƒáµ’-syntax âˆƒá´µ-syntax :
  âˆ€{X : Set Å‚} â†’  (X â†’ Propáµ’ Å‚') â†’  Propáµ’ (Å‚ âŠ”á´¸ Å‚')
âˆ€áµ’Ë™ Páµ’Ë™ a =  âˆ€ x â†’  Páµ’Ë™ x a
âˆƒáµ’Ë™ Páµ’Ë™ a =  âˆ‘ x ,  Páµ’Ë™ x a
âˆƒá´µË™ Páµ’Ë™ a =  âˆ‘á´µ x ,  Páµ’Ë™ x a
âˆ€áµ’âˆˆ-syntax =  âˆ€áµ’Ë™
âˆƒáµ’âˆˆ-syntax =  âˆƒáµ’Ë™
âˆƒá´µâˆˆ-syntax =  âˆƒá´µË™
âˆ€áµ’-syntax =  âˆ€áµ’Ë™
âˆƒáµ’-syntax =  âˆƒáµ’Ë™
âˆƒá´µ-syntax =  âˆƒá´µË™
infix 3 âˆ€áµ’âˆˆ-syntax âˆƒáµ’âˆˆ-syntax âˆƒá´µâˆˆ-syntax âˆ€áµ’-syntax âˆƒáµ’-syntax âˆƒá´µ-syntax
syntax âˆ€áµ’âˆˆ-syntax {X = X} (Î» x â†’ Páµ’) =  âˆ€áµ’ x âˆˆ X , Páµ’
syntax âˆƒáµ’âˆˆ-syntax {X = X} (Î» x â†’ Páµ’) =  âˆƒáµ’ x âˆˆ X , Páµ’
syntax âˆƒá´µâˆˆ-syntax {X = X} (Î» x â†’ Páµ’) =  âˆƒá´µ x âˆˆ X , Páµ’
syntax âˆ€áµ’-syntax (Î» x â†’ Páµ’) =  âˆ€áµ’ x , Páµ’
syntax âˆƒáµ’-syntax (Î» x â†’ Páµ’) =  âˆƒáµ’ x , Páµ’
syntax âˆƒá´µ-syntax (Î» x â†’ Páµ’) =  âˆƒá´µ x , Páµ’

abstract

  -- Monoáµ’ for âˆ€áµ’/âˆƒáµ’/âˆƒá´µ

  âˆ€áµ’-Mono :  (âˆ€ x â†’ Monoáµ’ $ Páµ’Ë™ x) â†’  Monoáµ’ $ âˆ€áµ’Ë™ Páµ’Ë™
  âˆ€áµ’-Mono âˆ€MonoP aâŠ‘b âˆ€Pa x =  âˆ€MonoP x aâŠ‘b (âˆ€Pa x)

  âˆƒáµ’-Mono :  (âˆ€ x â†’ Monoáµ’ $ Páµ’Ë™ x) â†’  Monoáµ’ $ âˆƒáµ’Ë™ Páµ’Ë™
  âˆƒáµ’-Mono âˆ€MonoP aâŠ‘b (x , Pa) =  x , âˆ€MonoP x aâŠ‘b Pa

  âˆƒá´µ-Mono :  (âˆ€{{x}} â†’ Monoáµ’ $ Páµ’Ë™ x) â†’  Monoáµ’ $ âˆƒá´µË™ Páµ’Ë™
  âˆƒá´µ-Mono âˆ€MonoP aâŠ‘b (-á´µ, Pa) =  -á´µ, âˆ€MonoP aâŠ‘b Pa

  -- Monotonicity of âˆ€áµ’/âˆƒáµ’/âˆƒá´µ

  âˆ€áµ’-mono :  (âˆ€ x â†’ Páµ’Ë™ x âŠ¨ Qáµ’Ë™ x) â†’  âˆ€áµ’Ë™ Páµ’Ë™ âŠ¨ âˆ€áµ’Ë™ Qáµ’Ë™
  âˆ€áµ’-mono PxâŠ¨Qx âˆ€Pa x =  PxâŠ¨Qx x (âˆ€Pa x)

  âˆƒáµ’-mono :  (âˆ€ x â†’ Páµ’Ë™ x âŠ¨ Qáµ’Ë™ x) â†’  âˆƒáµ’Ë™ Páµ’Ë™ âŠ¨ âˆƒáµ’Ë™ Qáµ’Ë™
  âˆƒáµ’-mono PxâŠ¨Qx (x , Pxa) =  x , PxâŠ¨Qx x Pxa

  âˆƒá´µ-mono :  (âˆ€{{x}} â†’ Páµ’Ë™ x âŠ¨ Qáµ’Ë™ x) â†’  âˆƒá´µË™ Páµ’Ë™ âŠ¨ âˆƒá´µË™ Qáµ’Ë™
  âˆƒá´µ-mono PxâŠ¨Qx (-á´µ, Pxa) =  -á´µ, PxâŠ¨Qx Pxa

  -- Introduce âˆ€áµ’

  âˆ€áµ’-intro :  (âˆ€ x â†’ Páµ’ âŠ¨ Qáµ’Ë™ x) â†’  Páµ’ âŠ¨ âˆ€áµ’Ë™ Qáµ’Ë™
  âˆ€áµ’-intro PâŠ¨Qx Pa x =  PâŠ¨Qx x Pa

--------------------------------------------------------------------------------
-- âŒœ âŒáµ’, âŒœ âŒáµ’Ã—, âŒœ âŒáµ’â†’ :  Semantic set embedding

âŒœ_âŒáµ’ :  Set Å‚ â†’  Propáµ’ Å‚
âŒœ X âŒáµ’ _ =  X

infix 3 âŒœ_âŒáµ’Ã—_ âŒœ_âŒáµ’â†’_
âŒœ_âŒáµ’Ã—_ âŒœ_âŒáµ’â†’_ :  Set Å‚ â†’  Propáµ’ Å‚' â†’  Propáµ’ (Å‚ âŠ”á´¸ Å‚')
âŒœ X âŒáµ’Ã— Páµ’ =  âˆƒáµ’ _ âˆˆ X , Páµ’
âŒœ X âŒáµ’â†’ Páµ’ =  âˆ€áµ’ _ âˆˆ X , Páµ’

abstract

  -- Monoáµ’ for âŒœ âŒáµ’

  âŒœâŒáµ’-Mono :  Monoáµ’ $ âŒœ X âŒáµ’
  âŒœâŒáµ’-Mono _ x =  x

--------------------------------------------------------------------------------
-- Ã—áµ’ :  Semantic conjunction

infixr 7 _Ã—áµ’_
_Ã—áµ’_ :  Propáµ’ Å‚ â†’  Propáµ’ Å‚' â†’  Propáµ’ (Å‚ âŠ”á´¸ Å‚')
(Páµ’ Ã—áµ’ Qáµ’) a =  Páµ’ a Ã— Qáµ’ a

abstract

  -- Monoáµ’ for Ã—áµ’

  Ã—áµ’-Mono :  Monoáµ’ Páµ’ â†’  Monoáµ’ Qáµ’ â†’  Monoáµ’ $ Páµ’ Ã—áµ’ Qáµ’
  Ã—áµ’-Mono MonoP MonoQ aâŠ‘b (Pa , Qa) =  MonoP aâŠ‘b Pa , MonoQ aâŠ‘b Qa

--------------------------------------------------------------------------------
-- â¨¿áµ’ :  Semantic disjunction

infixr 6 _â¨¿áµ’_
_â¨¿áµ’_ :  Propáµ’ Å‚ â†’  Propáµ’ Å‚' â†’  Propáµ’ (Å‚ âŠ”á´¸ Å‚')
(Páµ’ â¨¿áµ’ Qáµ’) a =  Páµ’ a â¨¿ Qáµ’ a

abstract

  -- Monoáµ’ for â¨¿áµ’

  â¨¿áµ’-Mono :  Monoáµ’ Páµ’ â†’  Monoáµ’ Qáµ’ â†’  Monoáµ’ $ Páµ’ â¨¿áµ’ Qáµ’
  â¨¿áµ’-Mono MonoP _ aâŠ‘b (Ä©â‚€ Pa) =  Ä©â‚€ MonoP aâŠ‘b Pa
  â¨¿áµ’-Mono _ MonoQ aâŠ‘b (Ä©â‚ Qa) =  Ä©â‚ MonoQ aâŠ‘b Qa

--------------------------------------------------------------------------------
-- âŠ¤áµ’, âŠ¥áµ’ :  Semantic truth and falsehood

âŠ¤áµ’ âŠ¥áµ’ :  Propáµ’ Å‚
âŠ¤áµ’ _ =  âŠ¤
âŠ¥áµ’ _ =  âŠ¥

-- âŠ¤áµ’, âŠ¥áµ’ of level 0

âŠ¤áµ’â‚€ âŠ¥áµ’â‚€ :  Propáµ’ 0á´¸
âŠ¤áµ’â‚€ =  âŠ¤áµ’
âŠ¥áµ’â‚€ =  âŠ¥áµ’

--------------------------------------------------------------------------------
-- â†’áµ’ :  Semantic implication

abstract

  infixr 3 _â†’áµ’_
  _â†’áµ’_ :  Propáµ’ Å‚ â†’  Propáµ’ Å‚' â†’  Propáµ’ (1á´¸ âŠ”á´¸ Å‚ âŠ”á´¸ Å‚')
  (Páµ’ â†’áµ’ Qáµ’) a =  âˆ€ E b â†’  a âŠ‘ b â†’  E âœ“ b â†’  Páµ’ b â†’  Qáµ’ b

  -- Monoáµ’ for â†’áµ’

  â†’áµ’-Mono :  Monoáµ’ $ Páµ’ â†’áµ’ Qáµ’
  â†’áµ’-Mono aâŠ‘a' Pâ†’Qa _ _ a'âŠ‘b Eâœ“b Páµ’b =  Pâ†’Qa _ _ (âŠ‘-trans aâŠ‘a' a'âŠ‘b) Eâœ“b Páµ’b

  -- Monotonicity of â†’áµ’

  â†’áµ’-mono :  Páµ’ âŠ¨ Qáµ’ â†’  Ráµ’ âŠ¨ Sáµ’ â†’  Qáµ’ â†’áµ’ Ráµ’ âŠ¨ Páµ’ â†’áµ’ Sáµ’
  â†’áµ’-mono PâŠ¨Q RâŠ¨S Qâ†’Ra _ _ aâŠ‘b Eâœ“b =  PâŠ¨Q â€º Qâ†’Ra _ _ aâŠ‘b Eâœ“b â€º RâŠ¨S

  -- âŠ¨âœ“ â†’áµ’ into âŠ¨ â†’áµ’

  âŠ¨âœ“â‡’âŠ¨-â†’áµ’ :  Páµ’ âŠ¨âœ“ Qáµ’ â†’áµ’ Ráµ’ â†’  Páµ’ âŠ¨ Qáµ’ â†’áµ’ Ráµ’
  âŠ¨âœ“â‡’âŠ¨-â†’áµ’ PâŠ¨âœ“Qâ†’R Pa _ _ aâŠ‘b Eâœ“b =  PâŠ¨âœ“Qâ†’R (âœ“-mono aâŠ‘b Eâœ“b) Pa _ _ aâŠ‘b Eâœ“b

  -- Introduce/eliminate â†’áµ’

  â†’áµ’-introË¡ :  Monoáµ’ Qáµ’ â†’  Páµ’ Ã—áµ’ Qáµ’ âŠ¨âœ“ Ráµ’ â†’  Qáµ’ âŠ¨ Páµ’ â†’áµ’ Ráµ’
  â†’áµ’-introË¡ MonoQ PÃ—QâŠ¨âœ“R Qa _ _ aâŠ‘b Eâœ“b Pb =  PÃ—QâŠ¨âœ“R Eâœ“b (Pb , MonoQ aâŠ‘b Qa)

  â†’áµ’-introÊ³ :  Monoáµ’ Qáµ’ â†’  Qáµ’ Ã—áµ’ Páµ’ âŠ¨âœ“ Ráµ’ â†’  Qáµ’ âŠ¨ Páµ’ â†’áµ’ Ráµ’
  â†’áµ’-introÊ³ MonoQ QÃ—PâŠ¨âœ“R =  â†’áµ’-introË¡ MonoQ Î» âœ“a (Pa , Qa) â†’ QÃ—PâŠ¨âœ“R âœ“a (Qa , Pa)

  â†’áµ’-elimË¡ :  Qáµ’ âŠ¨âœ“ Páµ’ â†’áµ’ Ráµ’ â†’  Páµ’ Ã—áµ’ Qáµ’ âŠ¨âœ“ Ráµ’
  â†’áµ’-elimË¡ QâŠ¨âœ“Pâ†’R Eâœ“a (Pa , Qa) =  QâŠ¨âœ“Pâ†’R Eâœ“a Qa _ _ âŠ‘-refl Eâœ“a Pa

  â†’áµ’-elimÊ³ :  Qáµ’ âŠ¨âœ“ Páµ’ â†’áµ’ Ráµ’ â†’  Qáµ’ Ã—áµ’ Páµ’ âŠ¨âœ“ Ráµ’
  â†’áµ’-elimÊ³ QâŠ¨âœ“Pâ†’R âœ“a (Qa , Pa) =  â†’áµ’-elimË¡ QâŠ¨âœ“Pâ†’R âœ“a (Pa , Qa)

--------------------------------------------------------------------------------
-- âˆ—áµ’ :  Semantic separating conjunction

infixr 7 _âˆ—áµ’'_ _âˆ—áµ’_

-- âˆ—áµ’' :  Non-abstract version of âˆ—áµ’

_âˆ—áµ’'_ :  Propáµ’ Å‚ â†’  Propáµ’ Å‚' â†’  Propáµ’ (1á´¸ âŠ”á´¸ Å‚ âŠ”á´¸ Å‚')
(Páµ’ âˆ—áµ’' Qáµ’) a =  âˆ‘ b , âˆ‘ c ,  b âˆ™ c âŠ‘ a  Ã—  Páµ’ b  Ã—  Qáµ’ c

abstract

  -- âˆ—áµ’ :  Semantic separating conjunction

  _âˆ—áµ’_ :  Propáµ’ Å‚ â†’  Propáµ’ Å‚' â†’  Propáµ’ (1á´¸ âŠ”á´¸ Å‚ âŠ”á´¸ Å‚')
  _âˆ—áµ’_ =  _âˆ—áµ’'_

  -- âˆ—áµ’ equals âˆ—áµ’'

  âˆ—áµ’â‰¡âˆ—áµ’' :  _âˆ—áµ’_ {Å‚} {Å‚'} â‰¡ _âˆ—áµ’'_
  âˆ—áµ’â‰¡âˆ—áµ’' =  refl

  âˆ—áµ’â‡’âˆ—áµ’' :  Páµ’ âˆ—áµ’ Qáµ’  âŠ¨  Páµ’ âˆ—áµ’' Qáµ’
  âˆ—áµ’â‡’âˆ—áµ’' {Páµ’ = Páµ’} {Qáµ’ = Qáµ’} =  substáµ’ (Î» F â†’ F Páµ’ Qáµ’) âˆ—áµ’â‰¡âˆ—áµ’'

  âˆ—áµ’'â‡’âˆ—áµ’ :  Páµ’ âˆ—áµ’' Qáµ’  âŠ¨  Páµ’ âˆ—áµ’ Qáµ’
  âˆ—áµ’'â‡’âˆ—áµ’ {Páµ’ = Páµ’} {Qáµ’ = Qáµ’} =  substáµ’ (Î» F â†’ F Páµ’ Qáµ’) $ â—  âˆ—áµ’â‰¡âˆ—áµ’'

  -- Monoáµ’ for âˆ—áµ’

  âˆ—áµ’-Mono :  Monoáµ’ $ Páµ’ âˆ—áµ’ Qáµ’
  âˆ—áµ’-Mono aâŠ‘a' (-, -, bâˆ™câŠ‘a , PbQc) =  -, -, âŠ‘-trans bâˆ™câŠ‘a aâŠ‘a' , PbQc

  -- âˆ—áµ’ is commutative

  âˆ—áµ’-comm :  Páµ’ âˆ—áµ’ Qáµ’ âŠ¨ Qáµ’ âˆ—áµ’ Páµ’
  âˆ—áµ’-comm (-, -, bâˆ™câŠ‘a , Pb , Qc) =  -, -, âŠ‘-respË¡ âˆ™-comm bâˆ™câŠ‘a , Qc , Pb

  -- Monotonicity of âˆ—áµ’

  âˆ—áµ’-monoâœ“Ë¡ :  Páµ’ âŠ¨âœ“ Qáµ’ â†’  Páµ’ âˆ—áµ’ Ráµ’ âŠ¨âœ“ Qáµ’ âˆ—áµ’ Ráµ’
  âˆ—áµ’-monoâœ“Ë¡ PâŠ¨âœ“Q Eâœ“a (-, -, bâˆ™câŠ‘a , Pb , Rc) =
    -, -, bâˆ™câŠ‘a , PâŠ¨âœ“Q (âœ“-mono (âŠ‘-trans âˆ™-incrÊ³ bâˆ™câŠ‘a) Eâœ“a) Pb , Rc

  âˆ—áµ’-monoâœ“Ê³ :  Páµ’ âŠ¨âœ“ Qáµ’ â†’  Ráµ’ âˆ—áµ’ Páµ’ âŠ¨âœ“ Ráµ’ âˆ—áµ’ Qáµ’
  âˆ—áµ’-monoâœ“Ê³ PâŠ¨âœ“Q Eâœ“a =  âˆ—áµ’-comm â€º âˆ—áµ’-monoâœ“Ë¡ PâŠ¨âœ“Q Eâœ“a â€º âˆ—áµ’-comm

  âˆ—áµ’-monoË¡ :  Páµ’ âŠ¨ Qáµ’ â†’  Páµ’ âˆ—áµ’ Ráµ’ âŠ¨ Qáµ’ âˆ—áµ’ Ráµ’
  âˆ—áµ’-monoË¡ PâŠ¨Q (-, -, bâˆ™câŠ‘a , Pb , Rc) =  -, -, bâˆ™câŠ‘a , PâŠ¨Q Pb , Rc

  âˆ—áµ’-monoÊ³ :  Páµ’ âŠ¨ Qáµ’ â†’  Ráµ’ âˆ—áµ’ Páµ’ âŠ¨ Ráµ’ âˆ—áµ’ Qáµ’
  âˆ—áµ’-monoÊ³ PâŠ¨Q =  âˆ—áµ’-comm â€º âˆ—áµ’-monoË¡ PâŠ¨Q â€º âˆ—áµ’-comm

  âˆ—áµ’-mono :  Páµ’ âŠ¨ Qáµ’ â†’  Ráµ’ âŠ¨ Sáµ’ â†’  Páµ’ âˆ—áµ’ Ráµ’ âŠ¨ Qáµ’ âˆ—áµ’ Sáµ’
  âˆ—áµ’-mono PâŠ¨Q RâŠ¨S =  âˆ—áµ’-monoË¡ PâŠ¨Q â€º âˆ—áµ’-monoÊ³ RâŠ¨S

  -- âˆ—áµ’ is associative

  âˆ—áµ’-assocÊ³ :  (Páµ’ âˆ—áµ’ Qáµ’) âˆ—áµ’ Ráµ’ âŠ¨ Páµ’ âˆ—áµ’ (Qáµ’ âˆ—áµ’ Ráµ’)
  âˆ—áµ’-assocÊ³ (-, -, eâˆ™dâŠ‘a , (-, -, bâˆ™câŠ‘e , Pb , Qc) , Rd) =
    -, -, âŠ‘-respË¡ âˆ™-assocÊ³ $ âŠ‘-trans (âˆ™-monoË¡ bâˆ™câŠ‘e) eâˆ™dâŠ‘a , Pb ,
    -, -, âŠ‘-refl , Qc , Rd

  âˆ—áµ’-assocË¡ :  Páµ’ âˆ—áµ’ (Qáµ’ âˆ—áµ’ Ráµ’) âŠ¨ (Páµ’ âˆ—áµ’ Qáµ’) âˆ—áµ’ Ráµ’
  âˆ—áµ’-assocË¡ =
    âˆ—áµ’-comm â€º âˆ—áµ’-monoË¡ âˆ—áµ’-comm â€º âˆ—áµ’-assocÊ³ â€º âˆ—áµ’-comm â€º âˆ—áµ’-monoË¡ âˆ—áµ’-comm

  -- - âˆ—áµ’ / âˆ—áµ’ - is commutative

  ?âˆ—áµ’-comm :  Páµ’ âˆ—áµ’ Qáµ’ âˆ—áµ’ Ráµ’ âŠ¨ Qáµ’ âˆ—áµ’ Páµ’ âˆ—áµ’ Ráµ’
  ?âˆ—áµ’-comm =  âˆ—áµ’-assocË¡ â€º âˆ—áµ’-monoË¡ âˆ—áµ’-comm â€º âˆ—áµ’-assocÊ³

  âˆ—áµ’?-comm :  (Páµ’ âˆ—áµ’ Qáµ’) âˆ—áµ’ Ráµ’ âŠ¨ (Páµ’ âˆ—áµ’ Ráµ’) âˆ—áµ’ Qáµ’
  âˆ—áµ’?-comm =  âˆ—áµ’-assocÊ³ â€º âˆ—áµ’-monoÊ³ âˆ—áµ’-comm â€º âˆ—áµ’-assocË¡

  -- Eliminate âˆ—áµ’

  âˆ—áµ’-elimÊ³ :  Monoáµ’ Páµ’ â†’  Qáµ’ âˆ—áµ’ Páµ’ âŠ¨ Páµ’
  âˆ—áµ’-elimÊ³ MonoP (-, -, bâˆ™câŠ‘a , -, Pc) =  MonoP (âŠ‘-trans âˆ™-incrË¡ bâˆ™câŠ‘a) Pc

  âˆ—áµ’-elimË¡ :  Monoáµ’ Páµ’ â†’  Páµ’ âˆ—áµ’ Qáµ’ âŠ¨ Páµ’
  âˆ—áµ’-elimË¡ MonoP =  âˆ—áµ’-comm â€º âˆ—áµ’-elimÊ³ MonoP

  -- Introduce âˆ—áµ’ with a trivial proposition

  ?âˆ—áµ’-intro :  âŠ¨ Qáµ’ â†’  Páµ’ âŠ¨ Qáµ’ âˆ—áµ’ Páµ’
  ?âˆ—áµ’-intro âŠ¨Q Pa =  -, -, â‰ˆâ‡’âŠ‘ âˆ™-unitË¡ , âŠ¨Q , Pa

  âˆ—áµ’?-intro :  âŠ¨ Qáµ’ â†’  Páµ’ âŠ¨ Páµ’ âˆ—áµ’ Qáµ’
  âˆ—áµ’?-intro âŠ¨Q =  ?âˆ—áµ’-intro âŠ¨Q â€º âˆ—áµ’-comm

  -- âˆƒáµ’/á´µ and â¨¿ commute with âˆ—áµ’

  âˆƒáµ’âˆ—áµ’-out :  âˆƒáµ’Ë™ Páµ’Ë™ âˆ—áµ’ Qáµ’  âŠ¨  âˆƒáµ’ x , Páµ’Ë™ x âˆ—áµ’ Qáµ’
  âˆƒáµ’âˆ—áµ’-out (-, -, bâˆ™câŠ‘a , (-, Pxb) , Qc) =  -, -, -, bâˆ™câŠ‘a , Pxb , Qc

  âˆ—áµ’âˆƒáµ’-out :  Páµ’ âˆ—áµ’ âˆƒáµ’Ë™ Qáµ’Ë™  âŠ¨  âˆƒáµ’ x , Páµ’ âˆ—áµ’ Qáµ’Ë™ x
  âˆ—áµ’âˆƒáµ’-out (-, -, bâˆ™câŠ‘a , Pb , (-, Qxc)) =  -, -, -, bâˆ™câŠ‘a , Pb , Qxc

  âˆƒá´µâˆ—áµ’-out :  âˆƒá´µË™ Páµ’Ë™ âˆ—áµ’ Qáµ’  âŠ¨  âˆƒá´µ x , Páµ’Ë™ x âˆ—áµ’ Qáµ’
  âˆƒá´µâˆ—áµ’-out (-, -, bâˆ™câŠ‘a , (-á´µ, Pxb) , Qc) =  -á´µ, -, -, bâˆ™câŠ‘a , Pxb , Qc

  âˆ—áµ’âˆƒá´µ-out :  Páµ’ âˆ—áµ’ âˆƒá´µË™ Qáµ’Ë™  âŠ¨  âˆƒá´µ x , Páµ’ âˆ—áµ’ Qáµ’Ë™ x
  âˆ—áµ’âˆƒá´µ-out (-, -, bâˆ™câŠ‘a , Pb , (-á´µ, Qxc)) =  -á´µ, -, -, bâˆ™câŠ‘a , Pb , Qxc

  â¨¿áµ’âˆ—áµ’-out :  (Páµ’ â¨¿áµ’ Qáµ’) âˆ—áµ’ Ráµ’  âŠ¨  (Páµ’ âˆ—áµ’ Ráµ’) â¨¿áµ’ (Qáµ’ âˆ—áµ’ Ráµ’)
  â¨¿áµ’âˆ—áµ’-out (-, -, bâˆ™câŠ‘a , Ä©â‚€ Pb , Rc) =  Ä©â‚€ (-, -, bâˆ™câŠ‘a , Pb , Rc)
  â¨¿áµ’âˆ—áµ’-out (-, -, bâˆ™câŠ‘a , Ä©â‚ Qb , Rc) =  Ä©â‚ (-, -, bâˆ™câŠ‘a , Qb , Rc)

  âˆ—áµ’â¨¿áµ’-out :  Páµ’ âˆ—áµ’ (Qáµ’ â¨¿áµ’ Ráµ’)  âŠ¨  (Páµ’ âˆ—áµ’ Qáµ’) â¨¿áµ’ (Páµ’ âˆ—áµ’ Ráµ’)
  âˆ—áµ’â¨¿áµ’-out (-, -, bâˆ™câŠ‘a , Pb , Ä©â‚€ Qc) =  Ä©â‚€ (-, -, bâˆ™câŠ‘a , Pb , Qc)
  âˆ—áµ’â¨¿áµ’-out (-, -, bâˆ™câŠ‘a , Pb , Ä©â‚ Rc) =  Ä©â‚ (-, -, bâˆ™câŠ‘a , Pb , Rc)

--------------------------------------------------------------------------------
-- [âˆ—áµ’] :  Iterated semantic separating conjunction

[âˆ—áµ’] :  List (Propáµ’ Å‚) â†’  Propáµ’ (1á´¸ âŠ”á´¸ Å‚)
[âˆ—áµ’] [] =  âŠ¤áµ’
[âˆ—áµ’] (Páµ’ âˆ· Páµ’s) =  Páµ’ âˆ—áµ’ [âˆ—áµ’] Páµ’s

-- Syntax for [âˆ—áµ’] $á´¸ / $â±á´¸

infix 8 [âˆ—áµ’âˆˆ]-syntax [âˆ—áµ’âˆˆâ±]-syntax [âˆ—áµ’âˆˆâ±âŸ¨âŸ©]-syntax
[âˆ—áµ’âˆˆ] [âˆ—áµ’âˆˆ]-syntax :  (X â†’ Propáµ’ Å‚) â†’  List X â†’  Propáµ’ (1á´¸ âŠ”á´¸ Å‚)
[âˆ—áµ’âˆˆ] Páµ’Ë™ xs =  [âˆ—áµ’] $ Páµ’Ë™ $á´¸ xs
[âˆ—áµ’âˆˆ]-syntax =  [âˆ—áµ’âˆˆ]
[âˆ—áµ’âˆˆâ±] [âˆ—áµ’âˆˆâ±]-syntax :  (â„• Ã— X â†’ Propáµ’ Å‚) â†’  List X â†’  Propáµ’ (1á´¸ âŠ”á´¸ Å‚)
[âˆ—áµ’âˆˆâ±] Páµ’Ë™ xs =  [âˆ—áµ’] $ curry Páµ’Ë™ $â±á´¸ xs
[âˆ—áµ’âˆˆâ±]-syntax =  [âˆ—áµ’âˆˆâ±]
[âˆ—áµ’âˆˆâ±âŸ¨âŸ©] [âˆ—áµ’âˆˆâ±âŸ¨âŸ©]-syntax :  (â„• Ã— X â†’ Propáµ’ Å‚) â†’  â„• â†’  List X â†’  Propáµ’ (1á´¸ âŠ”á´¸ Å‚)
[âˆ—áµ’âˆˆâ±âŸ¨âŸ©] Páµ’Ë™ k xs =  [âˆ—áµ’] $ curry Páµ’Ë™ $â±á´¸âŸ¨ k âŸ© xs
[âˆ—áµ’âˆˆâ±âŸ¨âŸ©]-syntax =  [âˆ—áµ’âˆˆâ±âŸ¨âŸ©]
syntax [âˆ—áµ’âˆˆ]-syntax (Î» x â†’ Páµ’) xs =  [âˆ—áµ’ x âˆˆ xs ] Páµ’
syntax [âˆ—áµ’âˆˆâ±]-syntax (Î» ix â†’ Páµ’) xs =  [âˆ—áµ’ ix âˆˆâ± xs ] Páµ’
syntax [âˆ—áµ’âˆˆâ±âŸ¨âŸ©]-syntax (Î» ix â†’ Páµ’) k xs =  [âˆ—áµ’ ix âˆˆâ±âŸ¨ k âŸ© xs ] Páµ’

abstract

  -- Monoáµ’ for [âˆ—áµ’]

  [âˆ—áµ’]-Mono :  Monoáµ’ $ [âˆ—áµ’] Páµ’s
  [âˆ—áµ’]-Mono {Páµ’s = []} =  _
  [âˆ—áµ’]-Mono {Páµ’s = _ âˆ· _} =  âˆ—áµ’-Mono

--------------------------------------------------------------------------------
-- [âˆ—áµ’âˆˆÂ²] :  Iterated separating conjunction over two lists

infix 8 [âˆ—áµ’âˆˆÂ²]-syntax
[âˆ—áµ’âˆˆÂ²] [âˆ—áµ’âˆˆÂ²]-syntax :
  (X Ã— Y â†’  Propáµ’ Å‚) â†’  List X â†’  List Y â†’  Propáµ’ (1á´¸ âŠ”á´¸ Å‚)
[âˆ—áµ’âˆˆÂ²] Páµ’Ë™ (x âˆ· xs) (y âˆ· ys) =  Páµ’Ë™ (x , y) âˆ—áµ’ [âˆ—áµ’âˆˆÂ²] Páµ’Ë™ xs ys
[âˆ—áµ’âˆˆÂ²] _ [] [] =  âŠ¤áµ’
[âˆ—áµ’âˆˆÂ²] _ _ _ =  âŠ¥áµ’
[âˆ—áµ’âˆˆÂ²]-syntax =  [âˆ—áµ’âˆˆÂ²]

syntax [âˆ—áµ’âˆˆÂ²]-syntax (Î» xy â†’ Páµ’) xs ys =  [âˆ—áµ’ xy âˆˆÂ² xs , ys ] Páµ’

abstract

  -- Monoáµ’ for [âˆ—áµ’âˆˆÂ²]

  [âˆ—áµ’âˆˆÂ²]-Mono :  Monoáµ’ $ [âˆ—áµ’âˆˆÂ²] Páµ’Ë™ xs ys
  [âˆ—áµ’âˆˆÂ²]-Mono {xs = []} {[]} =  _
  [âˆ—áµ’âˆˆÂ²]-Mono {xs = _ âˆ· _} {_ âˆ· _} =  âˆ—áµ’-Mono

--------------------------------------------------------------------------------
-- -âˆ—áµ’ :  Semantic magic wand

infixr 3 _-âˆ—áµ’'_ _-âˆ—áµ’_

-- -âˆ—áµ’' :  Non-abstract version of -âˆ—áµ’

_-âˆ—áµ’'_ :  Propáµ’ Å‚ â†’  Propáµ’ Å‚' â†’  Propáµ’ (1á´¸ âŠ”á´¸ Å‚ âŠ”á´¸ Å‚')
(Páµ’ -âˆ—áµ’' Qáµ’) a =  âˆ€ E b c â†’  a âŠ‘ b â†’  E âœ“ c âˆ™ b â†’  Páµ’ c â†’  Qáµ’ (c âˆ™ b)

abstract

  -- -âˆ—áµ’ :  Semantic magic wand

  _-âˆ—áµ’_ :  Propáµ’ Å‚ â†’  Propáµ’ Å‚' â†’  Propáµ’ (1á´¸ âŠ”á´¸ Å‚ âŠ”á´¸ Å‚')
  _-âˆ—áµ’_ =  _-âˆ—áµ’'_

  -- -âˆ—áµ’ equals -âˆ—áµ’'

  -âˆ—áµ’â‰¡-âˆ—áµ’' :  _-âˆ—áµ’_ {Å‚} {Å‚'} â‰¡ _-âˆ—áµ’'_
  -âˆ—áµ’â‰¡-âˆ—áµ’' =  refl

  -âˆ—áµ’â‡’-âˆ—áµ’' :  Páµ’ -âˆ—áµ’ Qáµ’  âŠ¨  Páµ’ -âˆ—áµ’' Qáµ’
  -âˆ—áµ’â‡’-âˆ—áµ’' {Páµ’ = Páµ’} {Qáµ’ = Qáµ’} =  substáµ’ (Î» F â†’ F Páµ’ Qáµ’) -âˆ—áµ’â‰¡-âˆ—áµ’'

  -âˆ—áµ’'â‡’-âˆ—áµ’ :  Páµ’ -âˆ—áµ’' Qáµ’  âŠ¨  Páµ’ -âˆ—áµ’ Qáµ’
  -âˆ—áµ’'â‡’-âˆ—áµ’ {Páµ’ = Páµ’} {Qáµ’ = Qáµ’} =  substáµ’ (Î» F â†’ F Páµ’ Qáµ’) $ â—  -âˆ—áµ’â‰¡-âˆ—áµ’'

  -- Monoáµ’ for -âˆ—áµ’

  -âˆ—áµ’-Mono :  Monoáµ’ $ Páµ’ -âˆ—áµ’ Qáµ’
  -âˆ—áµ’-Mono aâŠ‘a' P-âˆ—Qa _ _ _ a'âŠ‘b Eâœ“câˆ™b Pc =
    P-âˆ—Qa _ _ _ (âŠ‘-trans aâŠ‘a' a'âŠ‘b) Eâœ“câˆ™b Pc

  -- Monotonicity of -âˆ—áµ’

  -âˆ—áµ’-mono :  Páµ’ âŠ¨ Qáµ’ â†’  Ráµ’ âŠ¨ Sáµ’ â†’  Qáµ’ -âˆ—áµ’ Ráµ’ âŠ¨ Páµ’ -âˆ—áµ’ Sáµ’
  -âˆ—áµ’-mono PâŠ¨Q RâŠ¨S Q-âˆ—Ra _ _ _ aâŠ‘b Eâœ“câˆ™b =
    PâŠ¨Q â€º Q-âˆ—Ra _ _ _ aâŠ‘b Eâœ“câˆ™b â€º RâŠ¨S

  -âˆ—áµ’-monoË¡ :  Páµ’ âŠ¨ Qáµ’ â†’  Qáµ’ -âˆ—áµ’ Ráµ’ âŠ¨ Páµ’ -âˆ—áµ’ Ráµ’
  -âˆ—áµ’-monoË¡ {Ráµ’ = Ráµ’} PâŠ¨Q =  -âˆ—áµ’-mono {Ráµ’ = Ráµ’} PâŠ¨Q id

  -âˆ—áµ’-monoÊ³ :  Páµ’ âŠ¨ Qáµ’ â†’  Ráµ’ -âˆ—áµ’ Páµ’ âŠ¨ Ráµ’ -âˆ—áµ’ Qáµ’
  -âˆ—áµ’-monoÊ³ =  -âˆ—áµ’-mono id

  -- âŠ¨âœ“ -âˆ—áµ’ into âŠ¨ -âˆ—áµ’

  âŠ¨âœ“â‡’âŠ¨--âˆ—áµ’ :  Páµ’ âŠ¨âœ“ Qáµ’ -âˆ—áµ’ Ráµ’ â†’  Páµ’ âŠ¨ Qáµ’ -âˆ—áµ’ Ráµ’
  âŠ¨âœ“â‡’âŠ¨--âˆ—áµ’ PâŠ¨âœ“Q-âˆ—R Pa _ _ _ aâŠ‘b Eâœ“câˆ™b =
    PâŠ¨âœ“Q-âˆ—R (âœ“-mono (âŠ‘-trans aâŠ‘b âˆ™-incrË¡) Eâœ“câˆ™b) Pa _ _ _ aâŠ‘b Eâœ“câˆ™b

  -- Introduce -âˆ—áµ’

  -âˆ—áµ’-introË¡ :  Páµ’ âˆ—áµ’ Qáµ’ âŠ¨âœ“ Ráµ’ â†’  Qáµ’ âŠ¨ Páµ’ -âˆ—áµ’ Ráµ’
  -âˆ—áµ’-introË¡ Pâˆ—QâŠ¨âœ“R Qa _ _ _ aâŠ‘b Eâœ“câˆ™b Pc =
    Pâˆ—QâŠ¨âœ“R Eâœ“câˆ™b (-, -, âˆ™-monoÊ³ aâŠ‘b , Pc , Qa)

  -âˆ—áµ’-introÊ³ :  Qáµ’ âˆ—áµ’ Páµ’ âŠ¨âœ“ Ráµ’ â†’  Qáµ’ âŠ¨ Páµ’ -âˆ—áµ’ Ráµ’
  -âˆ—áµ’-introÊ³ Qâˆ—PâŠ¨âœ“R =  -âˆ—áµ’-introË¡ Î» âœ“âˆ™ â†’ âˆ—áµ’-comm â€º Qâˆ—PâŠ¨âœ“R âœ“âˆ™

  -âˆ—áµ’-intro' :  Monoáµ’ Páµ’ â†’  Páµ’ âŠ¨âœ“ Qáµ’ â†’  âŠ¨ Páµ’ -âˆ—áµ’ Qáµ’
  -âˆ—áµ’-intro' MonoP PâŠ¨âœ“Q =
    -âˆ—áµ’-introË¡ {Qáµ’ = âŠ¤áµ’â‚€} (Î» âœ“âˆ™ â†’ âˆ—áµ’-elimË¡ MonoP â€º PâŠ¨âœ“Q âœ“âˆ™) _

  -- Eliminate -âˆ—áµ’

  -âˆ—áµ’-elimË¡ :  Monoáµ’ Ráµ’ â†’  Qáµ’ âŠ¨âœ“ Páµ’ -âˆ—áµ’ Ráµ’ â†’  Páµ’ âˆ—áµ’ Qáµ’ âŠ¨âœ“ Ráµ’
  -âˆ—áµ’-elimË¡ MonoR QâŠ¨âœ“P-âˆ—R Eâœ“a (-, -, bâˆ™câŠ‘a , Pb , Qc) =  MonoR bâˆ™câŠ‘a $ QâŠ¨âœ“P-âˆ—R
    (âœ“-mono (âŠ‘-trans âˆ™-incrË¡ bâˆ™câŠ‘a) Eâœ“a) Qc _ _ _ âŠ‘-refl (âœ“-mono bâˆ™câŠ‘a Eâœ“a) Pb

  -âˆ—áµ’-elimÊ³ :  Monoáµ’ Ráµ’ â†’  Qáµ’ âŠ¨âœ“ Páµ’ -âˆ—áµ’ Ráµ’ â†’  Qáµ’ âˆ—áµ’ Páµ’ âŠ¨âœ“ Ráµ’
  -âˆ—áµ’-elimÊ³ MonoR QâŠ¨âœ“P-âˆ—R âœ“âˆ™ =  âˆ—áµ’-comm â€º -âˆ—áµ’-elimË¡ MonoR QâŠ¨âœ“P-âˆ—R âœ“âˆ™

  -âˆ—áµ’-applyË¡ :  Monoáµ’ Qáµ’ â†’  Páµ’ âˆ—áµ’ (Páµ’ -âˆ—áµ’ Qáµ’) âŠ¨âœ“ Qáµ’
  -âˆ—áµ’-applyË¡ MonoQ =  -âˆ—áµ’-elimË¡ MonoQ Î» _ â†’ id

  -âˆ—áµ’-applyÊ³ :  Monoáµ’ Qáµ’ â†’  (Páµ’ -âˆ—áµ’ Qáµ’) âˆ—áµ’ Páµ’ âŠ¨âœ“ Qáµ’
  -âˆ—áµ’-applyÊ³ MonoQ âœ“âˆ™ =  âˆ—áµ’-comm â€º -âˆ—áµ’-applyË¡ MonoQ âœ“âˆ™

  -- Let -âˆ—áµ’ eat a proposition

  -âˆ—áµ’-eatÊ³ :  Monoáµ’ Qáµ’ â†’  (Páµ’ -âˆ—áµ’ Qáµ’) âˆ—áµ’ Ráµ’ âŠ¨ Páµ’ -âˆ—áµ’ Qáµ’ âˆ—áµ’ Ráµ’
  -âˆ—áµ’-eatÊ³ MonoQ =  -âˆ—áµ’-introË¡ Î» âœ“âˆ™ â†’ âˆ—áµ’-assocË¡ â€º âˆ—áµ’-monoâœ“Ë¡ (-âˆ—áµ’-applyË¡ MonoQ) âœ“âˆ™

  -âˆ—áµ’-eatË¡ :  Monoáµ’ Qáµ’ â†’  Ráµ’ âˆ—áµ’ (Páµ’ -âˆ—áµ’ Qáµ’) âŠ¨ Páµ’ -âˆ—áµ’ Ráµ’ âˆ—áµ’ Qáµ’
  -âˆ—áµ’-eatË¡ {Qáµ’ = Qáµ’} {Ráµ’ = Ráµ’} MonoQ =  âˆ—áµ’-comm â€º -âˆ—áµ’-eatÊ³ MonoQ â€º
    -âˆ—áµ’-monoÊ³ Î»{a} â†’ âˆ—áµ’-comm {Páµ’ = Qáµ’} {Qáµ’ = Ráµ’} {a}

--------------------------------------------------------------------------------
-- â¤‡áµ’ :  Semantic update modality

abstract

  infix 3 â¤‡áµ’_
  â¤‡áµ’_ :  Propáµ’ Å‚ â†’  Propáµ’ (1á´¸ âŠ”á´¸ Å‚)
  (â¤‡áµ’ Páµ’) a =  âˆ€ E c â†’  E âœ“ a âˆ™ c â†’  âˆ‘ b ,  E âœ“ b âˆ™ c  Ã—  Páµ’ b

  -- Monoáµ’ for â¤‡áµ’

  â¤‡áµ’-Mono :  Monoáµ’ $ â¤‡áµ’ Páµ’
  â¤‡áµ’-Mono aâŠ‘a' â¤‡Pa _ _ Eâœ“a'âˆ™c =  â¤‡Pa _ _ $ âœ“-mono (âˆ™-monoË¡ aâŠ‘a') Eâœ“a'âˆ™c

  -- Monotonicity of â¤‡áµ’

  â¤‡áµ’-monoâœ“ :  Páµ’ âŠ¨âœ“ Qáµ’ â†’  â¤‡áµ’ Páµ’ âŠ¨ â¤‡áµ’ Qáµ’
  â¤‡áµ’-monoâœ“ PâŠ¨âœ“Q â¤‡Pa _ _ Eâœ“aâˆ™c  with â¤‡Pa _ _ Eâœ“aâˆ™c
  â€¦ | -, Eâœ“bâˆ™c , Pb =  -, Eâœ“bâˆ™c , PâŠ¨âœ“Q (âœ“-mono âˆ™-incrÊ³ Eâœ“bâˆ™c) Pb

  â¤‡áµ’-mono :  Páµ’ âŠ¨ Qáµ’ â†’  â¤‡áµ’ Páµ’ âŠ¨ â¤‡áµ’ Qáµ’
  â¤‡áµ’-mono =  â¤‡áµ’-monoâœ“ âˆ˜ âŠ¨â‡’âŠ¨âœ“

  -- Introduce â¤‡áµ’

  â¤‡áµ’-intro :  Páµ’ âŠ¨ â¤‡áµ’ Páµ’
  â¤‡áµ’-intro Pa _ _ Eâœ“aâˆ™c =  -, Eâœ“aâˆ™c , Pa

  -- Join â¤‡áµ’s

  â¤‡áµ’-join :  â¤‡áµ’ â¤‡áµ’ Páµ’ âŠ¨ â¤‡áµ’ Páµ’
  â¤‡áµ’-join â¤‡â¤‡Pa _ _ Eâœ“aâˆ™d  with â¤‡â¤‡Pa _ _ Eâœ“aâˆ™d
  â€¦ | -, Eâœ“bâˆ™d , â¤‡Pb  with â¤‡Pb _ _ Eâœ“bâˆ™d
  â€¦   | -, Eâœ“câˆ™d , Pc =  -, Eâœ“câˆ™d , Pc

  -- Let â¤‡áµ’ eat a proposition under âˆ—áµ’

  â¤‡áµ’-eatÊ³ :  (â¤‡áµ’ Páµ’) âˆ—áµ’ Qáµ’  âŠ¨ â¤‡áµ’  Páµ’ âˆ—áµ’ Qáµ’
  â¤‡áµ’-eatÊ³ (-, -, bâˆ™câŠ‘a , â¤‡Pb , Qc) _ _ Eâœ“aâˆ™e
    with â¤‡Pb _ _ $ flip âœ“-mono Eâœ“aâˆ™e $ âŠ‘-respË¡ âˆ™-assocÊ³ $ âˆ™-monoË¡ bâˆ™câŠ‘a
  â€¦ | -, Eâœ“dâˆ™ce , Pd =  -, âœ“-resp âˆ™-assocË¡ Eâœ“dâˆ™ce , -, -, âŠ‘-refl , Pd , Qc

  â¤‡áµ’-eatË¡ :  Qáµ’ âˆ—áµ’ (â¤‡áµ’ Páµ’)  âŠ¨ â¤‡áµ’  Qáµ’ âˆ—áµ’ Páµ’
  â¤‡áµ’-eatË¡ =  âˆ—áµ’-comm â€º â¤‡áµ’-eatÊ³ â€º â¤‡áµ’-mono âˆ—áµ’-comm

  -- Let âŒœ âŒáµ’Ã— go out of â¤‡áµ’

  â¤‡áµ’-âŒœâŒáµ’Ã—-out :  â¤‡áµ’ âŒœ X âŒáµ’Ã— Páµ’  âŠ¨âœ“  âŒœ X âŒáµ’Ã— â¤‡áµ’ Páµ’
  â¤‡áµ’-âŒœâŒáµ’Ã—-out Eâœ“a â¤‡XP .Ï€â‚€ =
    let -, -, x , _ = â¤‡XP _ _ $ âœ“-resp (â— Ëœ âˆ™-unitÊ³) Eâœ“a in  x
  â¤‡áµ’-âŒœâŒáµ’Ã—-out _ â¤‡XP .Ï€â‚ _ _ Eâœ“aâˆ™c =
    let -, Eâœ“bâˆ™c , -, Pb = â¤‡XP _ _ Eâœ“aâˆ™c in  -, Eâœ“bâˆ™c , Pb

  -- âŠ¨âœ“ â¤‡áµ’ into âŠ¨ â¤‡áµ’

  âŠ¨âœ“â‡’âŠ¨-â¤‡áµ’ :  Páµ’ âŠ¨âœ“ â¤‡áµ’ Qáµ’ â†’  Páµ’ âŠ¨ â¤‡áµ’ Qáµ’
  âŠ¨âœ“â‡’âŠ¨-â¤‡áµ’ PâŠ¨âœ“â¤‡Q Pa _ _ Eâœ“aâˆ™c =  PâŠ¨âœ“â¤‡Q (âœ“-mono âˆ™-incrÊ³ Eâœ“aâˆ™c) Pa _ _ Eâœ“aâˆ™c

--------------------------------------------------------------------------------
-- â¤‡á´± :  Environmental update modality

infixr 3 _â¤‡á´±'_ _â¤‡á´±_

-- â¤‡á´±' :  Non-abstract version of â¤‡á´±

_â¤‡á´±'_ :  âˆ€{X : Set Å‚'} â†’  Envá´³ â†’  (X â†’ Envá´³ Ã— Propáµ’ Å‚) â†’  Propáµ’ (1á´¸ âŠ”á´¸ Å‚ âŠ”á´¸ Å‚')
(E â¤‡á´±' FPáµ’Ë™) a =  âˆ€ c â†’  E âœ“ a âˆ™ c â†’  âˆ‘ x , âˆ‘ b ,
  let (F , Páµ’) = FPáµ’Ë™ x in  F âœ“ b âˆ™ c  Ã—  Páµ’ b

abstract

  -- â¤‡á´± :  Environmental update modality

  _â¤‡á´±_ :  âˆ€{X : Set Å‚'} â†’  Envá´³ â†’  (X â†’ Envá´³ Ã— Propáµ’ Å‚) â†’  Propáµ’ (1á´¸ âŠ”á´¸ Å‚ âŠ”á´¸ Å‚')
  _â¤‡á´±_ =  _â¤‡á´±'_

  -- â¤‡á´± equals â¤‡á´±'

  â¤‡á´±â‰¡â¤‡á´±' :  _â¤‡á´±_ {Å‚} {Å‚'} {X} â‰¡ _â¤‡á´±'_
  â¤‡á´±â‰¡â¤‡á´±' =  refl

  -- Monoáµ’ for â¤‡á´±

  â¤‡á´±-Mono :  Monoáµ’ $ E â¤‡á´± FPáµ’Ë™
  â¤‡á´±-Mono aâŠ‘a' Eâ¤‡FPa _ Eâœ“a'âˆ™c =  Eâ¤‡FPa _ $ âœ“-mono (âˆ™-monoË¡ aâŠ‘a') Eâœ“a'âˆ™c

  -- Monotonicity of â¤‡á´±

  â¤‡á´±-monoâœ“ :  (âˆ€ x â†’  Páµ’Ë™ x âŠ¨âœ“ Qáµ’Ë™ x)  â†’
              E â¤‡á´± (Î» x â†’ FË™ x , Páµ’Ë™ x)  âŠ¨  E â¤‡á´± Î» x â†’ FË™ x , Qáµ’Ë™ x
  â¤‡á´±-monoâœ“ PxâŠ¨âœ“Qx Eâ¤‡FPa _ Eâœ“aâˆ™c  with Eâ¤‡FPa _ Eâœ“aâˆ™c
  â€¦ | -, -, Fâœ“bâˆ™c , Pb =  -, -, Fâœ“bâˆ™c , PxâŠ¨âœ“Qx _ (âœ“-mono âˆ™-incrÊ³ Fâœ“bâˆ™c) Pb

  â¤‡á´±-mono :  (âˆ€ x â†’  Páµ’Ë™ x âŠ¨ Qáµ’Ë™ x)  â†’
             E â¤‡á´± (Î» x â†’ FË™ x , Páµ’Ë™ x)  âŠ¨  E â¤‡á´± Î» x â†’ FË™ x , Qáµ’Ë™ x
  â¤‡á´±-mono =  â¤‡á´±-monoâœ“ âˆ˜ (âŠ¨â‡’âŠ¨âœ“ âˆ˜_)

  -- Update the environment of â¤‡á´±

  â¤‡á´±-respá´±Ë¡ :  E â‰¡Ë™ F â†’  E â¤‡á´± GPáµ’Ë™ âŠ¨ F â¤‡á´± GPáµ’Ë™
  â¤‡á´±-respá´±Ë¡ Eâ‰¡F Eâ¤‡GP _ Fâœ“aâˆ™c =  Eâ¤‡GP _ $ âœ“Ë™-respá´± (â— Ë™ Eâ‰¡F) Fâœ“aâˆ™c

  â¤‡á´±-respá´±Ê³ :  (âˆ€{x} â†’ EË™ x â‰¡Ë™ FË™ x) â†’
               G â¤‡á´± (Î» x â†’ EË™ x , Páµ’Ë™ x)  âŠ¨  G â¤‡á´± Î» x â†’ FË™ x , Páµ’Ë™ x
  â¤‡á´±-respá´±Ê³ Exâ‰¡Fx Gâ¤‡EP _ Gâœ“aâˆ™c  with Gâ¤‡EP _ Gâœ“aâˆ™c
  â€¦ | -, -, Eâœ“bâˆ™c , Pb =  -, -, âœ“Ë™-respá´± Exâ‰¡Fx Eâœ“bâˆ™c , Pb

  -- Change parameterization of â¤‡á´±

  â¤‡á´±-param :  E â¤‡á´± FPáµ’Ë™ âˆ˜ f  âŠ¨  E â¤‡á´± FPáµ’Ë™
  â¤‡á´±-param Eâ¤‡FPf _ Eâœ“aâˆ™c  with Eâ¤‡FPf _ Eâœ“aâˆ™c
  â€¦ | -, b,Fâœ“b,Pbâˆ™c =  -, b,Fâœ“b,Pbâˆ™c

  -- âŠ¨âœ“ â¤‡á´± into âŠ¨ â¤‡á´±

  âŠ¨âœ“â‡’âŠ¨-â¤‡á´± :  Páµ’ âŠ¨âœ“ E â¤‡á´± FQáµ’Ë™ â†’  Páµ’ âŠ¨ E â¤‡á´± FQáµ’Ë™
  âŠ¨âœ“â‡’âŠ¨-â¤‡á´± PâŠ¨âœ“Eâ¤‡FQ Pa _ Eâœ“aâˆ™c =  PâŠ¨âœ“Eâ¤‡FQ (âœ“-mono âˆ™-incrÊ³ Eâœ“aâˆ™c) Pa _ Eâœ“aâˆ™c

  -- Introduce â¤‡á´±

  â¤‡áµ’â‡’â¤‡á´± :  â¤‡áµ’ Páµ’  âŠ¨  E â¤‡á´± Î» (_ : âŠ¤â‚€) â†’ E , Páµ’
  â¤‡áµ’â‡’â¤‡á´± â¤‡áµ’Pa _ Eâœ“aâˆ™c  with â¤‡áµ’Pa _ _ Eâœ“aâˆ™c
  â€¦ | (-, Eâœ“bâˆ™c , Pb) =  -, -, Eâœ“bâˆ™c , Pb

  â¤‡á´±-intro :  Páµ’  âŠ¨  E â¤‡á´± Î» (_ : âŠ¤â‚€) â†’ E , Páµ’
  â¤‡á´±-intro =  â¤‡áµ’-intro â€º â¤‡áµ’â‡’â¤‡á´±

  -- Introduce â¤‡á´± with the validity of E

  â¤‡á´±-intro-âœ“ :  Páµ’  âŠ¨  E â¤‡á´± Î» (_ : âˆ‘ a , E âœ“ a) â†’ E , Páµ’
  â¤‡á´±-intro-âœ“ Pa _ Eâœ“aâˆ™c =  (-, Eâœ“aâˆ™c) , -, Eâœ“aâˆ™c , Pa

  -- Join â¤‡á´±s

  â¤‡á´±-join :  E â¤‡á´± (Î» x â†’ FË™ x , FË™ x â¤‡á´± GPáµ’Ë™Ë™ x)  âŠ¨  E â¤‡á´± uncurry GPáµ’Ë™Ë™
  â¤‡á´±-join Eâ¤‡F,Fâ¤‡GPx _ Eâœ“aâˆ™d  with Eâ¤‡F,Fâ¤‡GPx _ Eâœ“aâˆ™d
  â€¦ | -, -, Fâœ“bâˆ™d , Fâ¤‡GPxb  with Fâ¤‡GPxb _ Fâœ“bâˆ™d
  â€¦   | -, -, Gxyâœ“câˆ™d , Pxyc =  -, -, Gxyâœ“câˆ™d , Pxyc

  -- Let â¤‡á´± eat a proposition under âˆ—áµ’

  â¤‡á´±-eatÊ³ :  (E â¤‡á´± Î» x â†’ FË™ x , Páµ’Ë™ x)  âˆ—áµ’  Qáµ’  âŠ¨ E â¤‡á´± Î» x â†’ FË™ x ,  Páµ’Ë™ x âˆ—áµ’ Qáµ’
  â¤‡á´±-eatÊ³ (-, -, bâˆ™câŠ‘a , Eâ¤‡FPb , Qc) _ Eâœ“aâˆ™e
    with Eâ¤‡FPb _ $ flip âœ“-mono Eâœ“aâˆ™e $ âŠ‘-respË¡ âˆ™-assocÊ³ $ âˆ™-monoË¡ bâˆ™câŠ‘a
  â€¦ | -, -, Fâœ“dâˆ™ce , Pd =
    -, -, âœ“-resp âˆ™-assocË¡ Fâœ“dâˆ™ce , -, -, âŠ‘-refl , Pd , Qc

  â¤‡á´±-eatË¡ :  Qáµ’  âˆ—áµ’  (E â¤‡á´± Î» x â†’ FË™ x , Páµ’Ë™ x)  âŠ¨ E â¤‡á´± Î» x â†’ FË™ x ,  Qáµ’ âˆ—áµ’ Páµ’Ë™ x
  â¤‡á´±-eatË¡ =  âˆ—áµ’-comm â€º â¤‡á´±-eatÊ³ â€º â¤‡á´±-mono Î» _ â†’ âˆ—áµ’-comm

  -- Perform a step by â¤‡á´±

  â¤‡á´±-step :  E âœ“ a  â†’  (E â¤‡á´± Î» x â†’ FË™ x , Páµ’Ë™ x) a â†’
             âˆ‘ x , âˆ‘ b ,  FË™ x âœ“ b  Ã—  Páµ’Ë™ x b
  â¤‡á´±-step Eâœ“a Eâ¤‡FxPxa  with Eâ¤‡FxPxa _ $ âœ“-resp (â— Ëœ âˆ™-unitÊ³) Eâœ“a
  â€¦ | -, -, Fxâœ“bâˆ™Îµ , Pxb =  -, -, âœ“-resp âˆ™-unitÊ³ Fxâœ“bâˆ™Îµ , Pxb

--------------------------------------------------------------------------------
-- â–¡áµ’ :  Semantic persistence modality

infix 8 â–¡áµ’_
â–¡áµ’_ :  Propáµ’ Å‚ â†’  Propáµ’ Å‚
(â–¡áµ’ Páµ’) a =  Páµ’ âŒ a âŒŸ

abstract

  -- Monoáµ’ for â–¡áµ’

  â–¡áµ’-Mono :  Monoáµ’ Páµ’ â†’  Monoáµ’ $ â–¡áµ’ Páµ’
  â–¡áµ’-Mono MonoP aâŠ‘b PâŒaâŒŸ =  MonoP (âŒâŒŸ-mono aâŠ‘b) PâŒaâŒŸ

  -- Monotonicity of â–¡áµ’

  â–¡áµ’-monoâœ“ :  Páµ’ âŠ¨âœ“ Qáµ’ â†’  â–¡áµ’ Páµ’ âŠ¨âœ“ â–¡áµ’ Qáµ’
  â–¡áµ’-monoâœ“ PâŠ¨âœ“Q Eâœ“a =  PâŠ¨âœ“Q $ âœ“-mono âŒâŒŸ-decr Eâœ“a

  â–¡áµ’-mono :  Páµ’ âŠ¨ Qáµ’ â†’  â–¡áµ’ Páµ’ âŠ¨ â–¡áµ’ Qáµ’
  â–¡áµ’-mono PâŠ¨Q =  PâŠ¨Q

  -- Eliminate â–¡áµ’

  â–¡áµ’-elim :  Monoáµ’ Páµ’ â†’  â–¡áµ’ Páµ’ âŠ¨ Páµ’
  â–¡áµ’-elim MonoP PâŒaâŒŸ =  MonoP âŒâŒŸ-decr PâŒaâŒŸ

  -- Duplicate â–¡áµ’

  â–¡áµ’-dup :  Monoáµ’ Páµ’ â†’  â–¡áµ’ Páµ’ âŠ¨ â–¡áµ’ â–¡áµ’ Páµ’
  â–¡áµ’-dup MonoP PâŒaâŒŸ =  MonoP (â‰ˆâ‡’âŠ‘ $ â— Ëœ âŒâŒŸ-idem) PâŒaâŒŸ

  -- Change Ã—áµ’ into âˆ—áµ’ when one argument is under â–¡áµ’

  â–¡áµ’Ë¡-Ã—áµ’â‡’âˆ—áµ’ :  Monoáµ’ Páµ’ â†’  â–¡áµ’ Páµ’ Ã—áµ’ Qáµ’  âŠ¨  â–¡áµ’ Páµ’ âˆ—áµ’ Qáµ’
  â–¡áµ’Ë¡-Ã—áµ’â‡’âˆ—áµ’ MonoP (PâŒaâŒŸ , Qa) =  -, -, â‰ˆâ‡’âŠ‘ âŒâŒŸ-unitË¡ ,
    MonoP (â‰ˆâ‡’âŠ‘ $ â— Ëœ âŒâŒŸ-idem) PâŒaâŒŸ , Qa

  -- Duplicate â–¡áµ’ Páµ’

  dup-â–¡áµ’ :  Monoáµ’ Páµ’ â†’  â–¡áµ’ Páµ’  âŠ¨  â–¡áµ’ Páµ’ âˆ—áµ’ â–¡áµ’ Páµ’
  dup-â–¡áµ’ MonoP =  (Î» Pa â†’ Pa , Pa) â€º â–¡áµ’Ë¡-Ã—áµ’â‡’âˆ—áµ’ MonoP

  -- â–¡áµ’ commutes with âˆ—áµ’

  â–¡áµ’-âˆ—áµ’-out :  Monoáµ’ Páµ’ â†’  Monoáµ’ Qáµ’ â†’  â–¡áµ’ (Páµ’ âˆ—áµ’ Qáµ’)  âŠ¨  â–¡áµ’ Páµ’ âˆ—áµ’ â–¡áµ’ Qáµ’
  â–¡áµ’-âˆ—áµ’-out MonoP MonoQ (-, -, bâˆ™câŠ‘âŒaâŒŸ , Pb , Qc) =  â–¡áµ’Ë¡-Ã—áµ’â‡’âˆ—áµ’ MonoP
    (MonoP (âŠ‘-trans âˆ™-incrÊ³ bâˆ™câŠ‘âŒaâŒŸ) Pb , MonoQ (âŠ‘-trans âˆ™-incrË¡ bâˆ™câŠ‘âŒaâŒŸ) Qc)

  â–¡áµ’-âˆ—áµ’-in :  â–¡áµ’ Páµ’ âˆ—áµ’ â–¡áµ’ Qáµ’  âŠ¨  â–¡áµ’ (Páµ’ âˆ—áµ’ Qáµ’)
  â–¡áµ’-âˆ—áµ’-in(-, -, bâˆ™câŠ‘a , PâŒbâŒŸ , QâŒcâŒŸ) =
    -, -, âŠ‘-trans âŒâŒŸ-âˆ™ (âŒâŒŸ-mono bâˆ™câŠ‘a) , PâŒbâŒŸ , QâŒcâŒŸ

--------------------------------------------------------------------------------
-- â— :  Semantically own a resource

abstract

  infix 8 â—_
  â—_ :  Resá´³ â†’  Propáµ’ 1á´¸
  (â— a) b =  a âŠ‘ b

  -- Monoáµ’ for â—

  â—-Mono :  Monoáµ’ $ â— a
  â—-Mono bâŠ‘c aâŠ‘b =  âŠ‘-trans aâŠ‘b bâŠ‘c

  -- Modify the resource of â—

  â—-resp :  a â‰ˆ b â†’  â— a âŠ¨ â— b
  â—-resp aâ‰ˆb aâŠ‘c =  âŠ‘-respË¡ aâ‰ˆb aâŠ‘c

  â—-mono :  b âŠ‘ a â†’  â— a âŠ¨ â— b
  â—-mono bâŠ‘a aâŠ‘c =  âŠ‘-trans bâŠ‘a aâŠ‘c

  -- Get â— Îµ

  â—-Îµ :  âŠ¨ â— Îµ
  â—-Îµ =  Îµ-min

  â—-â‰ˆÎµ :  a â‰ˆ Îµ â†’  âŠ¨ â— a
  â—-â‰ˆÎµ aâ‰ˆÎµ =  â—-resp (â— Ëœ aâ‰ˆÎµ) â—-Îµ

  -- â— a âˆ—áµ’ â— b agrees with â— (a âˆ™ b)

  â—-âˆ—áµ’â‡’âˆ™ :  â— a âˆ—áµ’ â— b  âŠ¨  â— (a âˆ™ b)
  â—-âˆ—áµ’â‡’âˆ™ (-, -, a'âˆ™b'âŠ‘c , aâŠ‘a' , bâŠ‘b') =  âŠ‘-trans (âˆ™-mono aâŠ‘a' bâŠ‘b') a'âˆ™b'âŠ‘c

  â—-âˆ™â‡’âˆ—áµ’ :  â— (a âˆ™ b)  âŠ¨  â— a âˆ—áµ’ â— b
  â—-âˆ™â‡’âˆ—áµ’ aâˆ™bâŠ‘c =  -, -, aâˆ™bâŠ‘c , âŠ‘-refl , âŠ‘-refl

  -- â— a is persistent when âŒ a âŒŸ agrees with a

  â—-âŒâŒŸâ‰ˆ-â–¡áµ’ :  âŒ a âŒŸ â‰ˆ a â†’  â— a  âŠ¨  â–¡áµ’ â— a
  â—-âŒâŒŸâ‰ˆ-â–¡áµ’ âŒaâŒŸâ‰ˆa aâŠ‘b =  âŠ‘-respË¡ âŒaâŒŸâ‰ˆa $ âŒâŒŸ-mono aâŠ‘b

  -- â— a into âœ“ a

  â—-âœ“ :  â— a  âŠ¨âœ“  âŒœ âˆ‘ E , E âœ“ a âŒáµ’
  â—-âœ“ Eâœ“b aâŠ‘b =  -, âœ“-mono aâŠ‘b Eâœ“b

  -- Get (â— a) a

  â—-just :  (â— a) a
  â—-just =  âŠ‘-refl

  -- â† into â¤‡áµ’ on â—

  â†-â—-â¤‡áµ’-âˆƒáµ’ :  (âˆ€{E} â†’  (E , a)  â† Î» x â†’  E , bË™ x) â†’
               â— a  âŠ¨ â¤‡áµ’  âˆƒáµ’ x , â— bË™ x
  â†-â—-â¤‡áµ’-âˆƒáµ’ Eaâ†Ebx aâŠ‘a' _ _ Eâœ“a'âˆ™c  with Eaâ†Ebx _ $ âœ“-mono (âˆ™-monoË¡ aâŠ‘a') Eâœ“a'âˆ™c
  â€¦ | -, Eâœ“bxâˆ™c =  -, Eâœ“bxâˆ™c , -, âŠ‘-refl

  -- â† into â¤‡á´± on â—

  â†-â—-â¤‡á´± :  ((E , a)  â† Î» x â†’  FË™ x , bË™ x)  â†’
            â— a  âŠ¨  E  â¤‡á´± Î» x â†’  FË™ x , â— bË™ x
  â†-â—-â¤‡á´± Eaâ†Fxbx aâŠ‘a' _ Eâœ“a'âˆ™c  with Eaâ†Fxbx _ $ âœ“-mono (âˆ™-monoË¡ aâŠ‘a') Eâœ“a'âˆ™c
  â€¦ | -, Fxâœ“bxâˆ™c =  -, -, Fxâœ“bxâˆ™c , âŠ‘-refl

  -- Adequacy of â¤‡á´±
  -- If we have Y under â— a and E â¤‡á´± for a and E such that E âœ“ a,
  -- then Y holds purely

  â¤‡á´±-adeq :  E âœ“ a â†’  â— a âŠ¨ E â¤‡á´± (Î» x â†’ FË™ x , âŒœ Y âŒáµ’) â†’  Y
  â¤‡á´±-adeq Eâœ“a aâŠ¨Eâ¤‡FxY =
    let (-, -, -, y) = aâŠ¨Eâ¤‡FxY âŠ‘-refl _ (âœ“-resp (â— Ëœ âˆ™-unitÊ³) Eâœ“a) in y

-- On an component ERA

-- â—âŸ¨ âŸ© :  Semantically own a resource of a component ERA

infix 8 â—âŸ¨_âŸ©_
â—âŸ¨_âŸ©_ :  âˆ€ i â†’  Resá´³Ë™ i â†’  Propáµ’ 1á´¸
â—âŸ¨ i âŸ© aâ± =  â— injË™ i aâ±

module _ {i : â„•} where

  open ERA (Globá´±á´¿á´¬Ë™ i) using () renaming (Res to Resâ±; Env to Envâ±;
    _â‰ˆ_ to _â‰ˆâ±_; _âˆ™_ to _âˆ™â±_; Îµ to Îµâ±; âŒ_âŒŸ to âŒ_âŒŸâ±; _âœ“_ to _âœ“â±_; _â†_ to _â†â±_;
    â‰¡â‡’â‰ˆ to â‰¡â‡’â‰ˆâ±)

  private variable
    Fâ±Ë™ :  X â†’ Envâ±
    aâ± bâ± :  Resâ±
    aâ±Ë™ bâ±Ë™ :  X â†’ Resâ±

  abstract

    â—âŸ¨âŸ©-resp :  aâ± â‰ˆâ± bâ± â†’  â—âŸ¨ i âŸ© aâ± âŠ¨ â—âŸ¨ i âŸ© bâ±
    â—âŸ¨âŸ©-resp =  injË™-â‰ˆ â€º â—-resp

    -- Get â—âŸ¨ i âŸ© Îµâ±

    â—âŸ¨âŸ©-Îµ :  âŠ¨  â—âŸ¨ i âŸ© Îµâ±
    â—âŸ¨âŸ©-Îµ =  â—-â‰ˆÎµ injË™-Îµ

    -- â—âŸ¨ i âŸ© aâ± âˆ—áµ’ â—âŸ¨ i âŸ© bâ± agrees with â—âŸ¨ i âŸ© (aâ± âˆ™â± bâ±)

    â—âŸ¨âŸ©-âˆ—áµ’â‡’âˆ™ :  â—âŸ¨ i âŸ© aâ±  âˆ—áµ’  â—âŸ¨ i âŸ© bâ±  âŠ¨  â—âŸ¨ i âŸ© (aâ± âˆ™â± bâ±)
    â—âŸ¨âŸ©-âˆ—áµ’â‡’âˆ™ =  â—-âˆ—áµ’â‡’âˆ™ â€º â—-resp injË™-âˆ™

    â—âŸ¨âŸ©-âˆ™â‡’âˆ—áµ’ :  â—âŸ¨ i âŸ© (aâ± âˆ™â± bâ±)  âŠ¨  â—âŸ¨ i âŸ© aâ±  âˆ—áµ’  â—âŸ¨ i âŸ© bâ±
    â—âŸ¨âŸ©-âˆ™â‡’âˆ—áµ’ =  â—-resp (â— Ëœ injË™-âˆ™) â€º â—-âˆ™â‡’âˆ—áµ’

    -- â—âŸ¨ i âŸ© aâ± is persistent when âŒ aâ± âŒŸ agrees with aâ±

    â—âŸ¨âŸ©-âŒâŒŸâ‰ˆ-â–¡áµ’ :  âŒ aâ± âŒŸâ± â‰ˆâ± aâ± â†’  â—âŸ¨ i âŸ© aâ±  âŠ¨  â–¡áµ’ â—âŸ¨ i âŸ© aâ±
    â—âŸ¨âŸ©-âŒâŒŸâ‰ˆ-â–¡áµ’ âŒaâŒŸâ‰ˆa =  â—-âŒâŒŸâ‰ˆ-â–¡áµ’ $ injË™-âŒâŒŸ â—‡Ëœ injË™-â‰ˆ âŒaâŒŸâ‰ˆa

    â—âŸ¨âŸ©-âŒâŒŸâ‰¡-â–¡áµ’ :  âŒ aâ± âŒŸâ± â‰¡ aâ± â†’  â—âŸ¨ i âŸ© aâ±  âŠ¨  â–¡áµ’ â—âŸ¨ i âŸ© aâ±
    â—âŸ¨âŸ©-âŒâŒŸâ‰¡-â–¡áµ’ âŒaâŒŸâ‰¡a =  â—âŸ¨âŸ©-âŒâŒŸâ‰ˆ-â–¡áµ’ $ â‰¡â‡’â‰ˆâ± âŒaâŒŸâ‰¡a

    -- â—âŸ¨ i âŸ© aâ± into âœ“â± aâ±

    â—âŸ¨âŸ©-âœ“ :  â—âŸ¨ i âŸ© aâ±  âŠ¨âœ“  âŒœ âˆ‘ Eâ± , Eâ± âœ“â± aâ± âŒáµ’
    â—âŸ¨âŸ©-âœ“ Eâœ“â—ia =  â—-âœ“ Eâœ“â—ia â€º Î» (-, Eâœ“ia) â†’ -, âœ“-injË™ Eâœ“ia

    -- â†â± into â¤‡áµ’ on â—âŸ¨ i âŸ©

    â†-â—âŸ¨âŸ©-â¤‡áµ’-âˆƒáµ’ :  (âˆ€{Eâ±} â†’  (Eâ± , aâ±)  â†â± Î» x â†’  Eâ± , bâ±Ë™ x)  â†’
                   â—âŸ¨ i âŸ© aâ±  âŠ¨ â¤‡áµ’  âˆƒáµ’ x , â—âŸ¨ i âŸ© bâ±Ë™ x
    â†-â—âŸ¨âŸ©-â¤‡áµ’-âˆƒáµ’ Eaâ†Ebx =  â†-â—-â¤‡áµ’-âˆƒáµ’ $ injË™-â† Eaâ†Ebx

    Îµâ†-â—âŸ¨âŸ©-â¤‡áµ’-âˆƒáµ’ :  (âˆ€{Eâ±} â†’  (Eâ± , Îµâ±)  â†â± Î» x â†’  Eâ± , aâ±Ë™ x)  â†’
                    âŠ¨ â¤‡áµ’  âˆƒáµ’ x , â—âŸ¨ i âŸ© aâ±Ë™ x
    Îµâ†-â—âŸ¨âŸ©-â¤‡áµ’-âˆƒáµ’ EÎµâ†Eax =  â†-â—âŸ¨âŸ©-â¤‡áµ’-âˆƒáµ’ EÎµâ†Eax â—âŸ¨âŸ©-Îµ

    â†-â—âŸ¨âŸ©-â¤‡áµ’ :  (âˆ€{Eâ±} â†’  (Eâ± , aâ±)  â†â± Î» (_ : âŠ¤â‚€) â†’  Eâ± , bâ±)  â†’
                â—âŸ¨ i âŸ© aâ±  âŠ¨  â¤‡áµ’ â—âŸ¨ i âŸ© bâ±
    â†-â—âŸ¨âŸ©-â¤‡áµ’ Eaâ†Eb =  â†-â—âŸ¨âŸ©-â¤‡áµ’-âˆƒáµ’ Eaâ†Eb â€º â¤‡áµ’-mono Ï€â‚

    Îµâ†-â—âŸ¨âŸ©-â¤‡áµ’ :  (âˆ€{Eâ±} â†’  (Eâ± , Îµâ±)  â†â± Î» (_ : âŠ¤â‚€) â†’  Eâ± , aâ±)  â†’
                 âŠ¨  â¤‡áµ’ â—âŸ¨ i âŸ© aâ±
    Îµâ†-â—âŸ¨âŸ©-â¤‡áµ’ EÎµâ†Ea =  â¤‡áµ’-mono Ï€â‚ $ Îµâ†-â—âŸ¨âŸ©-â¤‡áµ’-âˆƒáµ’ EÎµâ†Ea

    -- â†â± into â¤‡á´± on â—âŸ¨ i âŸ©

    â†-â—âŸ¨âŸ©-â¤‡á´± :  ((E i , aâ±)  â†â± Î» x â†’  Fâ±Ë™ x , bâ±Ë™ x)  â†’
                â—âŸ¨ i âŸ© aâ±  âŠ¨  E  â¤‡á´± Î» x â†’  updË™ i (Fâ±Ë™ x) E , â—âŸ¨ i âŸ© bâ±Ë™ x
    â†-â—âŸ¨âŸ©-â¤‡á´± Eaâ†Fxbx =  â†-â—-â¤‡á´± $ updË™-injË™-â† Eaâ†Fxbx

    Îµâ†-â—âŸ¨âŸ©-â¤‡á´± :  ((E i , Îµâ±)  â†â± Î» x â†’  Fâ±Ë™ x , aâ±Ë™ x)  â†’
                 âŠ¨  E  â¤‡á´± Î» x â†’  updË™ i (Fâ±Ë™ x) E , â—âŸ¨ i âŸ© aâ±Ë™ x
    Îµâ†-â—âŸ¨âŸ©-â¤‡á´± EÎµâ†Fax =  â†-â—âŸ¨âŸ©-â¤‡á´± EÎµâ†Fax â—âŸ¨âŸ©-Îµ

--------------------------------------------------------------------------------
-- Thunkáµ’, Shrunkáµ’ :  Sized proposition under Thunk / Shrunk

Thunkáµ’ Shrunkáµ’ :  (ğ•Š â†’ Propáµ’ Å‚) â†’  ğ•Š â†’  Propáµ’ Å‚
Thunkáµ’ Páµ’á¶¥ Î¹ a =  Thunk (Î» Î¹' â†’ Páµ’á¶¥ Î¹' a) Î¹
Shrunkáµ’ Páµ’á¶¥ Î¹ a =  Shrunk (Î» Î¹' â†’ Páµ’á¶¥ Î¹' a) Î¹

abstract

  -- Monoáµ’ for Thunkáµ’/Shrunkáµ’

  Thunkáµ’-Mono :  (âˆ€{Î¹} â†’ Monoáµ’ $ Páµ’á¶¥ Î¹) â†’  Monoáµ’ $ Thunkáµ’ Páµ’á¶¥ Î¹
  Thunkáµ’-Mono MonoP aâŠ‘b TPa .! =  MonoP aâŠ‘b $ TPa .!

  Shrunkáµ’-Mono :  (âˆ€{Î¹} â†’ Monoáµ’ $ Páµ’á¶¥ Î¹) â†’  Monoáµ’ $ Shrunkáµ’ Páµ’á¶¥ Î¹
  Shrunkáµ’-Mono MonoP aâŠ‘b (Â§ Pa) =  Â§ MonoP aâŠ‘b Pa

  -- Monotonicity of Thunkáµ’/Shrunkáµ’

  Thunkáµ’-mono :  (âˆ€{Î¹} â†’ Páµ’á¶¥ Î¹ âŠ¨ Qáµ’á¶¥ Î¹) â†’  Thunkáµ’ Páµ’á¶¥ Î¹ âŠ¨ Thunkáµ’ Qáµ’á¶¥ Î¹
  Thunkáµ’-mono PÎ¹âŠ¨QÎ¹ TPa .! =  PÎ¹âŠ¨QÎ¹ $ TPa .!

  Thunkáµ’-monoâœ“ :  (âˆ€{Î¹} â†’ Páµ’á¶¥ Î¹ âŠ¨âœ“ Qáµ’á¶¥ Î¹) â†’  Thunkáµ’ Páµ’á¶¥ Î¹ âŠ¨âœ“ Thunkáµ’ Qáµ’á¶¥ Î¹
  Thunkáµ’-monoâœ“ PÎ¹âŠ¨âœ“QÎ¹ Eâœ“a TPa .! =  PÎ¹âŠ¨âœ“QÎ¹ Eâœ“a $ TPa .!

  Shrunkáµ’-mono :  (âˆ€{Î¹} â†’ Páµ’á¶¥ Î¹ âŠ¨ Qáµ’á¶¥ Î¹) â†’  Shrunkáµ’ Páµ’á¶¥ Î¹ âŠ¨ Shrunkáµ’ Qáµ’á¶¥ Î¹
  Shrunkáµ’-mono PÎ¹âŠ¨QÎ¹ (Â§ Pa) =  Â§ PÎ¹âŠ¨QÎ¹ Pa

  Shrunkáµ’-monoâœ“ :  (âˆ€{Î¹} â†’ Páµ’á¶¥ Î¹ âŠ¨âœ“ Qáµ’á¶¥ Î¹) â†’  Shrunkáµ’ Páµ’á¶¥ Î¹ âŠ¨âœ“ Shrunkáµ’ Qáµ’á¶¥ Î¹
  Shrunkáµ’-monoâœ“ PÎ¹âŠ¨âœ“QÎ¹ Eâœ“a (Â§ Pa) =  Â§ PÎ¹âŠ¨âœ“QÎ¹ Eâœ“a Pa

  -- Pull Thunkáµ’/Shrunkáµ’ out of âˆ—áµ’

  âˆ—áµ’Thunkáµ’-out :  Páµ’ âˆ—áµ’ Thunkáµ’ Qáµ’á¶¥ Î¹  âŠ¨  Thunkáµ’ (Î» Î¹ â†’ Páµ’ âˆ—áµ’ Qáµ’á¶¥ Î¹) Î¹
  âˆ—áµ’Thunkáµ’-out (-, -, bâˆ™câŠ‘a , Pa , TQa) .! =  -, -, bâˆ™câŠ‘a , Pa , TQa .!

  Thunkáµ’âˆ—áµ’-out :  Thunkáµ’ Páµ’á¶¥ Î¹ âˆ—áµ’ Qáµ’  âŠ¨  Thunkáµ’ (Î» Î¹ â†’ Páµ’á¶¥ Î¹ âˆ—áµ’ Qáµ’) Î¹
  Thunkáµ’âˆ—áµ’-out =  âˆ—áµ’-comm â€º âˆ—áµ’Thunkáµ’-out â€º Î»{ TPQa .! â†’ âˆ—áµ’-comm $ TPQa .! }

  âˆ—áµ’Shrunkáµ’-out :  Páµ’ âˆ—áµ’ Shrunkáµ’ Qáµ’á¶¥ Î¹  âŠ¨  Shrunkáµ’ (Î» Î¹ â†’ Páµ’ âˆ—áµ’ Qáµ’á¶¥ Î¹) Î¹
  âˆ—áµ’Shrunkáµ’-out (-, -, bâˆ™câŠ‘a , Pa , Â§ Qa) =  Â§ (-, -, bâˆ™câŠ‘a , Pa , Qa)

  Shrunkáµ’âˆ—áµ’-out :  Shrunkáµ’ Páµ’á¶¥ Î¹ âˆ—áµ’ Qáµ’  âŠ¨  Shrunkáµ’ (Î» Î¹ â†’ Páµ’á¶¥ Î¹ âˆ—áµ’ Qáµ’) Î¹
  Shrunkáµ’âˆ—áµ’-out =  âˆ—áµ’-comm â€º âˆ—áµ’Shrunkáµ’-out â€º Î»{ (Â§ PQa) â†’ Â§ âˆ—áµ’-comm PQa }
