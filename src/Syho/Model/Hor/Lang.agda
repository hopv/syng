--------------------------------------------------------------------------------
-- Language-specific lemmas on the weakest preconditions
--------------------------------------------------------------------------------

{-# OPTIONS --without-K --sized-types #-}

module Syho.Model.Hor.Lang where

open import Base.Level using (Level)
open import Base.Func using (_$_; _â–·_; _â€º_)
open import Base.Few using (absurd)
open import Base.Eq using (refl; â— _)
open import Base.Dec using (Inh; auto)
open import Base.Size using (ğ•Š; âˆ; !; Â§_)
open import Base.Bool using (ğ”¹; tt; ff)
open import Base.Prod using (_,_; -,_)
open import Base.Sum using (Ä©â‚€_; Ä©â‚_)
open import Base.Sety using (SetÊ¸; â¸¨_â¸©Ê¸)
open import Syho.Lang.Expr using (Type; Exprâˆ; ExprË‚âˆ; âˆ‡_; Val; Vâ‡’E)
open import Syho.Lang.Ktxred using (Redex; ndá´¿; [_]á´¿âŸ¨_âŸ©; [_]á´¿â—‹; [_]á´¿â—; forká´¿;
  Ktx; _á´·â—_; _á´·âˆ˜á´·_; val/ktxred; á´·âˆ˜á´·-á´·â—; val/ktxred-Ä©â‚€; val/ktxred-ktx)
open import Syho.Lang.Reduce using (ndâ‡’; []â‡’; forkâ‡’; redá´·á´¿)
open import Syho.Model.Prop.Base using (Propáµ’; substáµ’; _âŠ¨_; âˆ€áµ’âˆˆ-syntax; _âˆ—áµ’_;
  _-âˆ—áµ’_; âˆ—áµ’-mono; âˆ—áµ’-monoË¡; âˆ—áµ’-monoÊ³; âˆ—áµ’-comm; âˆ—áµ’?-intro; -âˆ—áµ’-monoÊ³; -âˆ—áµ’-introË¡;
  -âˆ—áµ’-applyË¡; âˆ—áµ’Thunkáµ’-out)
open import Syho.Model.Prop.Names using ([âŠ¤]á´ºáµ’)
open import Syho.Model.Supd.Interp using (â‡›á´¹-mono; â‡›á´ºáµ’-mono; â‡›á´¹-intro; â‡›á´¹-join)
open import Syho.Model.Hor.Wp using (áµƒâŸ¨_âŸ©áµ’; âºâŸ¨_âŸ©á´¾áµ’; âºâŸ¨_âŸ©áµ€áµ’; âºâŸ¨_âŸ©âˆáµ’; âŸ¨_âŸ©á´¾áµ’;
  âŸ¨_âŸ©áµ€áµ’; âŸ¨_âŸ©âˆáµ’; âŸ¨_âŸ©á´¾áµ’Ë‚; âŸ¨_âŸ©âˆáµ’Ë‚Ê³; âŸ¨_âŸ©á´¾áµ’âŠ¤; âŸ¨_âŸ©á´¾áµ’âŠ¤Ë‚; âŸ¨_âŸ©áµ€áµ’âŠ¤; âºâŸ¨âŸ©á´¾áµ’-valâ»Â¹;
  âºâŸ¨âŸ©áµ€áµ’-valâ»Â¹; âºâŸ¨âŸ©âˆáµ’-valâ»Â¹; âºâŸ¨âŸ©á´¾áµ’-kr; âºâŸ¨âŸ©áµ€áµ’-kr; âºâŸ¨âŸ©âˆáµ’-kr; âºâŸ¨âŸ©á´¾áµ’-krâ»Â¹; âºâŸ¨âŸ©áµ€áµ’-krâ»Â¹;
  âºâŸ¨âŸ©âˆáµ’-krâ»Â¹; âºâŸ¨âŸ©á´¾áµ’-mono; âºâŸ¨âŸ©á´¾áµ’-size; âŸ¨Â¿âŸ©áµ€áµ’âŠ¤Ë‚-size; â‡›á´ºáµ’-âºâŸ¨âŸ©á´¾áµ’; â‡›á´ºáµ’-âºâŸ¨âŸ©áµ€áµ’;
  â‡›á´ºáµ’-âºâŸ¨âŸ©âˆáµ’)

private variable
  Å‚ :  Level
  Î¹ Î¹' :  ğ•Š
  b :  ğ”¹
  XÊ¸ :  SetÊ¸
  X :  Setâ‚€
  v x :  X
  T U :  Type
  Páµ’ :  Propáµ’ Å‚
  Páµ’Ë™ :  X â†’  Propáµ’ Å‚
  e :  Exprâˆ T
  eË™ :  X â†’  Exprâˆ T
  red :  Redex T
  K :  Ktx T U

--------------------------------------------------------------------------------
-- Language-specific lemmas on the weakest preconditions

abstract

  -- Compose áµƒâŸ¨âŸ©áµ’ and âŸ¨âŸ©á´¾/áµ€áµ’
  -- The inner weakest precondion is under the thunk for âŸ¨âŸ©á´¾áµ’

  áµƒâŸ¨âŸ©á´ºáµ’-âŸ¨âŸ©á´¾áµ’ :  [âŠ¤]á´ºáµ’ -âˆ—áµ’ áµƒâŸ¨ red âŸ©áµ’ (Î» v â†’ [âŠ¤]á´ºáµ’ âˆ—áµ’ âŸ¨ K á´·â— Vâ‡’E v âŸ©á´¾áµ’Ë‚ Î¹ Páµ’Ë™)  âŠ¨
                  âºâŸ¨ Ä©â‚ (-, K , red) âŸ©á´¾áµ’ Î¹ Páµ’Ë™
  áµƒâŸ¨âŸ©á´ºáµ’-âŸ¨âŸ©á´¾áµ’ =  -âˆ—áµ’-monoÊ³ (Î» big M â†’ big M â–· â‡›á´¹-mono Î» ((-, -, redMâ‡’) , big) â†’
    (-, -, redá´·á´¿ redMâ‡’) , Î»{ _ eË‡ M' (-, redá´·á´¿ eeË‡M'â‡) â†’ big _ eË‡ M' (-, eeË‡M'â‡)
    â–· Î»{ (-, (refl , refl) , big) â†’ big â–· â‡›á´¹-mono (âˆ—áµ’-monoÊ³ $ âˆ—áµ’?-intro _) }}) â€º
    âºâŸ¨âŸ©á´¾áµ’-kr

  áµƒâŸ¨âŸ©á´ºáµ’-âŸ¨âŸ©áµ€áµ’ :  [âŠ¤]á´ºáµ’ -âˆ—áµ’ áµƒâŸ¨ red âŸ©áµ’ (Î» v â†’ [âŠ¤]á´ºáµ’ âˆ—áµ’ âŸ¨ K á´·â— Vâ‡’E v âŸ©áµ€áµ’ âˆ Páµ’Ë™)  âŠ¨
                  âºâŸ¨ Ä©â‚ (-, K , red) âŸ©áµ€áµ’ âˆ Páµ’Ë™
  áµƒâŸ¨âŸ©á´ºáµ’-âŸ¨âŸ©áµ€áµ’ =  -âˆ—áµ’-monoÊ³ (Î» big M â†’ big M â–· â‡›á´¹-mono Î» ((-, -, redMâ‡’) , big) â†’
    (-, -, redá´·á´¿ redMâ‡’) , Î»{ _ eË‡ M' (-, redá´·á´¿ eeË‡M'â‡) â†’ big _ eË‡ M' (-, eeË‡M'â‡)
    â–· Î»{ (-, (refl , refl) , big) â†’ big â–·
    â‡›á´¹-mono (âˆ—áµ’-monoÊ³ $ Â§_ â€º âˆ—áµ’?-intro _) }}) â€º âºâŸ¨âŸ©áµ€áµ’-kr

  -- Compose áµƒâŸ¨âŸ©áµ’ and âŸ¨âŸ©âˆáµ’

  áµƒâŸ¨âŸ©á´ºáµ’-âŸ¨âŸ©âˆáµ’ :  [âŠ¤]á´ºáµ’ -âˆ—áµ’ áµƒâŸ¨ red âŸ©áµ’ (Î» v â†’ [âŠ¤]á´ºáµ’ âˆ—áµ’ âŸ¨ K á´·â— Vâ‡’E v âŸ©âˆáµ’ âˆ Î¹)  âŠ¨
                  âºâŸ¨ Ä©â‚ (-, K , red) âŸ©âˆáµ’ âˆ Î¹
  áµƒâŸ¨âŸ©á´ºáµ’-âŸ¨âŸ©âˆáµ’ =  -âˆ—áµ’-monoÊ³ (Î» big M â†’ big M â–· â‡›á´¹-mono Î» ((-, -, redMâ‡’) , big) â†’
    (-, -, redá´·á´¿ redMâ‡’) , Î» _ eË‡ M' â†’ Î»{
    ff (redá´·á´¿ eeË‡M'â‡â—‹) â†’ big _ eË‡ M' (-, eeË‡M'â‡â—‹) â–·
      Î»{ (-, (refl , refl) , big) â†’ big â–·
      â‡›á´¹-mono (âˆ—áµ’-monoÊ³ $ Â§_ â€º âˆ—áµ’?-intro _) };
    tt (redá´·á´¿ eeË‡M'â‡â—) â†’ big _ eË‡ M' (-, eeË‡M'â‡â—) â–·
      Î»{ (-, (refl , refl) , big) â†’ big â–·
      â‡›á´¹-mono (âˆ—áµ’-monoÊ³ $ (Î» big â†’ Î»{ .! â†’ big }) â€º âˆ—áµ’?-intro _) }}) â€º âºâŸ¨âŸ©âˆáµ’-kr

  -- Bind for âŸ¨âŸ©á´¾/áµ€áµ’

  âŸ¨âŸ©á´¾áµ’-bind :  âŸ¨ e âŸ©á´¾áµ’ Î¹ (Î» v â†’ âŸ¨ K á´·â— Vâ‡’E v âŸ©á´¾áµ’ Î¹ Páµ’Ë™)  âŠ¨  âŸ¨ K á´·â— e âŸ©á´¾áµ’ Î¹ Páµ’Ë™
  âŸ¨âŸ©á´¾áµ’-bind {e = e} {K = K}
    with val/ktxred e | val/ktxred-Ä©â‚€ {e = e} | val/ktxred-ktx {e = e}
  â€¦ | Ä©â‚€ _ | â‡’eâ‡’v | _  rewrite â‡’eâ‡’v refl =  âºâŸ¨âŸ©á´¾áµ’-valâ»Â¹ â€º â‡›á´ºáµ’-âºâŸ¨âŸ©á´¾áµ’
  â€¦ | Ä©â‚ (-, K' , _) | _ | â‡’Keâ‰¡KK'red  rewrite â‡’Keâ‰¡KK'red {K = K} refl =
    âºâŸ¨âŸ©á´¾áµ’-krâ»Â¹ â€º -âˆ—áµ’-monoÊ³ (Î» big M â†’ big M â–· â‡›á´¹-mono
    Î»{ ((-, -, redá´·á´¿ redMâ‡’) , big) â†’ (-, -, redá´·á´¿ redMâ‡’) ,
    Î»{ _ eË‡ M' (-, redá´·á´¿ e'eË‡M'â‡) â†’ big _ eË‡ M' (-, redá´·á´¿ e'eË‡M'â‡) â–· â‡›á´¹-mono
    (âˆ—áµ’-monoÊ³ $ âˆ—áµ’-monoË¡ Î» big â†’ Î»{ .! {Î¹'} â†’ big .! â–·
    âºâŸ¨âŸ©á´¾áµ’-mono (Î» _ â†’ âºâŸ¨âŸ©á´¾áµ’-size) â–· âŸ¨âŸ©á´¾áµ’-bind â–·
    substáµ’ (Î» eâº â†’ âŸ¨ eâº âŸ©á´¾áµ’ Î¹' _) (â—  á´·âˆ˜á´·-á´·â— {K = K}) }) }}) â€º âºâŸ¨âŸ©á´¾áµ’-kr

  âŸ¨âŸ©áµ€áµ’-bind :  âŸ¨ e âŸ©áµ€áµ’ Î¹ (Î» v â†’ âŸ¨ K á´·â— Vâ‡’E v âŸ©áµ€áµ’ âˆ Páµ’Ë™)  âŠ¨  âŸ¨ K á´·â— e âŸ©áµ€áµ’ âˆ Páµ’Ë™
  âŸ¨âŸ©áµ€áµ’-bind {e = e} {K = K}
    with val/ktxred e | val/ktxred-Ä©â‚€ {e = e} | val/ktxred-ktx {e = e}
  â€¦ | Ä©â‚€ _ | â‡’eâ‡’v | _  rewrite â‡’eâ‡’v refl =  âºâŸ¨âŸ©áµ€áµ’-valâ»Â¹ â€º â‡›á´ºáµ’-âºâŸ¨âŸ©áµ€áµ’
  â€¦ | Ä©â‚ (-, K' , _) | _ | â‡’Keâ‰¡KK'red  rewrite â‡’Keâ‰¡KK'red {K = K} refl =
    âºâŸ¨âŸ©áµ€áµ’-krâ»Â¹ â€º -âˆ—áµ’-monoÊ³ (Î» big M â†’ big M â–· â‡›á´¹-mono Î»{
    ((-, -, redá´·á´¿ redMâ‡’) , big) â†’ (-, -, redá´·á´¿ redMâ‡’) ,
    Î»{ _ eË‡ M' (-, redá´·á´¿ e'eË‡M'â‡) â†’ big _ eË‡ M' (-, redá´·á´¿ e'eË‡M'â‡) â–· â‡›á´¹-mono
    (âˆ—áµ’-monoÊ³ $ âˆ—áµ’-monoÊ³ (âŸ¨Â¿âŸ©áµ€áµ’âŠ¤Ë‚-size {Î¹ = âˆ} {eË‡ = eË‡}) â€º
    âˆ—áµ’-monoË¡ Î»{ (Â§ big) â†’ Â§ (âŸ¨âŸ©áµ€áµ’-bind big â–·
    substáµ’ (Î» eâº â†’ âŸ¨ eâº âŸ©áµ€áµ’ âˆ _) (â—  á´·âˆ˜á´·-á´·â— {K = K})) }) }}) â€º âºâŸ¨âŸ©áµ€áµ’-kr

  âŸ¨âŸ©âˆáµ’-bind :  âŸ¨ e âŸ©âˆáµ’ Î¹ Î¹'  âŠ¨  âŸ¨ K á´·â— e âŸ©âˆáµ’ âˆ Î¹'
  âŸ¨âŸ©âˆáµ’-bind {e = e} {Î¹' = Î¹'} {K = K}
    with val/ktxred e | val/ktxred-Ä©â‚€ {e = e} | val/ktxred-ktx {e = e}
  â€¦ | Ä©â‚€ _ | â‡’eâ‡’v | _  rewrite â‡’eâ‡’v refl =
    âºâŸ¨âŸ©âˆáµ’-valâ»Â¹ â€º â‡›á´ºáµ’-mono absurd â€º â‡›á´ºáµ’-âºâŸ¨âŸ©âˆáµ’
  â€¦ | Ä©â‚ (-, K' , _) | _ | â‡’Keâ‰¡KK'red  rewrite â‡’Keâ‰¡KK'red {K = K} refl =
    âºâŸ¨âŸ©âˆáµ’-krâ»Â¹ â€º -âˆ—áµ’-monoÊ³ (Î» big M â†’ big M â–· â‡›á´¹-mono Î»{
    ((-, -, redá´·á´¿ redMâ‡’) , big) â†’ (-, -, redá´·á´¿ redMâ‡’) , Î» _ eË‡ M' â†’ Î»{
    ff (redá´·á´¿ e'eË‡M'â‡â—‹) â†’ big _ eË‡ M' ff (redá´·á´¿ e'eË‡M'â‡â—‹) â–· â‡›á´¹-mono
      (âˆ—áµ’-monoÊ³ $ âˆ—áµ’-monoÊ³ (âŸ¨Â¿âŸ©áµ€áµ’âŠ¤Ë‚-size {Î¹ = âˆ} {eË‡ = eË‡}) â€º
      âˆ—áµ’-monoË¡ Î»{ (Â§ big) â†’ Â§ (âŸ¨âŸ©âˆáµ’-bind {K = K} big â–·
      substáµ’ (Î» eâº â†’ âŸ¨ eâº âŸ©âˆáµ’ âˆ Î¹') (â—  á´·âˆ˜á´·-á´·â— {K = K})) });
    tt (redá´·á´¿ e'eË‡M'â‡â—) â†’ big _ eË‡ M' tt (redá´·á´¿ e'eË‡M'â‡â—) â–· â‡›á´¹-mono
      (âˆ—áµ’-monoÊ³ $ âˆ—áµ’-monoÊ³ (âŸ¨Â¿âŸ©áµ€áµ’âŠ¤Ë‚-size {Î¹ = âˆ} {eË‡ = eË‡}) â€º
      âˆ—áµ’-monoË¡ Î» big â†’ Î»{ .! {Î¹'â»} â†’ big .! â–· âŸ¨âŸ©âˆáµ’-bind {K = K} â–·
      substáµ’ (Î» eâº â†’ âŸ¨ eâº âŸ©âˆáµ’ âˆ Î¹'â») (â—  á´·âˆ˜á´·-á´·â— {K = K}) }) }}) â€º âºâŸ¨âŸ©âˆáµ’-kr

  âŸ¨âŸ©áµ€áµ’-âŸ¨âŸ©âˆáµ’-bind :  âŸ¨ e âŸ©áµ€áµ’ Î¹ (Î» v â†’ âŸ¨ K á´·â— Vâ‡’E v âŸ©âˆáµ’ âˆ Î¹')  âŠ¨
                    âŸ¨ K á´·â— e âŸ©âˆáµ’ âˆ Î¹'
  âŸ¨âŸ©áµ€áµ’-âŸ¨âŸ©âˆáµ’-bind {e = e} {K = K} {Î¹' = Î¹'}
    with val/ktxred e | val/ktxred-Ä©â‚€ {e = e} | val/ktxred-ktx {e = e}
  â€¦ | Ä©â‚€ _ | â‡’eâ‡’v | _  rewrite â‡’eâ‡’v refl =  âºâŸ¨âŸ©áµ€áµ’-valâ»Â¹ â€º â‡›á´ºáµ’-âºâŸ¨âŸ©âˆáµ’
  â€¦ | Ä©â‚ (-, K' , _) | _ | â‡’Keâ‰¡KK'red  rewrite â‡’Keâ‰¡KK'red {K = K} refl =
    âºâŸ¨âŸ©áµ€áµ’-krâ»Â¹ â€º -âˆ—áµ’-monoÊ³ (Î» big M â†’ big M â–· â‡›á´¹-mono Î»{
    ((-, -, redá´·á´¿ redMâ‡’) , big) â†’ (-, -, redá´·á´¿ redMâ‡’) , Î» _ eË‡ M' â†’ Î»{
    ff (redá´·á´¿ e'eË‡M'â‡â—‹) â†’ big _ eË‡ M' (-, redá´·á´¿ e'eË‡M'â‡â—‹) â–· â‡›á´¹-mono
      (âˆ—áµ’-monoÊ³ $ âˆ—áµ’-monoÊ³ (âŸ¨Â¿âŸ©áµ€áµ’âŠ¤Ë‚-size {Î¹ = âˆ} {eË‡ = eË‡}) â€º
      âˆ—áµ’-monoË¡ Î»{ (Â§ big) â†’ Â§ (âŸ¨âŸ©áµ€áµ’-âŸ¨âŸ©âˆáµ’-bind big â–·
      substáµ’ (Î» eâº â†’ âŸ¨ eâº âŸ©âˆáµ’ âˆ Î¹') (â—  á´·âˆ˜á´·-á´·â— {K = K})) });
    tt (redá´·á´¿ e'eË‡M'â‡â—) â†’ big _ eË‡ M' (-, redá´·á´¿ e'eË‡M'â‡â—) â–· â‡›á´¹-mono
      (âˆ—áµ’-monoÊ³ $ âˆ—áµ’-monoÊ³ (âŸ¨Â¿âŸ©áµ€áµ’âŠ¤Ë‚-size {Î¹ = âˆ} {eË‡ = eË‡}) â€º
      âˆ—áµ’-monoË¡ Î»{ (Â§ big) â†’ Î»{ .! {Î¹'â»} â†’ big â–· âŸ¨âŸ©áµ€áµ’-âŸ¨âŸ©âˆáµ’-bind {K = K} â–·
      substáµ’ (Î» eâº â†’ âŸ¨ eâº âŸ©âˆáµ’ âˆ Î¹'â») (â—  á´·âˆ˜á´·-á´·â— {K = K}) }}) }}) â€º âºâŸ¨âŸ©âˆáµ’-kr

  -- nd by áµƒâŸ¨âŸ©áµ’

  áµƒâŸ¨âŸ©áµ’-nd :  {{Inh â¸¨ XÊ¸ â¸©Ê¸}} â†’  Páµ’ âŠ¨ áµƒâŸ¨ ndá´¿ {XÊ¸} âŸ©áµ’ Î» _ â†’ Páµ’
  áµƒâŸ¨âŸ©áµ’-nd {{InhX}} Pa M =  â‡›á´¹-intro ((-, -, ndâ‡’ $ auto {{InhX}}) ,
    Î»{ _ _ _ (-, ndâ‡’ _) â†’ -, (refl , refl) , â‡›á´¹-intro Pa })

  -- Pure reduction by âºâŸ¨âŸ©á´¾/áµ€áµ’
  -- The premise is under the thunk for âºâŸ¨âŸ©á´¾áµ’

  âºâŸ¨âŸ©á´¾áµ’-[] :  âŸ¨ K á´·â— e âŸ©á´¾áµ’Ë‚ Î¹ Páµ’Ë™  âŠ¨  âºâŸ¨ Ä©â‚ (-, K , [ e ]á´¿âŸ¨ b âŸ©) âŸ©á´¾áµ’ Î¹ Páµ’Ë™
  âºâŸ¨âŸ©á´¾áµ’-[] =  -âˆ—áµ’-introË¡ (Î» _ big _ â†’ â‡›á´¹-intro ((-, -, redá´·á´¿ []â‡’) ,
    Î»{ _ _ _ (-, redá´·á´¿ []â‡’) â†’ â‡›á´¹-intro $ big â–· âˆ—áµ’-monoÊ³ (âˆ—áµ’?-intro _) })) â€º
    âºâŸ¨âŸ©á´¾áµ’-kr

  âºâŸ¨âŸ©áµ€áµ’-[] :  âŸ¨ K á´·â— e âŸ©áµ€áµ’ Î¹ Páµ’Ë™  âŠ¨  âºâŸ¨ Ä©â‚ (-, K , [ e ]á´¿âŸ¨ b âŸ©) âŸ©áµ€áµ’ âˆ Páµ’Ë™
  âºâŸ¨âŸ©áµ€áµ’-[] =  -âˆ—áµ’-introË¡ (Î» _ big _ â†’ â‡›á´¹-intro ((-, -, redá´·á´¿ []â‡’) ,
    Î»{ _ _ _ (-, redá´·á´¿ []â‡’) â†’ â‡›á´¹-intro $ big â–· âˆ—áµ’-monoÊ³ (Â§_ â€º âˆ—áµ’?-intro _) })) â€º
    âºâŸ¨âŸ©áµ€áµ’-kr

  -- Pure reduction by âºâŸ¨âŸ©âˆáµ’
  -- The premise is under the thunk when the reduction triggers an event

  âºâŸ¨âŸ©âˆáµ’-[]â—‹ :  âŸ¨ K á´·â— e âŸ©âˆáµ’ Î¹ Î¹'  âŠ¨  âºâŸ¨ Ä©â‚ (-, K , [ e ]á´¿â—‹) âŸ©âˆáµ’ âˆ Î¹'
  âºâŸ¨âŸ©âˆáµ’-[]â—‹ =  -âˆ—áµ’-introË¡ (Î» _ big _ â†’ â‡›á´¹-intro ((-, -, redá´·á´¿ []â‡’) ,
    Î»{ _ _ _ ff (redá´·á´¿ []â‡’) â†’ â‡›á´¹-intro $ big â–· âˆ—áµ’-monoÊ³ (Â§_ â€º âˆ—áµ’?-intro _) })) â€º
    âºâŸ¨âŸ©âˆáµ’-kr

  âºâŸ¨âŸ©âˆáµ’-[]â— :  âŸ¨ K á´·â— e âŸ©âˆáµ’Ë‚Ê³ Î¹'  âŠ¨  âºâŸ¨ Ä©â‚ (-, K , [ e ]á´¿â—) âŸ©âˆáµ’ Î¹ Î¹'
  âºâŸ¨âŸ©âˆáµ’-[]â— =  -âˆ—áµ’-introË¡ (Î» _ big _ â†’ â‡›á´¹-intro ((-, -, redá´·á´¿ []â‡’) ,
    Î»{ _ _ _ tt (redá´·á´¿ []â‡’) â†’ â‡›á´¹-intro $ big â–· âˆ—áµ’-monoÊ³ (âˆ—áµ’?-intro _) })) â€º
    âºâŸ¨âŸ©âˆáµ’-kr

  -- fork by âºâŸ¨âŸ©á´¾/áµ€áµ’ / âºâŸ¨âŸ©âˆáµ’
  -- The premise is under the thunk for âºâŸ¨âŸ©á´¾áµ’

  âºâŸ¨âŸ©á´¾áµ’-fork :  âŸ¨ e âŸ©á´¾áµ’âŠ¤Ë‚ Î¹  âˆ—áµ’  âŸ¨ K á´·â— âˆ‡ _ âŸ©á´¾áµ’Ë‚ Î¹ Páµ’Ë™  âŠ¨
                  âºâŸ¨ Ä©â‚ (-, K , forká´¿ e) âŸ©á´¾áµ’ Î¹ Páµ’Ë™
  âºâŸ¨âŸ©á´¾áµ’-fork =  -âˆ—áµ’-introË¡ (Î» _ big _ â†’ â‡›á´¹-intro ((-, -, redá´·á´¿ forkâ‡’) ,
    Î»{ _ _ _ (-, redá´·á´¿ forkâ‡’) â†’ â‡›á´¹-intro $ big â–· âˆ—áµ’-monoÊ³ âˆ—áµ’-comm })) â€º âºâŸ¨âŸ©á´¾áµ’-kr

  âºâŸ¨âŸ©áµ€áµ’-fork :  âŸ¨ e âŸ©áµ€áµ’âŠ¤ Î¹'  âˆ—áµ’  âŸ¨ K á´·â— âˆ‡ _ âŸ©áµ€áµ’ Î¹ Páµ’Ë™  âŠ¨
                  âºâŸ¨ Ä©â‚ (-, K , forká´¿ e) âŸ©áµ€áµ’ âˆ Páµ’Ë™
  âºâŸ¨âŸ©áµ€áµ’-fork =  -âˆ—áµ’-introË¡ (Î» _ big _ â†’ â‡›á´¹-intro ((-, -, redá´·á´¿ forkâ‡’) ,
    Î»{ _ _ _ (-, redá´·á´¿ forkâ‡’) â†’ â‡›á´¹-intro $ big â–·
    âˆ—áµ’-monoÊ³ (âˆ—áµ’-comm â€º âˆ—áµ’-mono Â§_ $ Â§_ {Î¹ = âˆ}) })) â€º âºâŸ¨âŸ©áµ€áµ’-kr

  âºâŸ¨âŸ©âˆáµ’-fork :  âŸ¨ e âŸ©áµ€áµ’âŠ¤ Î¹  âˆ—áµ’  âŸ¨ K á´·â— âˆ‡ _ âŸ©âˆáµ’ Î¹ Î¹'  âŠ¨
                  âºâŸ¨ Ä©â‚ (-, K , forká´¿ e) âŸ©âˆáµ’ âˆ Î¹'
  âºâŸ¨âŸ©âˆáµ’-fork =  -âˆ—áµ’-introË¡ (Î» _ big _ â†’ â‡›á´¹-intro ((-, -, redá´·á´¿ forkâ‡’) ,
    Î»{ _ _ _ ff (redá´·á´¿ forkâ‡’) â†’ â‡›á´¹-intro $ big â–·
    âˆ—áµ’-monoÊ³ (âˆ—áµ’-comm â€º âˆ—áµ’-mono Â§_ $ Â§_ {Î¹ = âˆ}) })) â€º âºâŸ¨âŸ©âˆáµ’-kr
